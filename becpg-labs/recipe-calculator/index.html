<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Recipe Calculator</title>
<style type="text/css" title="currentStyle">
@import "media/css/demo_page.css";

@import "media/css/demo_table.css";
</style>
<script type="text/javascript" src="media/js/jquery.js"></script>
<script type="text/javascript" src="media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">  

function fnGetJSONData( sSource, aoData, fnCallback ) {
	  
		var params = {};
		for ( var i=0 ; i <aoData.length ; i++ ) {
			var entry = aoData[i];
			params[entry.name] = entry.value;
		}
		var query = params["sSearch"];
		if (query == undefined || query == "") {
			query="*";
		} 
	
		var start = params["iDisplayStart"]/params["iDisplayLength"] + 1;
		var length = params["iDisplayLength"];
		$.ajax( {
				"dataType": 'json', 
				"type": "GET", 
				"url": sSource, 
				"data": {"q":query,"size":length,"page":start,"classNames":"bcpg:rawMaterial"}, 
			 	"username":"admin",
				"password":"becpg",
				"crossDomain":true,
				"success": function (data,textStatus,xmlHttpRequest) {
						var jData = $( data );							
						var json = {"sEcho": params["sEcho"],"aaData" : []};
						json.iTotalRecords = jData[0].fullListSize;
						json.iTotalDisplayRecords = jData[0].pageSize;
				

						for(var i in jData[0].result){
						json.aaData.push([
								
								jData[0].result[i].name,
								jData[0].result[i].value
							]);
						}

						fnCallback(json);
					
				}
			} );					
	}
   
   
	$(document).ready(function() {

		var recipe = [];
		 
		var oTable;
       		oTable =  $('#rawMaterial').dataTable( {
			"bServerSide": true,
			"sAjaxSource": "/alfresco/service/becpg/autocomplete/product",
			"bSort": false,
			"bPaginate": true,
			"sPaginationType": "full_numbers",
			"bStateSave": true,
			"aoColumnDefs": [ 
			   {
			  "fnRender": function ( oObj ) {
			    return '<input type="text" size="3" id="value_'+oObj.aData[1]+'" /><select  id="unit_'+oObj.aData[1]+'" ><option value="kg">kg</option><option value="g">g</option><option value="L">L</option><option value="mL">mL</option><option value="P">P</option><option value="m">m</option><option value="m2">m2</option></select><input id="button_'+oObj.aData[1]+'" type="button" value="ajouter"/>';
			  },
			  "aTargets": [ 1 ]
			  }
			],			
			"fnServerData": fnGetJSONData
		} );

              
		$('#rawMaterial tbody tr input[type="button"]').live('click', function () {
			var id = this.id.replace("button_","");
			var unit = $('#unit_'+id).val();
			var value = $('#value_'+id).val();
			recipe.push({id:id,value:value,unit:unit});
			$('#recipe_container').append('<span class="ing">'+id+'-'+value+'('+unit+')'+'</span>');
		    } );


	} );


	


    -->
    </script>
</head>
<body>
	<div id="page-wrapper">
		<div id="page">
			<div id="header">
				<div class="section clearfix">
					<a id="logo" rel="home" title="Accueil" href="/fr"> <img
						alt="Accueil"
						src="http://www.becpg.fr/sites/all/themes/becpg/logo.png">
					</a>
					<div id="name-and-slogan">
						<div id="site-slogan">le PLM au service des biens de grande
							consommation</div>
					</div>
				</div>
			</div>
			<div id="main-wrapper">
				<h1>Calculateur nutritionnelle (Ciqual 2008)</h1>
				<div id="ings">
					<h2>Ingr&eacute;dients</h2>
					<table class="display" id="rawMaterial">
						<thead>
							<tr>
								<th width="75%">Ingr&eacute;dient</th>
								<th width="35%">Quantit&eacute;</th>
							</tr>
						</thead>
						<tbody >
							<tr>
								<td colspan="2" class="dataTables_empty">Chargement ...</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="section-wrapper">
					<div id="recipe">
						<h2>Ma recette</h2>
						<div id="recipe_container"></div>
					</div>
					<div id="nuts">
						<h2>Fiche nutritionnelle</h2>
						<table cellspacing="0" id="nuts_tab">
							<thead>
								<tr>
									<th class="selection" colspan="2">Votre s&eacute;lection</th>
									<th><acronym title="Apport Journalier Recommand&eacute">AJR/RNJ*</acronym></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th title="nut_title">
									<td><span class="qte">796 Kcal</span>
										<div class="jauge">
											<div
												style="font-size: 0; background-color: #48c442; height: 100%; width: 85%"></div>
										</div></td>
									<td>2250 Kcal</td>
								</tr>
							</tbody>
						</table>
						<p class="notes">* Apport Journalier Recommand&eacute; /
							Rep&egravere; Nutritionnel Journalier</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
