(function(){var c=YAHOO.util.Dom,b=YAHOO.Bubbling;beCPG.component.DesignerForm=function(l){beCPG.component.DesignerForm.superclass.constructor.call(this,"beCPG.component.DesignerForm",l,["button","container"]);YAHOO.Bubbling.on("designerModelNodeChange",this.onDesignerModelNodeChange,this);YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);YAHOO.Bubbling.on("elementDragOver",this.onElementDragOver,this);YAHOO.Bubbling.on("elementDragOut",this.onElementDragOut,this);YAHOO.Bubbling.on("dropTargetOwnerRequest",this.onDropTargetOwnerRequest,this);return this};YAHOO.extend(beCPG.component.DesignerForm,Alfresco.component.Base,{options:{documentHeight:null},currentNode:null,tree:null,onReady:function f(){this.modules.dataGrid=Alfresco.util.ComponentManager.findFirst("beCPG.module.EntityDataGrid");this.show()},show:function e(){if(this.currentNode!=null){var r,q,o,n,l=c.get(this.id+"-dnd-instructions");YAHOO.Bubbling.fire("formContainerDestroyed");if(l.hasChildNodes()){while(l.childNodes.length>=1){l.removeChild(l.firstChild)}}if(this.currentNode.accepts.length>0){var p=null;switch(this.currentNode.itemType){case"m2:type":case"dsg:fields":case"m2:aspect":case"m2:properties":case"m2:propertyOverrides":p="type";break;case"m2:associations":case"m2:childAssociations":case"m2:association":case"m2:childAssociation":p="association";break;case"dsg:form":case"dsg:formSet":case"dsg:sets":p="form";break;case"dsg:formField":p="field";break;case"dsg:config":case"dsg:configElements":p="config";break}o=c.get(this.id+"-dnd-instructions-"+p);n=o.cloneNode(true);n.id=this.id+"-dropZone";c.removeClass(n,"hidden");c.addClass(n,"elementDroppable");c.addClass(n,"elementDroppableHighlights");l.appendChild(n);var m=new YAHOO.util.DDTarget(n);for(i in this.currentNode.accepts){m.addToGroup(this.currentNode.accepts[i])}}if(this.currentNode.subType!=null){c.setStyle(this.id+"-model-form","display","none");c.setStyle("modelFormDataGridDiv","display","block");if(this.modules.dataGrid){this.modules.dataGrid.setOptions({entityNodeRef:this.tree.modelNodeRef});b.fire("activeDataListChanged",{dataList:{title:this.currentNode.entityTitle,description:this.currentNode.description,nodeRef:this.currentNode.nodeRef,entityName:this.currentNode.name,itemType:this.currentNode.subType,name:"designerList"},scrollTo:true})}}else{c.setStyle("modelFormDataGridDiv","display","none");c.setStyle(this.id+"-model-form","display","block");r=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&showCancelButton=false",{itemKind:"node",itemId:this.currentNode.nodeRef,mode:"edit",submitType:"json",entityNodeRef:this.tree.modelNodeRef});q={htmlid:this.id};Alfresco.util.Ajax.request({url:r,dataObj:q,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load dialog template from '"+this.options.templateUrl+"'.",scope:this,execScripts:true})}}return this},onDesignerModelNodeChange:function d(m,l){var n=l[1];if(n!=null&&n.node!=null&&n.node.nodeRef!=null){this.currentNode=n.node;this.tree=n.tree;this.show()}else{var o=c.get(this.id+"-model-form");o.innerHTML=this.msg("model.please-select")}},onTemplateLoaded:function a(l){var m=c.get(this.id+"-model-form");if(m.hasChildNodes()){while(m.childNodes.length>=1){m.removeChild(m.firstChild)}}m.innerHTML=l.serverResponse.responseText},onBeforeFormRuntimeInit:function j(n,m){if(m[1].eventGroup==this.id+"-form"){var o=m[1].runtime;this.form=o;this.form.setAJAXSubmit(true,{successCallback:{fn:function l(p){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.save-element.success")})},scope:this},failureCallback:{fn:function l(p){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.save-element.failure")})},scope:this}})}},onElementDragOver:function h(n,m){if(m&&m[1]&&m[1].elementId){var l=c.get(m[1].elementId);c.addClass(l,"elementDragOverHighlight")}},onElementDragOut:function g(n,m){if(m&&m[1]&&m[1].elementId){var l=c.get(m[1].elementId);c.removeClass(l,"elementDragOverHighlight")}},onDropTargetOwnerRequest:function k(m,l){if(l&&l[1]&&l[1].elementId){var p=this.currentNode;if(p!=null){this.onElementDragOut(m,l);var o=p.nodeRef;var n=p.itemType;if(p.subType!=null){n=p.subType}l[1].callback.call(l[1].scope,o,n,this.tree)}}}})})();