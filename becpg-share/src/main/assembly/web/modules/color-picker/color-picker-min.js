(function(){var d=YAHOO.util.KeyListener;beCPG.module.ColorPicker=function(i){this.name="beCPG.module.ColorPicker";this.id=i;var h=Alfresco.util.ComponentManager.get(this.id);if(h!==null){throw new Error("An instance of beCPG.module.ColorPicker already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container"],this.onComponentsLoaded,this);return this};beCPG.module.ColorPicker.prototype={defaultShowConfig:{fieldId:null,nodeRefs:null,itemType:null,selectedColor:null},showConfig:{},widgets:{},onComponentsLoaded:function f(){if(this.id===null){return}},show:function b(h){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,h);if(this.widgets.panel){this.updateConfig();this._showPanel()}else{Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/color-picker/color-picker?htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load html template for properties viewer",execScripts:true});this.widgets.escapeListener=new d(document,{keys:d.KEY.ESCAPE},{fn:this.onCancelButtonClick,scope:this,correctScope:true})}},onTemplateLoaded:function c(j){var m=document.createElement("div");m.innerHTML=j.serverResponse.responseText;var k=YAHOO.util.Dom.getFirstChild(m);this.widgets.panel=Alfresco.util.createYUIPanel(k,{draggable:true,width:"15.2em"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",this.onOkButtonClick);var l=this;var i=function(p){if(l!=null){var n=YAHOO.util.Dom.getStyle(this,"backgroundColor").match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(n){function q(t){var s=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");var r=t&15;var u=(t>>4)&15;return""+s[u]+s[r]}function o(u,t,s){return"#"+q(u)+q(t)+q(s)}rgb=o(n[1],n[2],n[3]);YAHOO.util.Dom.get(l.id+"-hexValue").value=rgb;YAHOO.util.Dom.setStyle(l.id+"-hexValue","backgroundColor",rgb)}}};var h=YAHOO.util.Selector.query("div.jfk-palette-colorswatch");YAHOO.util.Event.on(h,"click",i);this.updateConfig();this._showPanel()},updateConfig:function(){var h="#FFFFF";if(this.showConfig.fieldId){h=YAHOO.util.Dom.get(this.showConfig.fieldId).value}else{if(this.showConfig.selectedColor){h=this.showConfig.selectedColor}}YAHOO.util.Dom.get(this.id+"-hexValue").value=h;YAHOO.util.Dom.setStyle(this.id+"-hexValue","backgroundColor",h)},onOkButtonClick:function e(){if(this.showConfig.fieldId){YAHOO.util.Dom.get(this.showConfig.fieldId).value=YAHOO.util.Dom.get(this.id+"-hexValue").value}else{if(this.showConfig.nodeRefs){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"becpg/bulkedit/type/"+this.showConfig.itemType.replace(":","_")+"/bulksave?nodeRefs="+this.showConfig.nodeRefs.join(),dataObj:{prop_bcpg_color:YAHOO.util.Dom.get(this.id+"-hexValue").value},requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(h){if(h.json){YAHOO.Bubbling.fire("refreshDataGrids")}},scope:this},failureMessage:"Cannot update color"})}}this.onCancelButtonClick()},onCancelButtonClick:function a(){this.widgets.panel.hide();this.widgets.escapeListener.disable()},_showPanel:function g(){this.widgets.escapeListener.enable();this.widgets.panel.show()}}})();beCPG.module.getColorPickerInstance=function(){var a="becpg-color-picker-instance";return Alfresco.util.ComponentManager.get(a)||new beCPG.module.ColorPicker(a)};