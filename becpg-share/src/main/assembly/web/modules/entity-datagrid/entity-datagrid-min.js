(function(){var U=YAHOO.util.Dom,S=YAHOO.util.Event,G=YAHOO.util.Selector,v=YAHOO.Bubbling;var O=Alfresco.util.encodeHTML,j=Alfresco.util.activateLinks;beCPG.module.EntityDataGrid=function(ad,ae){beCPG.module.EntityDataGrid.superclass.constructor.call(this,"beCPG.module.EntityDataGrid",ad,["button","container","datasource","datatable","paginator","animation","history"]);this.rendererHelper=beCPG.module.EntityDataRendererHelper;this.datalistMeta={};this.datalistColumns={};this.dataRequestFields=[];this.dataResponseFields=[];this.currentPage=1;this.showingMoreActions=false;this.currentFilter={filterId:"all",filterData:""};this.selectedItems={};this.afterDataGridUpdate=[];this.extraAfterDataGridUpdate=[];this.scopeId="";if(ae){this.scopeId=ad}v.on("activeDataListChanged",this.onActiveDataListChanged,this);v.on("dataListDetailsUpdated",this.onDataListDetailsUpdated,this);v.on("refreshDataGrids",this.onDataGridRefresh,this);v.on("versionChangeFilter",this.onChangeFilter,this);v.on(this.scopeId+"columnRenamed",this.onColumnRenamed,this);v.on(this.scopeId+"scopedActiveDataListChanged",this.onActiveDataListChanged,this);v.on(this.scopeId+"userAccess",this.onUserAccess,this);v.on(this.scopeId+"filterChanged",this.onFilterChanged,this);v.on(this.scopeId+"changeFilter",this.onChangeFilter,this);v.on(this.scopeId+"dataItemCreated",this.onDataItemCreated,this);v.on(this.scopeId+"dataItemUpdated",this.onDataItemUpdated,this);v.on(this.scopeId+"dataItemsDeleted",this.onDataItemsDeleted,this);v.on(this.scopeId+"dataItemsDuplicated",this.onDataGridRefresh,this);v.on(this.scopeId+"refreshDataGrid",this.onDataGridRefresh,this);v.on(this.scopeId+"selectedItemsChanged",this.onSelectedItemsChanged,this);v.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);this.deferredListPopulation=new Alfresco.util.Deferred(["onReady","onActiveDataListChanged"],{fn:this.populateDataGrid,scope:this});return this};YAHOO.extend(beCPG.module.EntityDataGrid,Alfresco.component.Base);YAHOO.lang.augmentProto(beCPG.module.EntityDataGrid,beCPG.module.EntityDataGridActions);YAHOO.lang.augmentObject(beCPG.module.EntityDataGrid.prototype,{options:{siteId:"",usePagination:false,displayBottomPagination:true,useFilter:false,filterParameters:[],sortable:false,localSort:false,sortUrl:null,initialPage:1,pageSize:50,initialFilter:{},actionsPopupTimeout:500,loadingMessageDelay:1000,splitActionsAt:1,entityNodeRef:"",extraParams:null,list:"",dataUrl:Alfresco.constants.PROXY_URI+"slingshot/datalists/data/node/",itemUrl:Alfresco.constants.PROXY_URI+"slingshot/datalists/item/node/",columnsUrl:Alfresco.constants.URL_SERVICECONTEXT+"module/entity-datagrid/config/columns",saveFieldUrl:null,itemType:null,groupBy:null,sortId:null,groupFormater:null,hiddenColumns:[],hiddenOnlyColumns:[],extraDataParams:"&repo=true",formWidth:"34em",initHistoryManager:true,useHistoryManager:true,forceLoad:false,postMethod:true,columnFormId:null,filterFormId:"filter",floatingHeader:!(YAHOO.env.ua.ie>0),configurableColumns:true},currentPage:null,currentSort:null,currentSortDir:null,queryExecutionId:null,currentFilter:null,selectedItems:null,allPages:false,currentActionsMenu:null,showingMoreActions:null,deferredActionsMenu:null,afterDataGridUpdate:null,extraAfterDataGridUpdate:null,datalistMeta:null,entity:null,datalistColumns:null,dataRequestFields:null,dataResponseFields:null,rendererHelper:null,scopeId:"",formsFilterRuntime:null,fnRenderCellSelected:function t(){var ad=this;return function ae(ah,ag,ai,aj){U.setStyle(ah,"width",ai.width+"px");U.setStyle(ah.parentNode,"width",ai.width+"px");var af=ag.getData("permissions").userAccess;if(ad.options.sortable){if(af.sort){YAHOO.util.Dom.addClass(ah.parentNode,"datagrid-sort-handle")}}if(af.select===undefined||af.select===null||af.select){ah.innerHTML='<input class="dt-check" id="checkbox-'+ag.getId()+'" type="checkbox" name="fileChecked" value="'+aj+'"'+(ad.selectedItems[aj]?' checked="checked">':">")+'<label class="dt-check" for="checkbox-'+ag.getId()+'"></label>'}}},fnRenderCellSelectedHeader:function M(){this.timeStampId=(new Date()).getTime();var ad="";ad+='<div id="'+this.id+"-"+this.timeStampId+'itemSelect-div" class="item-select hidden">';ad+='<button id="'+this.id+"-"+this.timeStampId+'itemSelect-button" name="datagrid-itemSelect-button">&nbsp;</button>';ad+='<div id="'+this.id+"-"+this.timeStampId+'itemSelect-menu" class="yuimenu">';ad+='   <div class="bd">';ad+="      <ul>";ad+='         <li><a href="#"><span class="selectAll">'+this.msg("menu.select.all")+"</span></a></li>";ad+='         <li><a href="#"><span class="selectInvert">'+this.msg("menu.select.invert")+"</span></a></li>";ad+='         <li><a href="#"><span class="selectNone">'+this.msg("menu.select.none")+"</span></a></li>";ad+='         <li><a href="#"><span class="selectAllPages">'+this.msg("menu.select.allPages")+"</span></a></li>";ad+="      </ul>";ad+="   </div>";ad+=" </div>";ad+=" </div>";return ad},fnRenderCellActionsHeader:function y(){var ad="";if(this.options.configurableColumns){ad+='<div id="'+this.id+"-"+this.timeStampId+'columns-confContainerDiv" class="columns-conf">';ad+='<span class="yui-button yui-push-button" id="'+this.id+"-"+this.timeStampId+'columns-confButton">';ad+='   <span class="first-child">';ad+='         <button type="button"  id="'+this.id+"-"+this.timeStampId+'columns-confButton-button" title="'+this.msg("button.columns-conf.description")+'">&nbsp;</button>';ad+="   </span>";ad+="</span>";ad+="</div>"}return ad},fnRenderCellActions:function Z(){var ae=this;return function ad(ag,af,ah,ai){U.setStyle(ag,"width",ah.width+"px");U.setStyle(ag.parentNode,"width",ah.width+"px");ag.innerHTML='<div id="'+ae.id+"-actions-"+af.getId()+'" class="hidden"></div>'}},rowFormatter:function u(ad,ae){if(ae.getData("color")&&ae.getData("color").length>0&&ae.getData("color")!="000000"){U.setStyle(ad,"background-color",ae.getData("color"))}return true},_buildCellUrl:function X(ae){var af="document",ad=null;if(ae.metadata!=null&&ae.metadata.length){af=(ae.metadata=="container"?"folder":"document")}if(ae.siteId){ad=Alfresco.constants.URL_PAGECONTEXT+"site/"+ae.siteId+"/"+af+"-details?nodeRef="+ae.value}else{ad=Alfresco.constants.URL_PAGECONTEXT+af+"-details?nodeRef="+ae.value}return ad},onReady:function ab(){var ah=this;this.widgets.newRowButton=Alfresco.util.createYUIButton(this,"newRowButton",this.onActionCreate,{disabled:true,value:"create"});this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});var af=function aj(am,al){var ak=v.getOwnerByTagName(al[1].anchor,"div");if(ak!==null){if(typeof ah[ak.className]=="function"){al[1].stop=true;if(al[1].target&&ah.widgets.dataTable.getRecord(al[1].target.offsetParent)!=null){var an=ah.widgets.dataTable.getRecord(al[1].target.offsetParent).getData();ah[ak.className].call(ah,an,ak)}else{ah[ak.className].call(ah,ak,ak)}}}return true};v.addDefaultAction(ah.id+"-action-link",af);v.addDefaultAction(ah.id+"-show-more",af);var ai=function ad(am,al){var ak=al[1].anchor;if(ak!==null){var an=ak.rel,ao,ap={};if(an&&an!==""){al[1].stop=true;ao=an.split("|");ap={filterOwner:window.unescape(ao[0]||""),filterId:window.unescape(ao[1]||""),filterData:window.unescape(ao[2]||"").replace("$ML$","|"),filterDisplay:window.unescape(ao[3]||"")};v.fire(this.scopeId+"changeFilter",ap)}}return true};v.addDefaultAction("filter-change",ai);this.modules.actions=new Alfresco.module.DataListActions();this.modules.dataGrid=this;U.removeClass(this.id+"-selectListMessage","hidden");this.widgets.newRowButton.set("disabled",true);if(this.options.useFilter){this.widgets.filterFormSubmit=Alfresco.util.createYUIButton(this,"filterform-submit",this.onFilterFormSubmit);this.widgets.filterFormSubmit=Alfresco.util.createYUIButton(this,"filterform-clear",this.onFilterFormClear);this.widgets.filterForm=Alfresco.util.createYUIButton(this,"filterform-button",null,{type:"menu",menu:"filterform-panel",lazyloadmenu:false});this.widgets.filterForm.getMenu().subscribe("show",function(al,ak){ah.populateFilterForm()})}if(U.get("toolbar-contribs-"+this.id)){var ae=U.getChildren("toolbar-contribs-"+this.id);if(ae){for(var ag in ae){(new YAHOO.util.Element("toolbar-contribs")).appendChild(ae[ag])}}}this.deferredListPopulation.fulfil("onReady");if(this.options.forceLoad){this.populateDataGrid()}U.setStyle(this.id+"-body","visibility","visible")},onHistoryManagerReady:function g(){v.fire(this.scopeId+"changeFilter",YAHOO.lang.merge({datagridFirstTimeNav:true},this.options.initialFilter))},_onDataListFailure:function P(af,ae){Alfresco.util.PopupManager.displayPrompt({title:ae.title,text:ae.text,modal:true,buttons:[{text:this.msg("button.ok"),handler:function ad(){this.destroy()},isDefault:true}]})},renderDataListMeta:function f(){if(!YAHOO.lang.isObject(this.datalistMeta)||!this.datalistMeta.title){return}Alfresco.util.populateHTML([this.id+"-title",O(this.datalistMeta.title)],[this.id+"-description",j(O(this.datalistMeta.description,true))])},populateDataGrid:function r(){if(!YAHOO.lang.isObject(this.datalistMeta)){return}this.renderDataListMeta();Alfresco.util.Ajax.jsonGet({url:this._getColumnUrl(this.options.columnFormId),successCallback:{fn:this.onDatalistColumns,scope:this},failureCallback:{fn:this._onDataListFailure,obj:{title:this.msg("message.error.columns.title"),text:this.msg("message.error.columns.description")},scope:this}})},_getColumnUrl:function(ad){return this.options.columnsUrl+"?itemType="+encodeURIComponent(this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType)+"&list="+encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)+(ad!=null?"&formId="+ad:"")+(this.options.extraDataParams.indexOf("&clearCache=true")<0?"":this.options.extraDataParams)+(this.options.siteId?"&siteId="+this.options.siteId:"")},populateFilterForm:function A(){if(!this.isFilterFormLoaded){var ae=this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list;this.isFilterFormLoaded=true;var ad=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"module/entity-datagrid/filter/form?itemKind={itemKind}&siteId={siteId}&list={list}&itemId={itemId}&formId={formId}&submitType=json&showCancelButton=false&showCaption=false&showSubmitButton=false"+((this.options.entityNodeRef!=null&&this.options.entityNodeRef.length>0)?"&entityNodeRef="+this.options.entityNodeRef:""),{itemKind:"type",itemId:this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType,formId:this.options.filterFormId!=null?this.options.filterFormId:"filter",siteId:this.options.siteId,list:ae});Alfresco.util.Ajax.request({url:ad,dataObj:{htmlid:this.id+"-filterForm"},successCallback:{fn:this.onFilterFormTemplateLoaded,scope:this},failureCallback:{fn:function(){this.isFilterFormLoaded=false;this.widgets.filterForm.set("disabled",true)},scope:this},scope:this,execScripts:true})}},onFilterFormTemplateLoaded:function c(ad){U.get(this.id+"-filterform").innerHTML=ad.serverResponse.responseText;this.widgets.filterForm.set("disabled",false)},onFilterFormSubmit:function ac(){v.fire(this.scopeId+"changeFilter",{filterOwner:this.id,filterId:"filterform",filterData:YAHOO.lang.JSON.stringify(this.cleanFilterData(this.formsFilterRuntime.getFormData())).replace("|","$ML$")});this.widgets.filterForm.getMenu().hide()},onFilterFormClear:function w(){v.fire(this.scopeId+"changeFilter",{filterOwner:this.id,filterId:"all"});this.formsFilterRuntime.reset();this.widgets.filterForm.getMenu().hide()},cleanFilterData:function K(af){var ad={};if(af!=null){for(var ae in af){if(af[ae].length>0){ad[ae]=af[ae]}}}return ad},onBeforeFormRuntimeInit:function W(ae,ad){if(this.formsFilterRuntime==null&&ad[1].eventGroup==this.id+"-filterForm-form"){var af=this;this.formsFilterRuntime=ad[1].runtime;this.formsFilterRuntime.validations=[];this.formsFilterRuntime.ajaxSubmit=true;this.formsFilterRuntime._submitInvoked=function(){af.onFilterFormSubmit();return false}}},onDatalistColumns:function N(ad){this.datalistColumns=ad.json.columns;this._setupHistoryManagers();this._setupDataSource();this._setupDataTable();U.addClass(this.id+"-selectListMessage","hidden");this.widgets.newRowButton.set("disabled",false);v.fire(this.scopeId+"onDatalistColumnsReady",{entityDatagrid:this});if(this.options.useHistoryManager){YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true)}else{this.onHistoryManagerReady.call(this)}},_setupHistoryManagers:function o(){var aj=YAHOO.util.History.getBookmarkedState(this.scopeId+"filter");aj=aj===null?"all":(YAHOO.env.ua.gecko>0)?aj:window.escape(aj);try{while(aj!=(aj=decodeURIComponent(aj))){}}catch(ai){}var ah=function ad(ak){var al=ak.split("|"),am={filterId:window.unescape(al[0]||""),filterData:window.unescape((al[1]||"")).replace("$ML$","|")};am.filterOwner=Alfresco.util.FilterManager.getOwner(am.filterId);return am};this.options.initialFilter=ah(aj);YAHOO.util.History.register(this.scopeId+"filter",aj,function ag(ak){if(YAHOO.env.ua.gecko>0){ak=window.unescape(ak)}this._updateDataGrid.call(this,{filter:ah(ak)})},null,this);if(this.options.initHistoryManager&&this.options.useHistoryManager){try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(af){var ae=args[1];if((ae!==null)&&(ae.entityDataGridModule!==null)){ae.entityDataGridModule.onHistoryManagerReady()}}}else{v.fire("dataGridReady",{entityDataGridModule:this})}},onFilterChanged:function a(ae,ad){var af=ad[1];if((af!==null)&&(af.filterId!==null)){af.filterOwner=af.filterOwner||Alfresco.util.FilterManager.getOwner(af.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(af)}},_setupDataSource:function i(){var ak=this;this.dataRequestFields=[];this.dataResponseFields=[];for(var ah=0,aj=this.datalistColumns.length;ah<aj;ah++){var ai=this.datalistColumns[ah],af=ai.name.replace(":","_"),ae=(ai.type=="property"?"prop":"assoc");if(ai.dataType=="nested"&&ai.columns){ae="dt";ae+="_"+af;for(var ag=0;ag<ai.columns.length;ag++){af+="|"+ai.columns[ag].name.replace(":","_")}}else{ae+="_"+af}this.dataRequestFields.push(af);this.dataResponseFields.push(ae);this.datalistColumns[ae]=ai}this.widgets.dataSource=new YAHOO.util.DataSource(ak._getDataUrl(),{connMethodPost:ak.options.postMethod,responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{startIndex:"startIndex",totalRecords:"totalRecords",queryExecutionId:"queryExecutionId"}}});if(ak.options.postMethod){this.widgets.dataSource.connMgr.setDefaultPostHeader(Alfresco.util.Ajax.JSON)}this.widgets.dataSource.doBeforeCallback=function ad(an,al,ao){var am=al.metadata.parent.permissions;if(am&&am.userAccess){v.fire(ak.scopeId+"userAccess",{userAccess:am.userAccess})}return ao}},_getDataUrl:function(ad){var ae=this.datalistMeta.nodeRef!=null?new Alfresco.util.NodeRef(this.datalistMeta.nodeRef):null;return this.options.dataUrl+(ae!=null?ae.uri:"")+((this.options.entityNodeRef!=null&&this.options.entityNodeRef.length>0)?"?entityNodeRef="+this.options.entityNodeRef+"&":"?")+"itemType="+encodeURIComponent(this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType)+"&dataListName="+encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)+"&pageSize="+(ad!=null?ad:this.options.pageSize)+"&site="+this.options.siteId+this._buildSortParam()+this.options.extraDataParams},_setupDataTable:function k(){var au=this;var ao=[{key:"nodeRef",label:this.fnRenderCellSelectedHeader(),sortable:false,formatter:this.fnRenderCellSelected(),width:16}];delete au.widgets.itemSelect;for(var an=0,aj=this.datalistColumns.length;an<aj;an++){var ae=this.datalistColumns[an];var aw=this.dataResponseFields[an];if(this.options.hiddenColumns.length<1||!beCPG.util.contains(this.options.hiddenColumns,aw)){var ai={key:aw,label:ae.label=="hidden"?"":ae.label,hidden:ae.label=="hidden"||(beCPG.util.contains(this.options.hiddenOnlyColumns,aw)),sortable:(ae.type=="property"),sortOptions:{field:ae.formsName,sortFunction:this.rendererHelper.getSortFunction()},formatter:this.rendererHelper.getCellFormatter(this),editor:this.options.saveFieldUrl!=null?this.rendererHelper.getCellEditor(this,ae,this.options.saveFieldUrl):null};if(ae.options!=null){try{var ad=YAHOO.lang.JSON.parse(ae.options);if(ad){for(var aw in ad){ai[aw]=ad[aw]}}}catch(ap){console.log("ERROR cannot parse options: "+ae.options)}}else{if(ae.label=="hidden"||(beCPG.util.contains(this.options.hiddenOnlyColumns,aw))){ai.width=0}}ao.push(ai)}}ao.push({key:"actions",label:this.fnRenderCellActionsHeader(),sortable:false,formatter:this.fnRenderCellActions(),width:40});delete au.widgets.columnConfigurer;if(!YAHOO.widget.GroupedDataTable){YAHOO.widget.GroupedDataTable=YAHOO.widget.DataTable}var af={initialLoad:false,dynamicData:false,MSG_EMPTY:this.msg("message.empty"),MSG_ERROR:this.msg("message.error"),MSG_NOGROUP:this.msg("message.nogroup"),MSG_SORTASC:this.msg("message.sortasc"),MSG_SORTDESC:this.msg("message.sortdesc"),paginator:null,groupBy:this.options.groupBy,groupFormater:this.options.groupFormater,formatRow:this.rowFormatter};if(this.options.saveFieldUrl!=null){af.selectionMode="singlecell"}this.widgets.dataTable=new YAHOO.widget.GroupedDataTable(this.id+"-grid",ao,this.widgets.dataSource,af);if(this.options.usePagination){var aq=[this.id+"-paginator"];if(this.options.displayBottomPagination){aq.push(this.id+"-paginatorBottom")}this.widgets.paginator=new YAHOO.widget.Paginator({containers:aq,rowsPerPage:this.options.pageSize,initialPage:this.options.initialPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});var al=function ar(ay,ax){ax.currentPage=ay.page;ax._updateDataGrid.call(ax,{page:ay.page})};this.widgets.paginator.subscribe("changeRequest",al,this);if(this.options.displayBottomPagination){U.setStyle(this.id+"-datagridBarBottom","display","block")}if(!this.widgets.paginator.getContainerNodes().length){this.widgets.paginator.set("containers",this.widgets.dataTable._defaultPaginatorContainers(true))}this.widgets.paginator.render()}this.widgets.dataTable.handleDataReturnPayload=function ag(ay,ax,az){if(au.widgets.paginator){au.widgets.paginator.set("totalRecords",ax.meta.totalRecords);au.widgets.paginator.setPage(ax.meta.startIndex,true);if(au.currentSort!=null){au.widgets.dataTable.set("sortedBy",{key:au.currentSort,dir:au.currentSortDir})}if(ax.meta.totalRecords>au.options.pageSize){U.removeClass(au.id+"-paginator","hidden");if(au.options.displayBottomPagination){U.removeClass(au.id+"-paginatorBottom","hidden")}}else{U.addClass(au.id+"-paginator","hidden");if(au.options.displayBottomPagination){U.addClass(au.id+"-paginatorBottom","hidden")}}}au.totalRecords=ax.meta.totalRecords;au.queryExecutionId=ax.meta.queryExecutionId;return ax.meta};this.widgets.dataTable.doBeforeLoadData=function ah(ay,az,aB){if(!az||az.error){try{var ax=YAHOO.lang.JSON.parse(az.responseText);au.widgets.dataTable.set("MSG_ERROR",ax.message)}catch(aA){au._setDefaultDataTableErrors(au.widgets.dataTable)}}if(az.results.length===0){this.fireEvent("renderEvent",{type:"renderEvent"})}return true};this.widgets.dataTable.doBeforeSortColumn=function av(aB,ay){if(!au.options.localSort){if(aB.key.indexOf("prop_")==0){au.currentSort=aB.key;au.currentSortDir=ay;au.currentPage=1;au.queryExecutionId=null;au._updateDataGrid.call(au);return false}else{au.currentSort=null;return true}}else{au.currentSort={oColumn:aB,sSortDir:ay};var aC=this.get("sortedBy")||{};var az=(aC.key===aB.key)?true:false;var aA=(aB.sortOptions&&YAHOO.lang.isFunction(aB.sortOptions.sortFunction))?aB.sortOptions.sortFunction:null;if(!az||aA){aA=aA||this.get("sortFunction");var ax=(aB.sortOptions&&aB.sortOptions.field)?aB.sortOptions.field:aB.field;this._oRecordSet.sortRecords(aA,((ay==YAHOO.widget.DataTable.CLASS_DESC)?true:false),ax)}else{this._oRecordSet.reverseRecords()}this.render();this.set("sortedBy",{key:aB.key,dir:ay,column:aB});return false}};this.widgets.dataTable.subscribe("checkboxClickEvent",function(ax){var ay=ax.target.value;this.selectedItems[ay]=ax.target.checked;v.fire(this.scopeId+"selectedItemsChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function(){if(this.widgets.columnConfigurer==null){this.widgets.columnConfigurer=Alfresco.util.createYUIButton(this,au.timeStampId+"columns-confButton",this.onActionColumnConf)}var az=false;for(var aB=0,aC=this.widgets.dataTable.getColumnSet().keys,ay=aC.length;aB<ay;aB++){if(aC[aB].showAfterRenderSize){if(aC[aB].width!=aC[aB].showAfterRenderSize){az=true}this.widgets.dataTable.setColumnWidth(aC[aB],aC[aB].showAfterRenderSize);U.setStyle(aC[aB]._elTh,"width",aC[aB].showAfterRenderSize+"px");aC[aB].showAfterRenderSize=null}if(aC[aB].showAfterRender==true){this.widgets.dataTable.showColumn(aC[aB]);aC[aB].showAfterRender=null}if(aC[aB].hideAfterRender==true){this.widgets.dataTable.hideColumn(aC[aB]);aC[aB].hideAfterRender=null}}if(this.options.floatingHeader){require(dojoConfig,["jquery","floatthead"],function(aD){try{if(aD&&aD.floatThead){if(!au.widgets.floatingHeader||!au.widgets.floatingHeader.floatThead){au.widgets.floatingHeader=aD(au.widgets.dataTable._elTable);au.widgets.floatingHeader.floatThead({zIndex:2,scrollContainer:function(aF){return au.widgets.floatingHeader.closest(".scrollableList")},floatContainerClass:"floatThead-container grid yui-dt"})}else{if(az){au.widgets.floatingHeader.floatThead("destroy");au.widgets.floatingHeader=aD(au.widgets.dataTable._elTable);au.widgets.floatingHeader.floatThead({zIndex:2,scrollContainer:function(aF){return au.widgets.floatingHeader.closest(".scrollableList")},floatContainerClass:"floatThead-container grid yui-dt"})}else{au.widgets.floatingHeader.floatThead("reflow")}}}}catch(aE){}})}if(this.widgets.itemSelect==null){this.widgets.itemSelect=Alfresco.util.createYUIButton(this,au.timeStampId+"itemSelect-button",this.onItemSelect,{type:"menu",menu:au.timeStampId+"itemSelect-menu",disabled:false});U.removeClass(au.id+"-"+au.timeStampId+"itemSelect-div","hidden");if(this.options.floatingHeader){this.widgets.itemSelect.getMenu().subscribe("show",function(){var aD=YAHOO.util.Selector.query("div.floatThead-container");U.addClass(aD,"itemSelect-open")},this.widgets.itemSelect,this);this.widgets.itemSelect.getMenu().subscribe("hide",function(){var aD=YAHOO.util.Selector.query("div.floatThead-container");U.removeClass(aD,"itemSelect-open")},this.widgets.itemSelect,this)}}if(YAHOO.env.ua.ie<7){var ax=this.widgets.dataTable.getTableEl().parentNode;ax.className=ax.className}for(var aB=0,aA=this.extraAfterDataGridUpdate.length;aB<aA;aB++){this.extraAfterDataGridUpdate[aB].call(this)}for(var aB=0,aA=this.afterDataGridUpdate.length;aB<aA;aB++){this.afterDataGridUpdate[aB].call(this)}this.afterDataGridUpdate=[]},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);if(this.options.saveFieldUrl!=null){var am=function(ay){var aA=ay.target;var ax=au.widgets.dataTable.getTdEl(aA);if(ax){var az=au.widgets.dataTable.getTdEl(ax);if(U.hasClass(az,YAHOO.widget.DataTable.CLASS_SELECTED)){au.widgets.dataTable.onEventShowCellEditor(ay)}}};this.widgets.dataTable.subscribe("cellClickEvent",function(ay){var ax=au.widgets.dataTable.getColumn(ay.target);if(ax.editor!=null){au.widgets.dataTable.focus();am(ay);au.widgets.dataTable.onEventSelectCell(ay)}});this.widgets.dataTable.subscribe("tbodyKeyEvent",function(ay){var ax=S.getCharCode(ay.event);if((ax>47&&ax<90)||(ax>95&&ax<106)){am({target:this.getLastSelectedCell()})}});this.widgets.dataTable.subscribe("cellSelectEvent",this.widgets.dataTable.clearTextSelection)}if(this.options.sortable){var at="group-"+au.id;au.widgets.dataTable.dtdTargets={};var ak=function(aD){if(au.widgets.dataTable.getRecord(S.getTarget(aD))!=null){var ay=au.widgets.dataTable.getRecord(S.getTarget(aD)).getData("permissions").userAccess;if(ay.sort){var aC=au.widgets.dataTable.getTrEl(S.getTarget(aD)),aB=null,aE=new YAHOO.util.DDProxy(aC.id,at),ax=null,aA=null,az=null;aE.handleMouseDown(aD.event);aE.startDrag=function(){ax=this.getDragEl();aA=this.getEl();srcIndex=aA.sectionRowIndex;U.setStyle(aA,"visibility","hidden");ax.innerHTML="<table><tbody>"+aA.innerHTML+"</tbody></table>"};aE.endDrag=function(aG,aJ){U.setStyle(ax,"visibility","hidden");U.setStyle(aA,"visibility","");if(au.options.sortUrl){var aF=au.widgets.dataTable.getRecord(aB);if(aF!=null){dstData=aF.getData();srcData=au.widgets.dataTable.getRecord(aA).getData();if(dstData&&srcData){var aH=au.options.sortUrl+"/"+dstData.nodeRef.replace(":/","")+"?selectedNodeRefs="+srcData.nodeRef;Alfresco.util.Ajax.jsonPost({url:aH,successCallback:{fn:function aI(aK){au.queryExecutionId=null;au._updateDataGrid.call(au,{page:au.currentPage})},scope:this},failureCallback:{fn:function aI(aK){Alfresco.util.PopupManager.displayMessage({text:au.msg("message.details.failure")})},scope:this}})}}}};aE.onDragOver=function(aF,aG){az=U.get(aG);if(az!=null&&az.nodeName.toLowerCase()==="tr"){aB=az.sectionRowIndex;U.addClass(aG,"elementDragOverHighlight")}};aE.onDragOut=function(aG,aH){var aF=U.get(aH);if(aF!=null&&aF.nodeName.toLowerCase()==="tr"){U.removeClass(aH,"elementDragOverHighlight")}}}}};this.widgets.dataTable.subscribe("cellMousedownEvent",ak);this.widgets.dataTable.subscribe("rowAddEvent",function(ax){if(ax.record){var ay=ax.record.getId();au.widgets.dataTable.dtdTargets[ay]=new YAHOO.util.DDTarget(ay,at)}});this.widgets.dataTable.subscribe("rowDeleteEvent",function(ax){if(ax.record){var ay=ax.record.getId();au.widgets.dataTable.dtdTargets[ay].unreg();delete au.widgets.dataTable.dtdTargets[ay]}})}if(this.options.floatingHeader){YAHOO.Bubbling.on("refreshFloatingHeader",function(){if(au.widgets.floatingHeader){au.widgets.floatingHeader.floatThead("reflow")}},this)}},onItemSelect:function h(ah,ag,af){var ad=ag[0],ae=ag[1];this.selectItems(Alfresco.util.findEventClass(ae));S.preventDefault(ad)},onEventHighlightRow:function d(aw){this.widgets.dataTable.onEventHighlightRow.call(this.widgets.dataTable,aw);var ae=U.get(this.id+"-actions-"+aw.target.id);if(ae&&ae.firstChild===null){var af=this.widgets.dataTable.getRecord(aw.target.id),ax=U.get(this.id+"-actionSet").cloneNode(true);ax.innerHTML=YAHOO.lang.substitute(window.unescape(ax.innerHTML),this.getActionUrls(af));ax.id=ae.id+"_a";U.addClass(ax,"simple");var ay=af.getData("permissions").userAccess,ak=af.getData("actionLabels")||{};ay["filter-"+this.currentFilter.filterId]=true;var al=YAHOO.util.Selector.query("div",ax),ao,ap,au,ad,ai,ar,am,aq,av;for(ar=0,am=al.length;ar<am;ar++){ao=al[ar];ap=ao.firstChild;au=ap.firstChild;if(au&&ak[ao.className]){au.innerHTML=O(ak[ao.className])}if(ap.rel!==""){ad=ap.rel.split(",");for(aq=0,av=ad.length;aq<av;aq++){ai=ad[aq];if((ai.charAt(0)=="~")?!!ay[ai.substring(1)]:!ay[ai]){ax.removeChild(ao);break}}}}var aj=this.options.splitActionsAt;al=YAHOO.util.Selector.query("div",ax);if(al.length>aj){var ag=U.get(this.id+"-moreActions").cloneNode(true);var at=YAHOO.util.Selector.query("div",ag);U.insertBefore(at[0],al[aj]);U.insertBefore(at[1],al[aj]);var an=al.slice(aj);for(var ah in an){if(an.hasOwnProperty(ah)){at[1].appendChild(an[ah])}}}ae.appendChild(ax)}if(this.showingMoreActions){this.deferredActionsMenu=ae}else{if(!U.hasClass(document.body,"masked")){this.currentActionsMenu=ae;U.removeClass(ae,"hidden");this.deferredActionsMenu=null}}},onEventUnhighlightRow:function e(ae){this.widgets.dataTable.onEventUnhighlightRow.call(this.widgets.dataTable,ae);var ad=U.get(this.id+"-actions-"+(ae.target.id));if(!this.showingMoreActions||U.hasClass(document.body,"masked")){U.addClass(ad,"hidden");this.deferredActionsMenu=null}},onCollapsedAndExpanded:function s(af,ae){var ah=ae.id.split("_")[2],ag="collapsed"===ae.id.split("_")[1],ad=Alfresco.constants.PROXY_URI+"becpg/entity/datalists/openclose?nodeRef="+ah+"&expand="+ag,ai=this;Alfresco.util.Ajax.jsonPost({url:ad,successCallback:{fn:function aj(ak){ai.queryExecutionId=null;ai._updateDataGrid.call(ai,{page:ai.currentPage})},scope:this}})},getActionUrls:function I(ae){var ad=YAHOO.lang.isFunction(ae.getData)?ae.getData():ae,af=ad.nodeRef;return({editMetadataUrl:"edit-dataitem?nodeRef="+af})},getSelectedItems:function q(){var ae=[],ah=this.widgets.dataTable.getRecordSet(),af=0,ai=ah.getLength(),ad;for(var ag=af;ag<=ai;ag++){ad=ah.getRecord(ag);if(ad!=null&&this.selectedItems[ad.getData("nodeRef")]){ae.push(ad.getData())}}return ae},selectItems:function x(ak){var aj=this.widgets.dataTable.getRecordSet(),ah=G.query('input[type="checkbox"]',this.widgets.dataTable.getTbodyEl()),ag=0,ae=ah.length,af,ai,ad;switch(ak){case"selectAll":case"selectAllPages":ad=function(al,am){return true};break;case"selectNone":ad=function(al,am){return false};break;case"selectInvert":ad=function(al,am){return !am};break;default:ad=function(al,am){return am}}if(ak=="selectAllPages"){this.allPages=true}else{this.allPages=false}for(ai=0;ai<ae;ai++){af=aj.getRecord(ai+ag);this.selectedItems[af.getData("nodeRef")]=ah[ai].checked=ad(af.getData("type"),ah[ai].checked)}v.fire(this.scopeId+"selectedItemsChanged")},onSelectedItemsChanged:function V(aj,al){if(this.allPages&&U.get(this.id+"-message")!=null){U.get(this.id+"-message").innerHTML='<span class="info">'+this.msg("message.edit.allPages",this.totalRecords)+"</span>";U.removeClass(this.id+"-message","hidden")}else{U.addClass(this.id+"-message","hidden")}var am=this.getSelectedItems(),ap,aq={},an,ae=this.widgets.selectedItems.getMenu().getItems(),ad,ag,ah,ai,ao,af;for(ai=0,ao=am.length;ai<ao;ai++){ap=am[ai];an=ap.permissions.userAccess;for(var ak in an){if(an.hasOwnProperty(ak)){aq[ak]=(aq[ak]===undefined?an[ak]:aq[ak]&&an[ak])}}}for(var ak in ae){if(ae.hasOwnProperty(ak)){ad=ae[ak];ah=false;af=true;if(ad.element.firstChild){if(ad.element.firstChild.rel&&ad.element.firstChild.rel!==""){ag=ad.element.firstChild.rel.split(",");for(ai=0,ao=ag.length;ai<ao;ai++){if(ag[ai]!="allPages"){if((!aq[ag[ai]])){ah=true;break}}else{af=false}}}if(this.allPages&&(this.queryExecutionId==null||af)){ah=true}ad.cfg.setProperty("disabled",ah)}}}this.widgets.selectedItems.set("disabled",(am.length===0))},onActionDeselectAll:function D(){this.selectItems("selectNone")},onUserAccess:function C(aj,al){var af=al[1];if(af&&af.userAccess){var ag,ao,an,ah;for(var ak in this.widgets){if(this.widgets.hasOwnProperty(ak)){ag=this.widgets[ak];if(ag.get&&ag.get("srcelement")!=null&&ag.get("srcelement").className!="no-access-check"){ag.set("disabled",false);if(typeof ag.get("value")=="string"){ao=ag.get("value").split(",");for(var ae=0,am=ao.length;ae<am;ae++){if(ao[ae].indexOf("|")!==-1){ah=false;an=ao[ae].split("|");for(var ad=0,ai=an.length;ad<ai;ad++){if(af.userAccess[an[ad]]){ah=true;ag.set("activePermission",an[ad],true);break}}if(!ah){ag.set("disabled",true);break}}else{if(!af.userAccess[ao[ae]]){ag.set("disabled",true);break}}}}}}}}},onSelectedItems:function H(ai,ah,ag){var ae=ah[0],af=ah[1];var ad=Alfresco.util.findEventClass(af);if(ad&&(typeof this[ad]=="function")){this[ad].call(this,this.getSelectedItems())}S.preventDefault(ae)},onActionShowMore:function aa(ae,ah){var aj=this;U.addClass(ah.firstChild,"highlighted");var am=U.getNextSibling(ah);U.removeClass(am,"hidden");aj.showingMoreActions=true;var al=function ak(){S.removeListener(am,"mouseover");S.removeListener(am,"mouseout");U.removeClass(ah.firstChild,"highlighted");U.addClass(am,"hidden");aj.showingMoreActions=false;if(aj.deferredActionsMenu!==null){U.addClass(aj.currentActionsMenu,"hidden");aj.currentActionsMenu=aj.deferredActionsMenu;aj.deferredActionsMenu=null;U.removeClass(aj.currentActionsMenu,"hidden")}};if(am.hideTimerId){window.clearTimeout(am.hideTimerId)}am.hideTimerId=window.setTimeout(al,aj.options.actionsPopupTimeout*4);var af=function ad(ao,an){if(an.hideTimerId){window.clearTimeout(an.hideTimerId);an.hideTimerId=null}};var ai=function ag(ap,ao){var aq=S.getTarget(ap);var an=aq.relatedTarget;if((an!==ao)&&(!U.isAncestor(ao,an))){if(ao.hideTimerId){window.clearTimeout(ao.hideTimerId)}ao.hideTimerId=window.setTimeout(al,aj.options.actionsPopupTimeout)}};S.on(am,"mouseover",af,am);S.on(am,"mouseout",ai,am)},onActiveDataListChanged:function l(af,ae){var ag=ae[1];if((ag!==null)){if(ag.dataList){if(this.datalistMeta!=null&&this.datalistMeta.name!=null){U.removeClass(this.id+"-body",this.datalistMeta.name);if(ag.dataList.name!=null){U.addClass(this.id+"-body",ag.dataList.name)}}this.datalistMeta=ag.dataList;if(ag.dataList.itemType!=null&&ag.force==true){this.options.itemType=ag.dataList.itemType}this.parentInputNodeRef=null}if(ag.extraDataParams!=null){this.options.extraDataParams=ag.extraDataParams}if(this.widgets.floatingHeader&&this.widgets.floatingHeader!=null){this.widgets.floatingHeader.floatThead("destroy");this.widgets.floatingHeader=null}if(ag.entity){this.entity=ag.entity}this.currentPage=1;this.queryExecutionId=null;this.isFilterFormLoaded=false;this.showingMoreActions=false;if(this.options.usePagination){this.currentPage=1}if(this.currentFilter!=null&&this.currentFilter.filterId!="all"){this.currentFilter={filterId:"all",filterData:""};var ad={};ad[this.scopeId+"filter"]="all";YAHOO.util.History.multiNavigate(ad)}this.selectedItems={};this.afterDataGridUpdate=[];this.extraAfterDataGridUpdate=[];if(this.formsFilterRuntime!=null){this.formsFilterRuntime.reset();this.formsFilterRuntime=null}if(this.widgets.filterForm!=null){this.widgets.filterForm.getMenu().hide()}if(ag.list!=null&&(this.options.list==null||this.options.list.length<1)){this.options.list=ag.list}if(!this.deferredListPopulation.fulfil("onActiveDataListChanged")){this.populateDataGrid()}}},onDataListDetailsUpdated:function R(ae,ad){var af=ad[1];if((af!==null)&&(af.dataList!==null)){this.dataListMeta=af.dataList;this.renderDataListMeta()}},onDataGridRefresh:function E(ae,ad){this.queryExecutionId=null;this._updateDataGrid.call(this,{page:this.currentPage,updateOnly:ad[1]!=null&&ad[1].updateOnly?ad[1].updateOnly:false,callback:ad[1]!=null&&ad[1].updateOnly?ad[1].callback:null})},onChangeFilter:function F(ag,af){var aj=af[1];if((aj!==null)&&(aj.filterId!==null)){var ai=Alfresco.util.cleanBubblingObject(aj),ah=YAHOO.lang.substitute("{filterId}|{filterData}",ai,function(al,am,ak){return typeof am=="undefined"?"":window.escape(am)}),ae=ah.split("|");if(ae[1].length===0){ah=ae[0]}if(this.options.usePagination){this.currentPage=1;this.queryExecutionId=null}if(aj.datagridFirstTimeNav||!this.options.useHistoryManager){this._updateDataGrid.call(this,{filter:ai,page:this.currentPage})}else{var ad={};ad[this.scopeId+"filter"]=ah;YAHOO.util.History.multiNavigate(ad)}}},onDataItemCreated:function Q(ag,af){var aj=af[1];if(aj&&(aj.nodeRef!==null)){this.queryExecutionId=null;var ah=new Alfresco.util.NodeRef(aj.nodeRef),ae=this.options.itemUrl+ah.uri+((this.options.entityNodeRef!=null&&this.options.entityNodeRef.length>0)?"?entityNodeRef="+this.options.entityNodeRef+"&":"?")+"itemType="+encodeURIComponent(this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType)+"&dataListName="+encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)+"&site="+this.options.siteId;Alfresco.util.Ajax.jsonPost({url:ae,dataObj:this._buildDataGridParams(),successCallback:{fn:function ad(an){if(an.json&&(an.json.item!==null)){var ap=an.json.item;var am=function ao(){var ar=this._findRecordByParameter(ah,"nodeRef");if(ar!==null){var aq=this.widgets.dataTable.getTrEl(ar);Alfresco.util.Anim.pulse(aq)}if(aj.callback){aj.callback.call(an.json.item)}};this.afterDataGridUpdate.push(am);if(an.json.lastSiblingNodeRef!=null){var al=this._findRecordByParameter(an.json.lastSiblingNodeRef,"nodeRef");if(al!==null){var ak=this.widgets.dataTable.getRecordIndex(al);this.widgets.dataTable.addRow(ap,ak+1)}}else{this.widgets.dataTable.addRow(ap)}v.fire("dirtyDataTable")}},scope:this},failureCallback:{fn:function ai(ak){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.create.refresh.failure")})},scope:this}})}},onDataItemUpdated:function b(af,ae){var ai=ae[1];if(ai&&(ai.nodeRef!==null)){var ag=new Alfresco.util.NodeRef(ai.nodeRef);var ad=function ah(){var ak=this._findRecordByParameter(ag,"nodeRef");if(ak!==null){var aj=this.widgets.dataTable.getTrEl(ak);Alfresco.util.Anim.pulse(aj)}if(ai.callback){ai.callback.call(ak)}v.fire("dirtyDataTable")};this.afterDataGridUpdate.push(ad);this._updateDataGrid.call(this,{page:this.currentPage})}},onDataItemsDeleted:function L(ah,ai){var ae=ai[1];if(ae&&(ae.items!==null)){var ak,ad;for(var af=0,al=ae.items.length;af<al;af++){ak=this._findRecordByParameter(ae.items[af].nodeRef,"nodeRef");if(ak!==null){ad=this.widgets.dataTable.getTrEl(ak);Alfresco.util.Anim.fadeOut(ad)}}this.queryExecutionId=null;var ag=function aj(){v.fire("dirtyDataTable")};this.afterDataGridUpdate.push(ag);this._updateDataGrid.call(this,{page:this.currentPage})}},onColumnRenamed:function n(af,ae){var ah=ae[1];if(ah&&(ah.columnId!==null)){var ag=this.widgets.dataTable.getColumn(ah.columnId);if(ag){var ad=false;if(ag.hidden){this.widgets.dataTable.showColumn(ag);ad=true}ag.label=ah.label;this.widgets.dataTable.formatTheadCell(ag._elThLabel,ag,this.widgets.dataTable.get("sortedBy"));if(ad&&this.widgets.floatingHeader&&this.widgets.floatingHeader!=null){this.widgets.floatingHeader.floatThead("reflow")}}}},_findNextItemByParameter:function J(ah,ag){var af=this.widgets.dataTable.getRecordSet();for(var ae=0,ad=af.getLength();ae<ad;ae++){if(af.getRecord(ae).getData(ag)==ah){if((ae+1)!=ad){return af.getRecord(ae+1).getData()}}}return null},_findPrevItemByParameter:function J(ah,ag){var af=this.widgets.dataTable.getRecordSet();for(var ae=0,ad=af.getLength();ae<ad;ae++){if(af.getRecord(ae).getData(ag)==ah){if((ae-1)>=0){return af.getRecord(ae-1).getData()}}}return null},_setDefaultDataTableErrors:function z(ad){var ae=Alfresco.util.message;ad.set("MSG_EMPTY",ae("message.empty","beCPG.module.EntityDataGrid"));ad.set("MSG_ERROR",ae("message.error","beCPG.module.EntityDataGrid"))},_updateDataGrid:function p(ao){ao=ao||{};var ar=YAHOO.lang.merge({},ao.filter!==undefined?ao.filter:this.currentFilter),al=null,ah=null,am=this,ag={filter:ar,page:ao.page};var ai=function aq(){if(ah){al=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+O(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{al.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.showingMoreActions=false;this.loadingMessageShowing=false;ah=YAHOO.lang.later(this.options.loadingMessageDelay,this,ai);var ap=null;ap=function ae(){if(ah){ah.cancel();ah=null}if(al){if(this.loadingMessageShowing){al.destroy();al=null}else{if(ap!=null){YAHOO.lang.later(100,am,ap)}}}};var ak=function af(au,aw,ax){ap();if(ao.updateOnly&&this.scopeId==""){this.widgets.dataTable.onDataReturnUpdateRows.call(this.widgets.dataTable,au,aw,ax);if(ao.callback){ao.callback.call(this)}}else{var at=function av(){v.fire(this.scopeId+"selectedFilesChanged")};this.afterDataGridUpdate.push(at);this.afterDataGridUpdate.push(this._addSortDnD);this.currentFilter=ar;this.currentPage=ao.page||1;v.fire(this.scopeId+"filterChanged",ar);this.widgets.dataTable.onDataReturnReplaceRows.call(this.widgets.dataTable,au,aw,ax)}};var ad=function aj(au,av){ap();this.afterDataGridUpdate=[];if(av.status==401){window.location.reload(true)}else{try{var at=YAHOO.lang.JSON.parse(av.responseText);this.widgets.dataTable.set("MSG_ERROR",at.message);this.widgets.dataTable.showTableMessage(at.message,YAHOO.widget.DataTable.CLASS_ERROR);if(av.status==404){v.fire("deactivateAllControls")}}catch(aw){this._setDefaultDataTableErrors(this.widgets.dataTable)}}};var an=this._buildDataGridParams(ag);if(am.options.postMethod){this.widgets.dataSource.connMgr.setDefaultPostHeader(Alfresco.util.Ajax.JSON);an=YAHOO.lang.JSON.stringify(an);if(Alfresco.util.CSRFPolicy.isFilterEnabled()){this.widgets.dataSource.connMgr.initHeader(Alfresco.util.CSRFPolicy.getHeader(),Alfresco.util.CSRFPolicy.getToken(),false)}}else{an="&metadata="+encodeURIComponent(YAHOO.lang.JSON.stringify(an))}this.widgets.dataSource.sendRequest(an,{success:ak,failure:ad,scope:this})},_buildDataGridParams:function m(ae){var ad={fields:this.dataRequestFields,page:ae&&ae.page?ae.page:this.currentPage,extraParams:this.options.extraParams};if(this.currentSort!=null){ad.sort=this.currentSort.replace("prop_","").replace("_",":")+"|"+((this.currentSortDir=="yui-dt-asc")?"true":"false")}if(this.queryExecutionId!=null){ad.queryExecutionId=this.queryExecutionId}if(ae&&ae.filter){ad.filter={filterOwner:ae.filter.filterOwner,filterId:ae.filter.filterId,filterData:ae.filter.filterData,filterParams:this._createFilterURLParameters(ae.filter,this.options.filterParameters)}}return ad},_buildSortParam:function T(){var ad="";if(this.options.sortId!=null){ad+="&sortId="+this.options.sortId}return ad},_findRecordByParameter:function Y(ah,ag){var af=this.widgets.dataTable.getRecordSet();for(var ae=0,ad=af.getLength();ae<ad;ae++){if(af.getRecord(ae).getData(ag)==ah){return af.getRecord(ae)}}return null},_createFilterURLParameters:function B(ad,ah){if(YAHOO.lang.isString(ad.filterData)){var ag;for(var af=0,ae=ah.length;af<ae;af++){ag=ah[af];if((ad.filterId==ag.id||ag.id=="*")&&(ad.filterData==ag.data||ag.data=="*")){return this._substituteParameters(ag.parameters,{id:ad.filterId,data:ad.filterData})}}}return null},_substituteParameters:function(al,ag){var ai=al.match(/{[^}]+}/g);if(ai){var ad={},ae,ak,af;for(var ah=0,aj=ai.length;ah<aj;ah++){ae=ai[ah].substring(1,ai[ah].length-1);ak=ae;af=new Date();if(/^[\-\+]?\d+(d|dt)$/.test(ak)){if(/^[\-\+]?\d+(d)$/.test(ak)){af.setHours(11);af.setMinutes(59);af.setSeconds(59);af.setMilliseconds(999)}af.setDate(af.getDate()+parseInt(ak));ak=af}else{ak=ag[ae]}ad[ae]=Alfresco.util.isDate(ak)?Alfresco.util.toISO8601(ak):ak}return YAHOO.lang.substitute(al,ad)}return al}},true)})();