(function(){var b=YAHOO.util.Dom,a=YAHOO.util.Event;YAHOO.widget.GroupedDataTable=function(f,e,c,d){if(!d.groupBy){return new YAHOO.widget.DataTable(f,e,c,d)}this.MSG_NOGROUP=d.MSG_NOGROUP?d.MSG_NOGROUP:"(none)";this._oldFormatRow=d.formatRow;d.formatRow=this.rowFormatter;YAHOO.widget.GroupedDataTable.superclass.constructor.call(this,f,e,c,d);this.initGroups();this.subscribe("sortedByChange",function(){this.initGroups()});this.subscribe("renderEvent",function(){this.initGroups()});this.subscribe("rowClickEvent",function(g){this.unselectGroup(g)});return this};YAHOO.lang.extend(YAHOO.widget.GroupedDataTable,YAHOO.widget.DataTable,{currentGroupName:null,groups:[],resetGroups:true,onGroupClick:new YAHOO.util.CustomEvent("onGroupClick",this),selectedGroup:null,rowFormatter:function(e,c){if(this.resetGroups){this.groups=[];this.currentGroupName=null;this.resetGroups=false}var d=this.configs.groupBy;var f="";if(this.configs.groupFormater){f=this.configs.groupFormater.call(this,null,c)}else{if(c.getData("itemData")[d]!=null){f=c.getData("itemData")[d].value}}if(f!==this.currentGroupName){this.groups.push({name:f,row:e,record:c,group:null});b.addClass(e,"group-first-row")}this.currentGroupName=f;return true},initGroups:function(){if(!this.resetGroups){for(var c=0;c<this.groups.length;c++){this.groups[c].group=this.insertGroup(this.groups[c].name,this.groups[c].row)}this.resetGroups=true}},insertGroup:function(f,j){var i=document.createElement("tr");var h=document.createElement("td");var d=this.getColumnSet().keys.length;var g=document.createElement("div");i.className="group group-expanded";h.setAttribute("colspan",d);if(b.hasClass(j,"yui-dt-first")){b.removeClass(j,"yui-dt-first");b.addClass(i,"group-first")}var c=document.createElement("div");c.className="liner";g.className="icon";c.appendChild(g);var e=document.createElement("div");e.innerHTML=f?f:this.MSG_NOGROUP;e.className="label";c.appendChild(e);h.appendChild(c);i.appendChild(h);b.insertBefore(i,j);a.addListener(g,"click",this.toggleVisibility,this);if(f&&f.length>0){a.addListener(i,"mouseover",this.onGroupMouseover,this);a.addListener(i,"mouseout",this.onGroupMouseout,this);a.addListener(i,"mousedown",this.onGroupMousedown,this);a.addListener(i,"mouseup",this.onGroupMouseup,this);a.addListener(i,"click",this.onGroupClick,this);a.addListener(i,"dblclick",this.onGroupDblclick,this)}else{b.addClass(i,"group-disabled")}return i},onEventSelectGroup:function(c){this.selectGroup(c)},selectGroup:function(d){var h=d.target;var f=this.getTrEl(h);if(!this.selectedGroup||f!==this.selectedGroup){this.unselectGroup(d);b.addClass(f,"group-selected");this.selectedGroup=f;var g=this.getSelectedTrEls();for(var e=0;e<g.length;e++){this.unselectRow(g[e])}var c=this.getGroupRecord(f);this.fireEvent("groupSelectEvent",{record:c,el:f})}},unselectGroup:function(d){var e=d.target;var f=this.getTrEl(e);if(this.selectedGroup&&f!==this.selectedGroup){b.removeClass(this.selectedGroup,"group-selected");var c=this.getGroupRecord(this.selectedGroup);this.fireEvent("groupUnselectEvent",{record:c,el:this.selectedGroup});this.selectedGroup=null}},toggleVisibility:function(g,c){var f=b.getAncestorByClassName(a.getTarget(g),"group");var d;if(b.hasClass(f,"group-expanded")){d=false;b.replaceClass(f,"group-expanded","group-collapsed");c.fireEvent("groupCollapseEvent",{target:f,event:g})}else{d=true;b.replaceClass(f,"group-collapsed","group-expanded");c.fireEvent("groupExpandEvent",{target:f,event:g})}var h=b.getNextSibling(f);while(h&&!b.hasClass(h,"group")&&!b.hasClass(h,"group-collapsed")){if(d){h.style.display="table-row"}else{h.style.display="none"}h=b.getNextSibling(h)}},getGroupRecord:function(d){for(var c=0;c<this.groups.length;c++){if(this.groups[c].group===d){return this.groups[c].record}}},getPreviousTrEl:function(f){var d=f;var c=YAHOO.widget.GroupedDataTable.superclass.getPreviousTrEl.call(this,d);var e=this.getFirstTrEl();while(c!==e){if(b.hasClass(c,"group")){c=YAHOO.widget.GroupedDataTable.superclass.getPreviousTrEl.call(this,c)}else{return c}}return d},getNextTrEl:function(e){var c=YAHOO.widget.GroupedDataTable.superclass.getNextTrEl.call(this,e);var d=this.getLastTrEl();while(c!==d){if(b.hasClass(c,"group")){c=YAHOO.widget.GroupedDataTable.superclass.getNextTrEl.call(this,c)}else{return c}}return d},onGroupMouseover:function(d,c){c.fireEvent("groupMouseoverEvent",{target:a.getTarget(d),event:d})},onGroupMouseout:function(d,c){c.fireEvent("groupMouseoutEvent",{target:a.getTarget(d),event:d})},onGroupMousedown:function(d,c){c.fireEvent("groupMousedownEvent",{target:a.getTarget(d),event:d})},onGroupMouseup:function(d,c){c.fireEvent("groupMouseupEvent",{target:a.getTarget(d),event:d})},onGroupClick:function(d,c){c.fireEvent("groupClickEvent",{target:a.getTarget(d),event:d})},onGroupDblclick:function(d,c){c.fireEvent("groupDblclickEvent",{target:a.getTarget(d),event:d})},onGroupSelect:function(d,c){c.fireEvent("groupSelectEvent",{target:a.getTarget(d),event:d})}})})();