(function(){var e=YAHOO.util.Dom,d=YAHOO.util.KeyListener;Alfresco.module.RulesVersionCleanerAction=function(h){Alfresco.module.RulesVersionCleanerAction.superclass.constructor.call(this,"Alfresco.module.RulesVersionCleanerAction",h,["button","container","connection"]);return this};YAHOO.extend(Alfresco.module.RulesVersionCleanerAction,Alfresco.component.Base,{options:{templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/rules/actions/versioncleaner"},containerDiv:null,showDialog:function c(h){if(!this.containerDiv){Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onTemplateLoaded,obj:h,scope:this},failureMessage:"Could not load template:"+this.options.templateUrl,execScripts:true})}else{this._showDialog(h)}},onTemplateLoaded:function g(i,l){this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=i.serverResponse.responseText;var j=e.getFirstChild(this.containerDiv);this.widgets.dialog=Alfresco.util.createYUIPanel(j);this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelClick);var k=new Alfresco.forms.Form(this.id+"-form");this.widgets.form=k;k.addValidation(this.id+"-number-by-day",Alfresco.forms.validation.number,null,"keyup");k.addValidation(this.id+"-number-of-day",Alfresco.forms.validation.number,null,"keyup");k.addValidation(this.id+"-number-of-version",Alfresco.forms.validation.number,null,"keyup");k.setSubmitElements(this.widgets.okButton);k.doBeforeAjaxRequest={fn:function(m,n){YAHOO.Bubbling.fire("vcleanerConfigCompleted",{options:{versionType:m.dataObj.versionType,numberByDay:m.dataObj.numberByDay,numberOfDay:m.dataObj.numberOfDay,numberOfVersion:m.dataObj.numberOfVersion},eventGroup:this});this.widgets.dialog.hide();return false},obj:null,scope:this};k.applyTabFix();k.init();var h=new d(document,{keys:d.KEY.ESCAPE},{fn:function(n,m){this.onCancelClick()},scope:this,correctScope:true});h.enable();this._showDialog(l)},_showDialog:function b(l){l=l?l:{};var h=e.get(this.id+"-version-type-major"),j=e.get(this.id+"-version-type-minor"),k=e.get(this.id+"-version-type-all"),i;if(l.versionType=="minor"){j.checked=true;i=j;h.checked=false;k.checked=false}else{if(l.versionType=="major"){h.checked=true;i=h;j.checked=false;k.checked=false}else{k.checked=true;i=k;h.checked=false;j.checked=false}}e.get(this.id+"-number-by-day").value=l.numberByDay?l.numberByDay:"";e.get(this.id+"-number-of-day").value=l.numberOfDay?l.numberOfDay:"";e.get(this.id+"-number-of-version").value=l.numberOfVersion?l.numberOfVersion:"";this.widgets.form.validate();this.widgets.dialog.show();i.focus()},onCancelClick:function a(h,i){this.widgets.dialog.hide()}});var f=new Alfresco.module.RulesVersionCleanerAction("null")})();