(function(){var e=YAHOO.util.Dom,b=YAHOO.Bubbling,h=YAHOO.util.Event;var d=Alfresco.util.siteURL;beCPG.component.EntityDataListToolbar=function(k){beCPG.component.EntityDataListToolbar.superclass.constructor.call(this,"beCPG.component.EntityDataListToolbar",k,["button","container"]);this.toolbarButtonActions={};this.widgets.actionButtons={};b.on("registerToolbarButtonAction",this.onRegisterToolbarButtonAction,this);b.on("activeDataListChanged",this.onActiveDataListChanged,this);if(Alfresco.doclib&&Alfresco.doclib.Actions){YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this)}this.deferredToolbarPopulation=new Alfresco.util.Deferred(["onReady","onActiveDataListChanged"],{fn:this.populateToolbar,scope:this});return this};YAHOO.extend(beCPG.component.EntityDataListToolbar,Alfresco.component.Base);if(Alfresco.doclib&&Alfresco.doclib.Actions){YAHOO.lang.augmentProto(beCPG.component.EntityDataListToolbar,Alfresco.doclib.Actions)}YAHOO.lang.augmentObject(beCPG.component.EntityDataListToolbar.prototype,{entity:null,options:{nodeRef:null,entityNodeRef:null,siteId:null,containerId:"documentLibrary",inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},rootNode:"alfresco://company/home",replicationUrlMapping:{},documentDetails:null,repositoryBrowsing:true},recordData:null,doclistMetadata:null,currentPath:null,onRegisterToolbarButtonAction:function i(l,k){var m=k[1];if(m&&m.actionName){this.toolbarButtonActions[m.actionName]=m}},onActiveDataListChanged:function i(l,k){var m=k[1];if((m!==null)&&(m.dataList!==null)){this.datalistMeta=m.dataList;this.entity=m.entity;if(m.list!==null&&(!this.options.list||this.options.list===null||this.options.list.length<1)){this.options.list=m.list}if(!this.deferredToolbarPopulation.fulfil("onActiveDataListChanged")){this.populateToolbar()}}},populateToolbar:function f(){if(!YAHOO.lang.isObject(this.datalistMeta)){return}var p=e.get(this.id+"-toolbar-buttons-right"),m=e.get(this.id+"-toolbar-buttons-left"),o=e.get("custom-toolBar-template-button");if(this.widgets.actionButtons!=null){for(var l in this.widgets.actionButtons){var r=this.widgets.actionButtons[l];if(typeof r.destroy==="function"){r.destroy()}this.widgets.actionButtons[l]=null}}p.innerHTML="";m.innerHTML="";this.widgets.actionButtons={};for(var l in this.toolbarButtonActions){var q=this.toolbarButtonActions[l];if(this.widgets.actionButtons[l]==null&&(q.evaluate===null||q.evaluate(this.datalistMeta,this.entity))){if(q.createWidget){if(q.right!==null&&q.right===true){this.widgets.actionButtons[l]=q.createWidget(p,this)}else{this.widgets.actionButtons[l]=q.createWidget(m,this)}}else{var n=o.cloneNode(true);e.setAttribute(n,"id",this.id+"-"+l+"ContainerDiv");e.addClass(n,l);if(q.right!==null&&q.right===true){p.appendChild(n)}else{m.appendChild(n)}var k=e.getFirstChild(n);e.setAttribute(k,"id",this.id+"-"+l+"Button");this.widgets.actionButtons[l]=Alfresco.util.createYUIButton(this,l+"Button",q.fn);if(q.hideLabel!==null&&q.hideLabel===true){this.widgets.actionButtons[l].set("label","")}else{this.widgets.actionButtons[l].set("label",this.msg("button."+l))}this.widgets.actionButtons[l].set("title",this.msg("button."+l+".description"));e.removeClass(n,"hidden")}}}},onReady:function c(){this.deferredToolbarPopulation.fulfil("onReady");if(this.options.nodeRef!=null){this.recordData=this.options.documentDetails.item;this.doclistMetadata=this.options.documentDetails.metadata;this.currentPath=this.recordData.location.path;this.recordData.jsNode=new Alfresco.util.Node(this.recordData.node);var k=this.recordData,p=k.actions,n=e.get(this.id+"-actionSet"),q="";k.actionParams={};for(var l=0,m=p.length;l<m;l++){q+=this.renderAction(p[l],k).replace(/div/g,"li")}var o=this.getActionUrls(k);n.innerHTML=YAHOO.lang.substitute(q,o);this.modules.actions=new Alfresco.module.DoclibActions();this.widgets.actionsMenu=Alfresco.util.createYUIButton(this,"action-set-button",this.onActionMenu,{type:"menu",menu:"action-set-menu",lazyloadmenu:false,disabled:false})}e.setStyle(this.id+"-body","visibility","visible")},onActionMenu:function a(p,o,n){var k=o[0],m=o[1];if(typeof this[m.id]==="function"){try{this[m.id].call(this,this.recordData,m.element);h.preventDefault(k)}catch(l){alert(l)}}return true},getAction:function g(l,k,p){var r=k.className.split(" ")[0],o=Alfresco.util.findInArray(l.actions,r,"id")||{};if(p===false){return o}else{o=Alfresco.util.deepCopy(o);var q=o.params||{};for(var m in q){q[m]=YAHOO.lang.substitute(q[m],l,function n(t,u,s){return Alfresco.util.findValueByDotNotation(l,t)})}return o}},_onActionDeleteConfirm:function j(n){var l=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.delete.please-wait"),spanClass:"wait",displayTime:0});var w=n.location.path;var s=null;var q=this;if(Alfresco.constants.PAGECONTEXT=="mine"||Alfresco.constants.PAGECONTEXT=="shared"){var x=w.substring(1);if(Alfresco.constants.PAGECONTEXT=="mine"){x=x.substring(x.indexOf("/")+1)}var k=x.indexOf("/");if(k!=-1){w=x.substring(k)}else{w=""}}var m=n.fileName,t=n.displayName,u=new Alfresco.util.NodeRef(n.nodeRef),r="",o=w.length>1?"?path="+encodeURIComponent(w):"";if(Alfresco.constants.PAGECONTEXT=="mine"){r="myfiles"}else{if(Alfresco.constants.PAGECONTEXT=="shared"){r="sharedfiles"}else{r=Alfresco.util.isValueSet(this.options.siteId)?"documentlibrary":"repository"}}q.actionWidget=this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:"file-deleted",page:"documentlibrary",activityData:{fileName:m,path:w,nodeRef:u.toString()}},callback:{fn:function p(y){window.location=d(r+o)}}},failure:{callback:{fn:function v(y,z){l.destroy();if(y.json&&y.json.message){Alfresco.util.PopupManager.displayPrompt({title:q.msg("message.delete.failure"),text:y.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:q.msg("message.delete.failure")})}}}},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:u.uri}}})}},true)})();