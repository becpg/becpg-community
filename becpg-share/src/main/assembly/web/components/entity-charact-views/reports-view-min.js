(function(){var d=YAHOO.util.Dom;beCPG.component.ReportViewer=function c(h){beCPG.component.ReportViewer.superclass.constructor.call(this,h);YAHOO.Bubbling.on("versionChangeFilter",this.onVersionChanged,this);this.preferencesService=new Alfresco.service.Preferences();return this};YAHOO.extend(beCPG.component.ReportViewer,Alfresco.WebPreview,{options:{report:null,itemType:null,currVersionNodeRef:null,reports:[]},onReady:function g(){var l=this;if(this.options.report!==null&&d.get(l.id+"-entityReportPicker-button")){this.widgets.entityReportPicker=new YAHOO.widget.Button(l.id+"-entityReportPicker-button",{type:"split",menu:l.id+"-entityReportPicker-select",lazyloadmenu:false});this.widgets.entityReportPicker.on("click",l.onEntityReportPickerClicked,l,true);this.widgets.entityReportPicker.getMenu().subscribe("click",function(n,m){var o=m[1];if(o){l.widgets.entityReportPicker.set("label",o.cfg.getProperty("text"));l.onEntityReportPickerClicked.call(l,o)}});if(this.options.report.isSelected){var j=l.widgets.entityReportPicker.getMenu().getItems();for(var i in j){if(j.hasOwnProperty(i)){if(j[i].value===this.options.report.nodeRef){l.widgets.entityReportPicker.set("label",j[i].cfg.getProperty("text"));l.onEntityReportPickerClicked.call(l,j[i]);break}}}}if(d.get("toolbar-contribs-"+this.id)){var h=d.getChildren("toolbar-contribs-"+this.id);if(h){for(var k in h){(new YAHOO.util.Element("toolbar-contribs")).appendChild(h[k])}}}}YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"entity-print-report",evaluate:function(n,m){return n.name!==null&&n.name.indexOf("View-reports")==0},fn:function(m){l.onPrintClick(l)}});beCPG.component.ReportViewer.superclass.onReady.call(this)},onPrintClick:function(j){var i=j.options.nodeRef.replace(":/",""),h="noCache="+new Date().getTime();printJS(Alfresco.constants.PROXY_URI+"api/node/"+i+"/content/"+encodeURIComponent(j.options.name)+"?c=force&"+h+"&a=false")},onEntityReportPickerClicked:function b(i){var h=this;if(i){h.widgets.entityReportPicker.value=encodeURIComponent(i.value);h.preferencesService.set(h.getPickerPreference(),i.cfg.getProperty("text"),{successCallback:{fn:function(){if(encodeURIComponent(h.options.report.nodeRef)!=h.widgets.entityReportPicker.value){h.options.nodeRef=decodeURIComponent(h.widgets.entityReportPicker.value);for(var j in h.options.reports){if(h.options.reports[j].nodeRef==h.options.nodeRef){h.options.report=h.options.reports[j];break}}if(h.options.name.split(".").pop()!=h.options.report.name.split(".").pop()){window.location.href=window.location.href.split("#")[0]}h.options.name=h.options.report.name;YAHOO.Bubbling.fire("previewChangedEvent")}},scope:this}})}},onPreviewChanged:function f(h){if(!this.options.report){window.location.href=window.location.href.split("#")[0]}this.options.avoidCachedThumbnail=true;YAHOO.util.Event.preventDefault(h);YAHOO.util.Event.stopPropagation(h)},getPickerPreference:function a(){return"fr.becpg.repo.report."+this.options.itemType.replace(":","_")+".view"},onVersionChanged:function e(i,h){YAHOO.Bubbling.unsubscribe("versionChangeFilter",this.onVersionChanged,this);var j=new YAHOO.util.Element("toolbar-contribs");if(j.hasChildNodes()){j.removeChild(j.get("firstChild"))}var k=h[1];if((k!==null)&&k.filterId!==null&&k.filterId==="version"&&k.filterData!==null){this.refresh("components/entity-charact-views/reports-view?currVersionNodeRef="+(this.options.currVersionNodeRef!=null?this.options.currVersionNodeRef:"{nodeRef}")+"&nodeRef="+k.filterData+(this.options.siteId?"&site={siteId}":""))}else{if(this.options.currVersionNodeRef!=null){this.refresh("components/entity-charact-views/reports-view?nodeRef="+this.options.currVersionNodeRef+(this.options.siteId?"&site={siteId}":""))}}}})})();