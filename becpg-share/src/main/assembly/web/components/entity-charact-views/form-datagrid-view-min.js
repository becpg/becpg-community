(function(){var b=YAHOO.util.Dom;beCPG.component.FormDataGrid=function a(e){beCPG.component.FormDataGrid.superclass.constructor.call(this,"beCPG.component.FormDataGrid",e,["button","container"]);YAHOO.Bubbling.on("activeDataListChanged",this.onActiveDataListChanged,this);YAHOO.Bubbling.on("refreshDataGrids",this.loadForm,this);return this};YAHOO.extend(beCPG.component.FormDataGrid,Alfresco.component.Base,{options:{nodeRef:null,formId:null},onReady:function c(){Alfresco.util.createYUIButton(this,"edit-datagrid-form",function(f,e){var g=new Alfresco.module.SimpleDialog(this.id+"-editDataGridForm");g.setOptions({width:"33em",onSuccess:{fn:function(){var h=YAHOO.util.Selector.query("div.formulate button");if(h!=null&&h.length>0){h[0].click()}else{this.loadForm()}},scope:this},templateUrl:YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?popup=true&formId={formId}&itemKind=node&itemId={itemId}&mode=edit&submitType=json&showCancelButton=true",{itemId:this.options.nodeRef,formId:this.options.formId}),destroyOnHide:true,doBeforeDialogShow:{fn:function(h,i){Alfresco.util.populateHTML([i.id+"-dialogTitle",this.msg("label.form-metadata.title")])},scope:this}}).show()});this.loadForm()},loadForm:function c(){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-formContainer",itemKind:"node",itemId:this.options.nodeRef,formId:this.options.formId,forceFormId:"true",mode:"view"},successCallback:{fn:this.onFormLoaded,scope:this},failureCallback:{fn:this.onFormFailed,scope:this},scope:this,execScripts:true})},onFormLoaded:function(e){var f=b.get(this.id+"-formContainer");f.innerHTML=e.serverResponse.responseText;b.removeClass(this.id+"-formDatagridView","hidden");b.setStyle(this.id+"-formDatagridView","width","24%");b.setStyle(this.id+"-formDatagridView","float","left");b.setStyle(this.id+"-body","width","74.2%");b.setStyle(this.id+"-body","float","left")},onFormFailed:function(e){var f=b.get(this.id+"-formContainer");f.innerHTML=e.serverResponse.responseText;b.addClass(this.id+"-formDatagridView","hidden");b.setStyle(this.id+"-body","width","100%")},onActiveDataListChanged:function d(f,e){var g=e[1];if((g!==null)){if(g.dataList){if(this.datalistMeta!=null&&this.datalistMeta.name!=null){this.options.formId=datalistMeta.name}}if(g.list!=null&&(this.options.list==null||this.options.list.length<1)){this.options.formId=g.list}this.loadForm()}}})})();