(function(){var d=YAHOO.util.Dom,i=Alfresco.util.formatDate,a=Alfresco.util.fromISO8601;beCPG.component.Properties=function h(k){beCPG.component.Properties.superclass.constructor.call(this,k);YAHOO.Bubbling.on("metadataRefresh",this.doRefresh,this);YAHOO.Bubbling.on("refreshDataGrids",this.doRefresh,this);YAHOO.Bubbling.on("versionChangeFilter",this.onVersionChanged,this);return this};YAHOO.extend(beCPG.component.Properties,Alfresco.CommentsList,{options:{currVersionNodeRef:null,nodeRef:null,siteId:null,formId:null},fileUpload:null,onReady:function e(){YAHOO.util.Event.addListener(this.id+"-uploadLogo-button","click",this.doUploadLogo,this,true);var k=d.get(this.id+"-modifyDate");k.innerHTML=Alfresco.util.formatDate(Alfresco.util.fromISO8601(k.innerHTML),Alfresco.util.message("date-format.default"));new Alfresco.Favourite(this.id+"-favourite").setOptions({nodeRef:this.options.nodeRef,type:"folder"}).display(this.options.isFavourite);if(d.get(this.id+"-properties-tabview")!=null){this.widgets.tabView=new YAHOO.widget.TabView(this.id+"-properties-tabview")}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-formContainer",itemKind:"node",itemId:this.options.nodeRef,formId:this.options.formId,siteId:this.options.siteId,mode:"view"},successCallback:{fn:this.onFormLoaded,scope:this},failureMessage:this.msg("message.failure"),scope:this,execScripts:true});beCPG.component.Properties.superclass.onReady.call(this)},synchronizeElements:function g(o,l){var n=new YAHOO.util.Element(l),m=new YAHOO.util.Element(o),p=YAHOO.util.Dom.getRegion(n.get("id"));m.setStyle("position","absolute");if(d.get(this.id+"-properties-tabview")==null){m.setStyle("left",p.left+"px");m.setStyle("top",p.top+"px")}else{var k=YAHOO.util.Dom.getRegion(this.id+"-properties-tabview");m.setStyle("left",(p.left-k.left)+"px");m.setStyle("top",(p.top-k.top)+"px")}m.setStyle("width",p.width+"px");m.setStyle("height",p.height+"px")},onFormLoaded:function c(k){var l=d.get(this.id+"-formContainer"),m=this;l.innerHTML=k.serverResponse.responseText;d.getElementsByClassName("viewmode-value-date","span",l,function(){var o=d.getAttribute(this,"data-show-time"),r=d.getAttribute(this,"data-date-iso8601"),n=(o=="false")?m.msg("date-format.defaultDateOnly"):m.msg("date-format.default"),p=o=="false",q=a(r,p);this.innerHTML=i(q,n)})},doUploadLogo:function b(n){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var l=this;var k={flashUploadURL:"becpg/entity/uploadlogo",htmlUploadURL:"becpg/entity/uploadlogo.html",updateNodeRef:this.options.nodeRef,mode:this.fileUpload.MODE_SINGLE_UPLOAD,suppressRefreshEvent:true,onFileUploadComplete:{fn:function m(p){var q=p.successful.length;if(q!=0){var o=d.get(l.id+"-productLogo");setTimeout(function(){o.src=o.src+"&"+new Date().getTime()},3000)}},scope:this}};this.fileUpload.show(k);YAHOO.util.Event.preventDefault(n)},doRefresh:function f(){YAHOO.Bubbling.unsubscribe("metadataRefresh",this.doRefresh,this);this.refresh("components/entity-charact-views/properties-view?nodeRef={nodeRef}"+(this.options.siteId?"&site={siteId}":"")+(this.options.formId?"&formId={formId}":""))},onVersionChanged:function j(l,k){YAHOO.Bubbling.unsubscribe("metadataRefresh",this.doRefresh,this);YAHOO.Bubbling.unsubscribe("versionChangeFilter",this.onVersionChanged,this);var m=k[1];if((m!==null)&&m.filterId!==null&&m.filterId==="version"&&m.filterData!==null){this.refresh("components/entity-charact-views/properties-view?currVersionNodeRef="+(this.options.currVersionNodeRef!=null?this.options.currVersionNodeRef:"{nodeRef}")+"&nodeRef="+m.filterData+(this.options.siteId?"&site={siteId}":"")+(this.options.formId?"&formId={formId}":""))}else{if(this.options.currVersionNodeRef!=null){this.refresh("components/entity-charact-views/properties-view?nodeRef="+this.options.currVersionNodeRef+(this.options.siteId?"&site={siteId}":"")+(this.options.formId?"&formId={formId}":""))}}}})})();