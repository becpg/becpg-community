(function(){var f=YAHOO.util.Dom;beCPG.component.AdminConsole=function(n){beCPG.component.AdminConsole.superclass.constructor.call(this,"beCPG.component.AdminConsole",n,["button","menu","container","json"]);return this};YAHOO.extend(beCPG.component.AdminConsole,Alfresco.component.Base,{options:{memory:0},onReady:function k(){this.widgets.initRepoButton=Alfresco.util.createYUIButton(this,"init-repo-button",this.onInitRepoClick);this.widgets.initAclButton=Alfresco.util.createYUIButton(this,"init-acl-button",this.onInitAclClick);this.widgets.emptyCacheButton=Alfresco.util.createYUIButton(this,"empty-cache-button",this.onEmptyCacheClick);this.widgets.showUsersButton=Alfresco.util.createYUIButton(this,"show-users-button",this.onShowUsersClick);this.createGauge()},createGauge:function(){var n=50;var x=f.getElementsByClassName("circle");var u=x.length;for(var v=0;v<u;v++){x[v].setAttribute("r",n)}var q=(n*2)+50;var o=f.get(this.id+"-gauge-wrapper");o.style.width=q+"px";var p=2*Math.PI*n;var s=p/2;var w=s/5;var t=w*2;f.get(this.id+"-outline_curves").setAttribute("stroke-dasharray",s+","+p);f.get(this.id+"-low").setAttribute("stroke-dasharray",s+","+p);f.get(this.id+"-avg").setAttribute("stroke-dasharray",t+","+p);f.get(this.id+"-high").setAttribute("stroke-dasharray",w+","+p);var y=f.get("gauge-percentage");var z=f.get(this.id+"-gauge-meter_needle");var A=s-((this.options.memory*s)/100);z.style.transform="rotate("+(270+((this.options.memory*180)/100))+"deg)";y.textContent=this.options.memory+"%"},onInitRepoClick:function c(o,n){this.widgets.initRepoButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/init-repo",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onInitRepoSuccess,scope:this},failureCallback:{fn:this.onInitRepoFailure,scope:this}})},onInitRepoSuccess:function m(n){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-repo.success")});this.widgets.initRepoButton.set("disabled",false)},onInitRepoFailure:function e(n){if(n.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:n.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-repo.failure")})}this.widgets.initRepoButton.set("disabled",false)},onInitAclClick:function h(o,n){this.widgets.initAclButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/reload-acl",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.onInitAclSuccess,scope:this},failureCallback:{fn:this.onInitAclFailure,scope:this}})},onInitAclSuccess:function d(n){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-acl.success")});this.widgets.initAclButton.set("disabled",false)},onInitAclFailure:function l(n){if(n.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:n.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.init-acl.failure")})}this.widgets.initAclButton.set("disabled",false)},onEmptyCacheClick:function b(o,n){this.widgets.emptyCacheButton.set("disabled",true);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/reload-cache",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:this.emptyCacheSuccess,scope:this},failureCallback:{fn:this.emptyCacheFailure,scope:this}})},emptyCacheSuccess:function g(n){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.empty-cache.success")});this.widgets.emptyCacheButton.set("disabled",false)},emptyCacheFailure:function i(n){if(n.json.message!==null){Alfresco.util.PopupManager.displayPrompt({text:n.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.empty-cache.failure")})}this.widgets.emptyCacheButton.set("disabled",false)},onShowUsersClick:function a(o,n){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"/becpg/admin/repository/show-users",method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(q){if(q.json){var t=document.createElement("div");var r='<div id="'+this.id+'-show-users-panel" class="about-share"><div class="bd"><ul class="users">';for(j in q.json.users){var p=q.json.users[j];r+="<li >";r+='<span class="avatar" title="'+p.fullName+'">';r+=Alfresco.Share.userAvatar(p.username,64);r+='</span><span class="username" ><a id="yui-gen59" class="theme-color-1" tabindex="0" href="/share/page/user/'+p.username+'/profile">'+p.fullName+"</a></span></li>"}r+="</ul></div></div>";t.innerHTML=r;var s=f.getFirstChild(t);this.widgets.panel=Alfresco.util.createYUIPanel(s,{draggable:false,width:"25em"});this.widgets.panel.show()}},scope:this}})}})})();