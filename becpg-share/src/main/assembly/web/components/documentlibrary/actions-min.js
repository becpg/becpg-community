(function(){var W=YAHOO.util.Dom,U=YAHOO.util.Event;var S=Alfresco.util.encodeHTML,M=Alfresco.util.combinePaths,L=Alfresco.util.siteURL,aa=Alfresco.util.isValueSet;var l;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function E(ak,aj){var al=aj[1];if(al&&aa(al.actionName)&&aa(al.fn)){this.registerAction(al.actionName,al.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+al)}},registerAction:function d(aj,ak){if(aa(aj)&&aa(ak)){this.constructor.prototype[aj]=ak;return true}return false},renderAction:function Z(ak,an){var aj=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",ap='style="background-image:url('+aj+'{icon}-16.png)" ',am={link:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{href}" '+ap+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{pageUrl}" '+ap+"><span>{label}</span></a></div>",javascript:'<div class="{id}{additionalCssClasses}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+ap+"><span>{label}</span></a></div>"};an.actionParams[ak.id]=ak.params;var al={id:ak.id,icon:ak.icon,label:S(Alfresco.util.substituteDotNotation(this.msg(ak.label),an)),additionalCssClasses:ak.additionalCssClasses?" "+ak.additionalCssClasses:""};if(ak.lastActionInSubgroup){al.additionalCssClasses=" alf-action-group-end"}if(ak.type==="link"){if(ak.params.href){al.href=Alfresco.util.substituteDotNotation(ak.params.href,an);al.target=ak.params.target?'target="'+ak.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",ak.id)}}else{if(ak.type==="pagelink"){if(ak.params.page){al.pageUrl=Alfresco.util.substituteDotNotation(ak.params.page,an);if(ak.params.page.charAt(0)!=="{"){var ao=aa(an.location.site)?an.location.site.name:null;al.pageUrl=L(al.pageUrl,{site:ao})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",ak.id)}}else{if(ak.type==="javascript"){if(ak.params["function"]){al.jsfunction=ak.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",ak.id)}}}}return YAHOO.lang.substitute(am[ak.type],al)},getActionUrls:function w(ap,ak){var am=ap.jsNode,at=am.isLink?am.linkedNode.nodeRef:am.nodeRef,at=am.isLink&&!aa(at)?"invalidlink":at,aq=at.toString(),aj=at.uri,ao=am.contentURL,au=ap.workingCopy||{},al=aa(ap.location.site)?ap.location.site.name:null,ar=Alfresco.util.bind(function(av){return Alfresco.util.siteURL(av,{site:YAHOO.lang.isString(ak)?ak:al})},this),an={downloadUrl:M(Alfresco.constants.PROXY_URI,ao)+"?a=true",viewUrl:M(Alfresco.constants.PROXY_URI,ao)+'" target="_blank',documentDetailsUrl:ar("document-details?nodeRef="+aq),folderDetailsUrl:ar("folder-details?nodeRef="+aq),editMetadataUrl:ar("edit-metadata?nodeRef="+aq),inlineEditUrl:ar("inline-edit?nodeRef="+aq),managePermissionsUrl:ar("manage-permissions?nodeRef="+aq),manageTranslationsUrl:ar("manage-translations?nodeRef="+aq),workingCopyUrl:ar("document-details?nodeRef="+(au.workingCopyNodeRef||aq)),workingCopySourceUrl:ar("document-details?nodeRef="+(au.sourceNodeRef||aq)),cloudViewUrl:M(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+aq)};an.sourceRepositoryUrl=this.viewInSourceRepositoryURL(ap,an)+'" target="_blank';return an},getAction:function ai(ak,aj,ao){var aq=aj.className.match(/([^\s])*/)[0];var an=Alfresco.util.findInArray(ak.actions,aq,"id")||{};if(ao===false){return an}else{an=Alfresco.util.deepCopy(an);var ap=an.params||{};for(var al in ap){ap[al]=YAHOO.lang.substitute(ap[al],ak,function am(at,au,ar){return Alfresco.util.findValueByDotNotation(ak,at)})}return an}},getParentNodeRef:function ah(ak){var an=null;if(YAHOO.lang.isArray(ak)){try{an=this.doclistMetadata.parent.nodeRef}catch(ao){an=null}if(an===null){for(var am=1,al=ak.length,aj=true;am<al&&aj;am++){aj=(ak[am].parent.nodeRef==ak[am-1].parent.nodeRef)}an=aj?ak[0].parent.nodeRef:this.doclistMetadata.container}}else{an=ak.parent.nodeRef}return an},onActionDetails:function N(am){var at=this,ao=am.nodeRef,al=am.jsNode;var aq=function aj(av,aw){var au='<span class="light">'+S(am.displayName)+"</span>";Alfresco.util.populateHTML([aw.id+"-dialogTitle",at.msg("edit-details.title",au)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(aw,"editMetadata",null,{type:"link",label:at.msg("edit-details.label.edit-metadata"),href:L("edit-metadata?nodeRef="+ao)})};var ak=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:ao,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ar=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ar.setOptions({width:"auto",zIndex:1001,templateUrl:ak,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:aq,scope:this},onSuccess:{fn:function an(av){var ax="components/documentlibrary/data";if(aa(this.options.siteId)){ax+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:M(Alfresco.constants.URL_SERVICECONTEXT,ax,"/node/",al.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function aw(az){var ay=az.json.item;ay.jsNode=new Alfresco.util.Node(az.json.item.node);YAHOO.Bubbling.fire(ay.node.isContainer?"folderRenamed":"fileRenamed",{file:ay});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function au(ay){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function ap(au){var av=this.msg("message.details.failure");if(au.json&&(au.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1||au.json.message.indexOf("already exists")!==-1)){av=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:av,zIndex:ar.zIndex},ar.dialog.body)},scope:this}}).show()},onActionLocate:function af(ak){var am=ak.jsNode,ao=ak.location.path,aj=ak.location.repoPath,al,an=aa(ak.location.site)?ak.location.site.name:null;if(am.isLink){al=aa(am.linkedNode.properties)?am.linkedNode.properties.name:null;if(al===null){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.actions.failure.locate")})}}else{al=ak.displayName}if(aa(this.options.siteId)&&an!==this.options.siteId){window.location=L((an===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(al)+"&path="+encodeURIComponent(ao),{site:an})}else{if((Alfresco.constants.PAGECONTEXT=="shared"&&aj!="/Shared")||(Alfresco.constants.PAGECONTEXT=="mine"&&aj!="/")){window.location="/share/page/repository?file="+encodeURIComponent(al)+"&path="+encodeURIComponent(aj)}else{this.options.highlightFile=al;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:ao})}}},onActionDelete:function X(an){var at=this,ak=an.jsNode,aq=ak.isContainer?"folder":"document",av=an.displayName,am=(this.options.syncMode==="CLOUD"),au=0;var al=(ak.hasAspect("sync:syncSetMemberNode")&&aa(ak.properties))?ak.properties["sync:directSync"]==="true":false;var aj="";if(!am&&al){aj='<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+aq+".from.cloud",av)+"</span></div>"}var ax=this.msg("message.confirm.delete",av);if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||W.hasClass(this.id,"alf-fullscreen"))){au=1000}var aw=undefined;if(W.hasClass(this.id,"alf-true-fullscreen")){aw=W.get(this.id)}var ar=[{text:this.msg("button.delete"),handler:function ap(){var ay=am?false:W.getAttribute("requestDeleteRemote","checked");this.destroy();if(al){at._onActionDeleteSyncConfirm.call(at,an,ay)}else{at._onActionDeleteConfirm.call(at,an)}}},{text:this.msg("button.cancel"),handler:function ao(){this.destroy()},isDefault:true}];Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+aq+".delete"),text:ax+aj,noEscape:true,buttons:ar,zIndex:au},aw)},_onActionDeleteSyncConfirm:function h(an,ap){var aj=an.jsNode,at=an.location.path,am=an.location.file,ak=M(at,am),aq=an.displayName,ar=aj.nodeRef,ao=this.getParentNodeRef(an);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+an.jsNode.nodeRef.uri+"?requestDeleteRemote="+ap,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function al(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.unsync.success")});this._onActionDeleteConfirm.call(this,an)},scope:this},failureMessage:this.msg("message.unsync.failure")})},_onActionDeleteConfirm:function ad(am){var ao=this;var aj=am.jsNode,av=am.location.path,al=am.location.file,ak=M(av,al),aq=am.displayName,ar=aj.nodeRef,an=this.getParentNodeRef(am);var ap={zIndex:this.fullscreen!==undefined&&(W.hasClass(this.id,"alf-true-fullscreen")||W.hasClass(this.id,"alf-fullscreen"))?1000:0,parentElement:W.hasClass(this.id,"alf-true-fullscreen")?W.get(this.id):undefined};this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:aj.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:al,path:av,nodeRef:ar.toString(),parentNodeRef:an.toString()}},event:{name:aj.isContainer?"folderDeleted":"fileDeleted",obj:{path:ak}},display:ap,message:this.msg("message.delete.success",aq),callback:{fn:function at(aw,ax){if(this.totalRecords){this.totalRecords-=aw.json.successCount}},scope:this}},failure:{display:ap,callback:{fn:function au(aw,ax){if(aw.json&&aw.json.message){Alfresco.util.PopupManager.displayPrompt({title:ao.msg("message.delete.failure",aq),text:aw.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:ao.msg("message.delete.failure",aq)})}}}},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:ar.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(aj){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing","application/vnd.visio2013":"Visio.Drawing"},onActionEditOnline:function p(aj){if(!aa(aj.onlineEditUrl)){aj.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,aj.location)}if(aj.onlineEditUrl.length>256||(encodeURI(aj.onlineEditUrl)).length>256){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"/api/sites/"+aj.location.site.name,successCallback:{fn:function(ak){var ao=ak.json.node.split("/").pop();var am=aj.nodeRef.split("/").pop();aj.onlineEditUrl=aj.onlineEditUrl.split(aj.location.site.name)[0]+"_IDX_SITE_"+ao+"/_IDX_NODE_"+am+"/"+aj.displayName;if(aj.onlineEditUrl.length>256){var al=aj.displayName.split(".").pop();var an=aj.displayName.split(".")[0];var aq=aj.onlineEditUrl.length-256;aj.onlineEditUrl=aj.onlineEditUrl.replace(aj.displayName,an.substring(0,an.length-aq-1)+"."+al)}if(encodeURI(aj.onlineEditUrl).length>256){var al=aj.displayName.split(".").pop();var an=aj.onlineEditUrl.split("/").pop();var ap=an.split(".")[0].substring(0,5)+"."+al;aj.onlineEditUrl=aj.onlineEditUrl.replace(an,ap)}this.actionEditOnlineInternal(aj)},scope:this},failureCallback:{fn:function(ak){this.actionEditOnlineInternal(aj)},scope:this}})}else{this.actionEditOnlineInternal(aj)}},actionEditOnlineInternal:function p(aj){if(aj.onlineEditUrl.length>256||encodeURI(aj.onlineEditUrl).length>256){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(aj)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function G(an){var aq="SharePoint.OpenDocuments",ak=an.jsNode,ao=an.location,at=ak.mimetype,al=null,am=null,aj={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(ao)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",ao.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(at)){al=this.onlineEditMimetypes[at]}else{var ap=Alfresco.util.getFileExtension(an.location.file);if(ap!==null){ap=ap.toLowerCase();if(aj.hasOwnProperty(ap)){at=aj[ap];if(this.onlineEditMimetypes.hasOwnProperty(at)){al=this.onlineEditMimetypes[at]}}}}if(al!==null){if(!aa(an.onlineEditUrl)){an.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ao)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(aq,an,al)}if((YAHOO.env.ua.chrome>0)&&!Alfresco.util.isSharePointPluginInstalled()){var ap=Alfresco.util.getFileExtension(ao.file);if(null!==ap){var ar=this.getProtocolForFileExtension(ap.toLowerCase());return this._launchOnlineEditorChrome(ar,an.onlineEditUrl)}}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(an,al)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",ao.file)});return false}}return window.open(an.onlineEditUrl,"_blank")},_launchOnlineEditorChrome:function k(ak,aj){location.href=ak+":ofe%7Cu%7C"+aj},getProtocolForFileExtension:function(ak){var aj={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint",};return aj[ak]},_launchOnlineEditorIE:function O(al,aj,ak){try{if(ak==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(al+".3");return activeXControl.EditDocument3(window,aj.onlineEditUrl,true,ak)}catch(an){try{activeXControl=new ActiveXObject(al+".2");return activeXControl.EditDocument2(window,aj.onlineEditUrl,ak)}catch(ao){try{activeXControl=new ActiveXObject(al+".1");return activeXControl.EditDocument(aj.onlineEditUrl,ak)}catch(am){}}}return false},_launchOnlineEditorPlugin:function j(ak,al){var am=document.getElementById("SharePointPlugin");if(am==null&&Alfresco.util.isSharePointPluginInstalled()){var aj=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){aj="application/x-sharepoint-webkit"}else{aj="application/x-sharepoint"}var aq=document.createElement("object");aq.id="SharePointPlugin";aq.type=aj;aq.width=0;aq.height=0;aq.style.setProperty("visibility","hidden","");document.body.appendChild(aq);am=document.getElementById("SharePointPlugin");if(!am){return false}}try{if(al==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return am.EditDocument3(window,ak.onlineEditUrl,true,al)}catch(ao){try{return am.EditDocument2(window,ak.onlineEditUrl,al)}catch(ap){try{return am.EditDocument(ak.onlineEditUrl,al)}catch(an){return false}}}},onActionEditOnlineAos:function R(ak){var aj=function al(ao){var ap=JSON.parse(ao.serverResponse.responseText);if(ap){var aq=ap.item.node;if(aq.isLocked){var am=Alfresco.util.arrayContains(aq.aspects,"cm:checkedOut");var ar=aq.properties["cm:lockOwner"];var an=ar.userName!==Alfresco.constants.USERNAME;if(am&&an){this._onAlreadyLockedConfirmation(ak,ar)}else{this._triggerEditOnlineAos(ak)}}else{this._triggerEditOnlineAos(ak)}}};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+ak.nodeRef.replace("://","/"),successCallback:{fn:aj,scope:this}})},_onAlreadyLockedConfirmation:function Y(aj,an){var am=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-online-aos.edit_offline_locked.title",an.displayName.length>0?an.displayName:an.userName),text:this.msg("message.edit-online-aos.edit_offline_locked.message"),buttons:[{text:this.msg("message.edit-online-aos.edit_offline_locked.confirm"),handler:function al(){this.destroy();am._triggerEditOnlineAos(aj)}},{text:this.msg("message.edit-online-aos.edit_offline_locked.cancel"),handler:function ak(){this.destroy()},isDefault:true}]})},_triggerEditOnlineAos:function T(aj){if(!aa(aj.onlineEditUrlAos)){aj.onlineEditUrlAos=Alfresco.util.onlineEditUrlAos(this.doclistMetadata.custom.aos,aj)}var am=Alfresco.util.getFileExtension(aj.location.file);am=am!=null?am.toLowerCase():am;var ak=this.getProtocolForFileExtension(am);if(ak===undefined){Alfresco.logger.error("onActionEditOnlineAos","No protocol handler available for file extension.");return}var al=new EmbeddedOfficeLauncher();if(al.isIOS()){this._aos_launchOfficeOnIos(al,ak,aj.onlineEditUrlAos);return}if(!al.isWin()&&!al.isMac()){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.no_supported_environment")});return}if(al.isAvailable()){this._aos_launchOfficeByPlugin(al,aj.onlineEditUrlAos)}else{this._aos_tryToLaunchOfficeByMsProtocolHandler(al,ak,aj.onlineEditUrlAos)}return},_aos_launchOfficeByPlugin:function B(an,al){var ak,ap;var am=(an.isFirefox()||an.isChrome()||an.isSafari());if(!an.EditDocument(al)){if(an.isControlNotActivated()&&am){ak=window.setInterval(function(){if(an.isControlActivated()){window.clearInterval(ak);ap.destroy();window.setTimeout(function(){if(!an.EditDocument(al)){if(an.getLastControlResult()!==-2){var aq=an.getLastControlResult()!==false?" (Error code: "+an.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+aq})}}else{YAHOO.Bubbling.fire("metadataRefresh")}},50)}},250);var ap=new YAHOO.widget.SimpleDialog("prompt",{close:false,constraintoviewport:true,draggable:false,effect:null,modal:true,visible:true,zIndex:9999});var ao="message.edit-online-aos.plugin_blocked.body.firefox";if(an.isFirefox()){ao="message.edit-online-aos.plugin_blocked.body.firefox"}else{if(an.isChrome()){ao="message.edit-online-aos.plugin_blocked.body.chrome"}else{if(an.isSafari()){ao="message.edit-online-aos.plugin_blocked.body.safari"}}}ap.setHeader(this.msg("message.edit-online-aos.plugin_blocked.caption"));ap.setBody(this.msg(ao));ap.cfg.queueProperty("buttons",[{text:this.msg("message.edit-online-aos.plugin_blocked.button_dismiss"),handler:function(){window.clearInterval(ak);this.destroy()},isDefault:true}]);ap.render(document.body);ap.center();ap.show()}else{if(an.getLastControlResult()!==-2){var aj=an.getLastControlResult()!==false?" (Error code: "+an.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+aj})}}}else{YAHOO.Bubbling.fire("metadataRefresh")}},_aos_tryToLaunchOfficeByMsProtocolHandler:function ab(al,ak,aj){location.href=ak+":ofe%7Cu%7C"+aj},_aos_launchOfficeOnIos:function z(an,al,ak){var aj=al+":ofe%7Cu%7C"+an.encodeUrl(ak);var am=document.createElement("iframe");am.setAttribute("style","display: none; height: 0; width: 0;");document.getElementsByTagName("body")[0].appendChild(am);am.src=aj},getProtocolForFileExtension:function(ak){var aj={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint",};return aj[ak]},onActionSimpleRepoAction:function g(ap,ak){if(ak.title.indexOf("_deactivated")==-1){var an=this.getAction(ap,ak).params,au=ap.displayName,at=["function","action","success","successMessage","failure","failureMessage","async"],aq={};for(var aj in an){if(an.hasOwnProperty(aj)&&!Alfresco.util.arrayContains(at,aj)){aq[aj]=an[aj]}}var ar=ak.title;ak.title=ak.title+"_deactivated";var am=an.async?"async="+an.async:null;var al={success:{event:{name:"metadataRefresh",obj:ap}},failure:{message:this.msg(an.failureMessage,au),fn:function ao(){ak.title=ar},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue",queryString:am},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:ap.nodeRef,actionDefinitionName:an.action,parameterValues:aq}}};if(YAHOO.lang.isFunction(this[an.success])){al.success.callback={fn:this[an.success],obj:ap,scope:this}}if(an.successMessage){al.success.message=this.msg(an.successMessage,au)}if(YAHOO.lang.isFunction(this[an.failure])){al.failure.callback={fn:this[an.failure],obj:ap,scope:this}}if(an.failureMessage){al.failure.message=this.msg(an.failureMessage,au)}this.modules.actions.genericAction(al)}},onActionFormDialog:function r(ak,aj){var al=this.generateConfigForFormDialogAction(ak,aj);Alfresco.util.PopupManager.displayForm(al)},onActionFormDialogWithSubmitDisable:function C(ak,aj){var al=this.generateConfigForFormDialogAction(ak,aj);al.properties.disableSubmitButton=true;Alfresco.util.PopupManager.displayForm(al)},generateConfigForFormDialogAction:function H(al,aj){var an=this.getAction(al,aj),ap=an.params,am={title:this.msg(an.label)},ak=al.displayName;delete ap["function"];var ao=ap.success;delete ap.success;am.success={fn:function(aq,ar){if(YAHOO.lang.isFunction(this[ao])){this[ao].call(this,aq,ar)}YAHOO.Bubbling.fire("metadataRefresh",ar)},obj:al,scope:this};if(ap.successMessage){am.successMessage=this.msg(ap.successMessage,ak);delete ap.successMessage}if(YAHOO.lang.isFunction(this[ap.failure])){am.failure={fn:this[ap.failure],obj:al,scope:this};delete ap.failure}if(ap.failureMessage){am.failureMessage=this.msg(ap.failureMessage,ak);delete ap.failureMessage}am.properties=ap;return am},onActionUploadNewVersion:function o(al){var ak=al.jsNode,ap=al.displayName,aq=ak.nodeRef,am=al.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ar=this.msg("label.filter-description",ap),an="*";if(ap&&new RegExp(/[^\.]+\.[^\.]+/).exec(ap)){an="*"+ap.substring(ap.lastIndexOf("."))}if(al.workingCopy&&al.workingCopy.workingCopyVersion){am=al.workingCopy.workingCopyVersion}var ao=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||W.hasClass(this.id,"alf-fullscreen"))){ao=1000}var aj={updateNodeRef:aq.toString(),updateFilename:ap,updateVersion:am,overwrite:true,filter:[{description:ar,extensions:an}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this},newVersion:true,jsNode:ak};this.fileUpload.options.zIndex=ao;if(aa(this.options.siteId)){aj.siteId=this.options.siteId;aj.containerId=this.options.containerId}this.fileUpload.show(aj)},_uploadComplete:function V(aj,an){var ao=aj.successful.length,ak,am;if(ao>0){if(ao<(this.options.groupActivitiesAt||5)){for(var al=0;al<ao;al++){am=aj.successful[al];ak={fileName:am.fileName,nodeRef:am.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+an,"document-details",ak)}}else{ak={fileCount:ao,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+an,"documentlibrary",ak)}}},onFileUploadComplete:function t(aj){this._uploadComplete(aj,"added")},onNewVersionUploadComplete:function D(aj){this._uploadComplete(aj,"updated")},onActionCancelEditing:function n(ak){var aj=ak.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",aj)},failure:{message:this.msg("message.edit-cancel.failure",aj)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:ak.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:ak})},onActionUnlockDocument:function ag(ak){var aj=ak.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.unlock-document.success",aj)},failure:{message:this.msg("message.unlock-document.failure",aj)},webscript:{method:Alfresco.util.Ajax.POST,name:"unlock-document/node/{nodeRef}",params:{nodeRef:ak.jsNode.nodeRef.uri}}})},onActionCopyTo:function m(aj){this._copyMoveTo("copy",aj)},onActionLinkTo:function m(aj){this._copyMoveTo("link",aj)},onActionMoveTo:function i(aj){this._copyMoveTo("move",aj)},onActionUnzipTo:function c(aj){this._copyMoveTo("unzip",aj)},_copyMoveTo:function K(an,al){if(!an in {copy:true,move:true,unzip:true}){throw new Error("'"+an+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var am=Alfresco.module.DoclibGlobalFolder;var aj=[am.VIEW_MODE_RECENT_SITES,am.VIEW_MODE_FAVOURITE_SITES,am.VIEW_MODE_SITE,am.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){aj.push(am.VIEW_MODE_REPOSITORY)}aj.push(am.VIEW_MODE_USERHOME);var ao=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||W.hasClass(this.id,"alf-fullscreen"))){ao=1000}var ak=undefined;if(W.hasClass(this.id,"alf-true-fullscreen")){ak=W.get(this.id)}this.modules.copyMoveTo.setOptions({allowedViewModes:aj,mode:an,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:al,rootNode:this.options.repositoryBrowsing?this.modules.copyMoveTo.options.rootNode:this.options.rootNode,repositoryRoot:this.options.repositoryRoot,parentId:this.getParentNodeRef(al),zIndex:ao,parentElement:ak?ak:undefined}).showDialog()},onActionAssignWorkflow:function e(ak){var ao="",aj=this.getParentNodeRef(ak);if(YAHOO.lang.isArray(ak)){for(var am=0,al=ak.length;am<al;am++){ao+=(am===0?"":",")+ak[am].nodeRef}}else{ao=ak.nodeRef}var an={selectedItems:ao};if(aj){an.destination=aj}Alfresco.util.navigateTo(L("start-workflow"),"POST",an)},onActionManagePermissions:function Q(aj){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:aj}).showDialog()},onActionTakeOwnership:function f(an,am){var aq=this,al=an.jsNode,ao=al.isContainer?"folder":"document",au=an.displayName,ar=0;var ax=this.msg("message.confirm.take-ownership",au);if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||W.hasClass(this.id,"alf-fullscreen"))){ar=1000}var av=undefined;var ak=W.get(this.id);var aj=navigator.userAgent.toLowerCase();if((aj.indexOf("gecko")!=-1||aj.indexOf("safari")!=-1)&&aj.indexOf("chrome")==-1){av=ak}var ap=[{text:this.msg("button.take-ownership"),handler:function at(){this.destroy();aq.onActionSimpleRepoAction.call(aq,an,am)}},{text:this.msg("button.cancel"),handler:function aw(){this.destroy()},isDefault:true}];Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.take-ownership.title"),text:ax,noEscape:true,buttons:ap})},onActionManageAspects:function v(aj){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:aj}).show()},onActionChangeType:function u(an){var aj=an.jsNode,ao=aj.type,aq=an.displayName,ak=Alfresco.constants.PROXY_URI+M("slingshot/doclib/type/node",aj.nodeRef.uri);var ar=function am(au){au.addValidation(this.id+"-changeType-type",function at(aA,aw,az,ay,av,ax){return aA.options[aA.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(ao),actionUrl:ak,doSetupFormsValidation:{fn:ar,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function ap(at){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:aq});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",aq)})},scope:this},onFailure:{fn:function al(at){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",aq)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function s(al,an){var am=al.node,ak=al.location.repositoryId,aj=this.options.replicationUrlMapping,ao;if(!ak||!aj||!aj[ak]){return"#"}ao=am.isContainer?an.folderDetailsUrl:an.documentDetailsUrl;ao=ao.substring(Alfresco.constants.URL_CONTEXT.length);return M(aj[ak],"/",ao)},onActionCloudSync:function ac(aj){if(l){l.destroy()}l=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var ak=this;YAHOO.Bubbling.on("folderSelected",function al(an,am){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:ak.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:am[1].selectedFolder.nodeRef}),successCallback:{fn:function ao(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},l);if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}l.setOptions({files:aj});this.modules.cloudAuth.setOptions({authCallback:l.showDialog,authCallbackContext:l}).checkAuth()},onActionCloudUnsync:function J(al){var aq=this,ap=al.jsNode.isContainer?"folder":"document",ak=al.displayName,ao=(this.options.syncMode==="CLOUD"),aj=ao?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+ap+".from.cloud",ak)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+ap+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",ak)+aj,buttons:[{text:this.msg("button.unsync"),handler:function am(){var ar=ao?false:W.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+al.jsNode.nodeRef.uri+"?requestDeleteRemote="+ar,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function at(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:aq.msg("message.unsync.success")})},scope:aq},failureMessage:aq.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function an(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function F(aj,an){var al=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(an),{text:this.msg("label.loading"),width:"455px"});al.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+aj.nodeRef.replace("://","/"),successCallback:{fn:function am(ap){var aq=this,ao={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,aj,ap.json,ao,function(at){if(at!=null){al.html(at.html);al.requestsync=Alfresco.util.createYUIButton(aq,"button-requestsyn",function(){aq.onActionCloudSyncRequest(aj);al.hide()},{id:aq.id});if(!at.showRequestSyncButton&&al.requestsync!=null){al.requestsync.setStyle("display","none")}al.unsync=Alfresco.util.createYUIButton(aq,"button-unsync",function(){aq.onActionCloudUnsync(aj);al.hide()},{id:aq.id});if(!at.showUnsyncButton&&al.unsync!=null){al.unsync.setStyle("display","none")}var ar=al.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(aq,ar);Alfresco.util.syncClickOnHideLinkEvent(aq,ar);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(aq,ar);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(aq,ar)}else{al.hide()}})},scope:this},failureCallback:{fn:function ak(ao){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function A(aj,al){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(aj)},successCallback:{fn:function ak(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(aj){var al=new Array();if(YAHOO.lang.isArray(aj)){for(var ak in aj){al.push(aj[ak].nodeRef)}}else{al.push(aj.nodeRef)}return al},onCloudSyncFailedIndicatorAction:function I(aj,ak){this.onCloudSyncIndicatorAction(aj,ak)},onCloudIndirectSyncIndicatorAction:function ae(aj,ak){this.onCloudSyncIndicatorAction(aj,ak)},onCloudIndirectSyncFailedIndicatorAction:function P(aj,ak){this.onCloudSyncIndicatorAction(aj,ak)},onActionFolderDownload:function y(aj){var ak=Alfresco.getArchiveAndDownloadInstance(),al={nodesToArchive:[{nodeRef:aj.nodeRef}],archiveName:aj.fileName};ak.show(al)},onActionDownload:function q(aj){var ak=Alfresco.getArchiveAndDownloadInstance(),al={nodesToArchive:[]};if(aj.length==1){al.nodesToArchive.push({nodeRef:aj[0].nodeRef});al.archiveName=aj[0].fileName}else{for(var am=0;am<aj.length;am++){al.nodesToArchive.push({nodeRef:aj[am].nodeRef})}}ak.show(al)},onActionQuickShare:function x(aj){var an=this,ap=[],ao="copy-shareable-links-to-clipboard";an.services.quickshare=new Alfresco.service.QuickShare();if(typeof aj.length==="undefined"){aj=[aj]}var al=[];for(var ak=0;ak<aj.length;ak++){if(!aj[ak].jsNode.isContainer){al.push(aj[ak])}}if(al.length==0){Alfresco.util.PopupManager.displayMessage({text:an.msg("message.multiple-quick-share-empty")})}else{for(var am=0;am<aj.length;am++){if(!aj[am].jsNode.isContainer){(function(aq){an.services.quickshare.share(aj[aq].nodeRef,{successCallback:{fn:function(at){var aw=at.json;var ax=YAHOO.lang.substitute(Alfresco.constants.QUICKSHARE_URL,{sharedId:aw.sharedId});if(ax.indexOf("/")==0){ax=window.location.protocol+"//"+window.location.host+ax}ap.push("<span>"+S(aj[aq].displayName)+" : "+ax+"</span>");if((aq==aj.length-1)||ap.length==al.length){var av=an.msg("title.multiple-quick-share");var ay=an.msg("message.multiple-quick-share",ap.length);ay+='<div class="quick-share-url-container">'+ap.join("")+"</div>";ay+='<textarea id="'+ao+'" style ="display:block; width:0; height:0; opacity: 0;">'+ap.join("\n").replace(/<span>/g,"").replace(/<\/span>/g,"")+"</textarea>";Alfresco.util.PopupManager.displayPrompt({title:av,text:ay,noEscape:true,modal:true,buttons:[{text:an.msg("button.ok"),handler:function au(){this.destroy()},isDefault:true},{text:an.msg("button.copy.to.clipboard"),handler:function ar(){if(document.selection){var aA=document.querySelector("#"+ao);aA.select();document.execCommand("copy")}else{if(window.getSelection){var aA=document.querySelector("#"+ao);aA.select();var az=document.execCommand("copy")}}Alfresco.util.PopupManager.displayMessage({text:an.msg("message.copy-shareable-links.success"),zIndex:1000})},isDefault:true}]})}},scope:this}})})(am)}}}}}})();