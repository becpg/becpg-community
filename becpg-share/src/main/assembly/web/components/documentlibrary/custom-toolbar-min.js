(function(){var g=YAHOO.util.Dom,k=YAHOO.util.Event,a=YAHOO.util.Element;var e=Alfresco.util.encodeHTML,f=Alfresco.util.siteURL;beCPG.custom.DocListToolbar=function j(l){beCPG.custom.DocListToolbar.superclass.constructor.call(this,l);return this};YAHOO.extend(beCPG.custom.DocListToolbar,Alfresco.DocListToolbar,{entityLinkCustomClass:null,onReady:function i(){if(g.get(this.id+"-tb-body")!=null){if(g.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var q=this.widgets.createContent.getMenu(),o=0;q.cfg.config.clicktohide.value=true;if(this.options.createContentActions.length!==0){var E=[],p,A,r,D,w,y,m,l;for(var B=0;B<this.options.createContentActions.length;B++){A=this.options.createContentActions[B];D={parent:q};r=null;if(A.type=="javascript"){D.onclick={fn:function(G,F,J){var I=Alfresco.util.deepCopy(this.doclistMetadata.parent);var H={nodeRef:I.nodeRef,node:I,jsNode:new Alfresco.util.Node(I)};this[J.params["function"]].call(this,H)},obj:A,scope:this};r="#"}else{if(A.type=="pagelink"){r=f(A.params.page);if(Alfresco.constants.SITE.length>0){r+="&siteId="+Alfresco.constants.SITE}}else{if(A.type=="link"){r=A.params.href}}}w='<a href="'+r+'" rel="'+A.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+A.icon+'-file-16.png)" class="'+A.icon+'-file">'+this.msg(A.label)+"</span></a>";y=document.createElement("li");y.innerHTML=w;p=new YAHOO.widget.MenuItem(y,D);E.push(p);if(A.id&&A.id==="folder"){m=p;l=B}}q.addItems(E,o);o++}if(this.options.createContentByTemplateEnabled){var y=document.createElement("li");y.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",y,true),"click",function(F){k.preventDefault(F);k.stopEvent(F)});var z=document.createElement("div");z.innerHTML='<div class="bd"><ul></ul></div>';var u=document.createElement("li");u.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-folder")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",u,true),"click",function(F){k.preventDefault(F);k.stopEvent(F)});var n=document.createElement("div");n.innerHTML='<div class="bd"><ul></ul></div>';var t=new YAHOO.widget.MenuItem(y,{parent:q,submenu:z});var C=new YAHOO.widget.MenuItem(u,{parent:q,submenu:n});q.addItems([t,C],o);o++;var s=this.widgets.createContent.getMenu().getSubmenus(),x=s.length>0?s[0]:null;if(x){x.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);x.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}var v=s.length>1?s[1]:null;if(v){v.subscribe("beforeShow",this.onCreateByTemplateFolderBeforeShow,this,true);v.subscribe("click",this.onCreateByTemplateFolderClick,this,true)}}q.subscribe("beforeShow",this.onCreateContentMenuBeforeShow,{createContentMenu:q,folderMenuItem:m||null,folderMenuItemIndex:l||0,createFolderByTemplateItem:C||null,createFolderByTemplateItemIndex:1,createFolderByTemplateGroupIndex:o-1,context:this},true);q.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.syncToCloud=Alfresco.util.createYUIButton(this,"syncToCloud-button",this.onSyncToCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.syncToCloud);this.widgets.unsyncFromCloud=Alfresco.util.createYUIButton(this,"unsyncFromCloud-button",this.onUnsyncFromCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.unsyncFromCloud);this.widgets.bulkEdit=Alfresco.util.createYUIButton(this,"bulkEdit-button",this.onBulkEdit,{disabled:false});this.dynamicControls.push(this.widgets.bulkEdit);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);if(g.get(this.id+"hideNavBar-button")){this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));this.dynamicControls.push(this.widgets.hideNavBar)}}g.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);g.setStyle(this.id+"-tb-body","visibility","visible")}this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences()},onBulkEdit:function c(n,m,l){window.location.href=f("bulk-edit?nodeRef="+this.doclistMetadata.parent.nodeRef)},onDoclistMetadata:function d(m,l){var n=l[1];this.entityLinkCustomClass=null;this.folderDetailsUrl=null;if(n&&n.metadata){this.doclistMetadata=Alfresco.util.deepCopy(n.metadata);if(n.metadata.parent&&n.metadata.parent.nodeRef){if(beCPG.util.isEntity(n.metadata.parent)){this.entityLinkCustomClass=n.metadata.parent.type.replace(":","-");this.folderDetailsUrl=f("entity-data-lists?list=View-properties&nodeRef="+n.metadata.parent.nodeRef)}else{this.folderDetailsUrl=f("folder-details?nodeRef="+n.metadata.parent.nodeRef)}}}},onFileUpload:function b(n,o){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var l={filter:[],mode:this.fileUpload.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};if(this.options.disableSiteMode){l.destination=this.doclistMetadata.parent.nodeRef}else{l.siteId=this.options.siteId;l.containerId=this.options.containerId;l.uploadDirectory=this.currentPath}this.fileUpload.show(l);if(YAHOO.lang.isArray(o)&&o[1].tooltip){var m=Alfresco.util.createBalloon(this.fileUpload.uploader.id+"-dialog",{html:o[1].tooltip,width:"30em"});m.show();this.fileUpload.uploader.widgets.panel.hideEvent.subscribe(function(){m.hide()})}},_generateBreadcrumb:function h(){var z=g.get(this.id+"-breadcrumb");if(z===null){return}z.innerHTML="";var A=this.currentPath.split("/");if(this.currentPath==="/"){A=["/"]}var F=this,u=A.concat();u[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);if(u[0]=="node.root"){u[0]=this.msg("node.root")}var v=function t(H,G){g.addClass(H.target.parentNode,"highlighted");k.stopEvent(H)};var o=function q(I,H){var G=F.currentFilter;G.filterData=H;YAHOO.Bubbling.fire("changeFilter",G);k.stopEvent(I)};var l=new a(z),m,x,y,r,p=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListTree"),E;if(p&&p.selectedNode){E=p.selectedNode}var n=function s(I){if(!E){return}var G=E;if(I){for(var H=I;H>1;H--){if(G.parent){G=G.parent}}}return G.customCls};for(var D=0,B=A.length;D<B;++D){m=A.slice(0,D+1).join("/");x=new a(document.createElement("div"));x.addClass("crumb");x.addClass("documentDroppable");x.addClass("documentDroppableHighlights");if(D>0){y=new a(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});y.on("click",o,m);y.addClass("icon");if(B-D<2&&this.entityLinkCustomClass!=null){y.addClass("entity");y.addClass(this.entityLinkCustomClass)}y.addClass("filter-"+e(this.currentFilter.filterId));y.addClass(n(B-D));x.appendChild(y)}if(B-D<2){r=new a(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+e(u[D])+"</a>":e(u[D])});r.addClass("label");x.appendChild(r);l.appendChild(x)}else{r=new a(document.createElement("a"),{href:"",innerHTML:e(u[D])});r.addClass("folder");r.on("click",o,m);x.appendChild(r);l.appendChild(x);l.appendChild(new a(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var w=g.get(this.id+"-breadcrumb");var C=g.getElementsByClassName("crumb","div",w);for(var D=0,B=C.length;D<B;D++){new YAHOO.util.DDTarget(C[D])}}})})();