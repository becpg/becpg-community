(function(){var c=Alfresco.util.siteURL;Alfresco.CreateContentMgr=function i(k){Alfresco.CreateContentMgr.superclass.constructor.call(this,"Alfresco.CreateContentMgr",k);YAHOO.Bubbling.on("formContentReady",this.onFormContentReady,this);YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);return this};YAHOO.extend(Alfresco.CreateContentMgr,Alfresco.component.Base,{options:{isContainer:false,siteId:null,isEntity:false},onFormContentReady:function a(m,k){var l=k[1].buttons.submit;l.set("label",this.msg("button.create"));l.addListener("click",this.onSubmitButtonClick,null,this);var n=k[1].buttons.cancel;n.addListener("click",this.onCancelButtonClick,null,this)},onBeforeFormRuntimeInit:function j(l,k){k[1].runtime.setAJAXSubmit(true,{successCallback:{fn:this.onCreateContentSuccess,scope:this},failureCallback:{fn:this.onCreateContentFailure,scope:this}})},onCreateContentSuccess:function d(k){var m=null,l=this;if(k.json&&k.json.persistedObject){m=new Alfresco.util.NodeRef(k.json.persistedObject);if(this.options.siteId&&this.options.siteId!==""&&(!this.options.isContainer||this.options.isEntity)){beCPG.util.postActivity(this.options.siteId,"org.alfresco.documentlibrary."+(this.options.isEntity?"entity":"file")+"-created","{cm:name}",this._getDetailsUrl(m),{appTool:"documentlibrary",nodeRef:m.toString()},function(){l._navigateForward(m)})}else{this._navigateForward(m)}}else{this._navigateForward(m)}},onCreateContentFailure:function g(k){var l=this.msg("create-content-mgr.create.failed");if(k.json&&k.json.message){l=l+": "+k.json.message}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:l})},onSubmitButtonClick:function e(l,k){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.create.please-wait"),displayTime:0})},onCancelButtonClick:function f(l,k){this._navigateForward()},_navigateForward:function b(k){if(YAHOO.lang.isObject(k)){window.location.href=c(this._getDetailsUrl(k))}else{if(document.referrer){if(document.referrer.match(/documentlibrary([?]|$)/)||document.referrer.match(/repository([?]|$)/)){history.go(-1)}else{document.location.href=document.referrer}}else{if(this.options.siteId&&this.options.siteId!==""){window.location.href=c("documentlibrary")}else{window.location.href=Alfresco.constants.URL_CONTEXT}}}},_getDetailsUrl:function h(k){if(this.options.isEntity){return"entity-data-lists?list=View-properties&nodeRef="+k.toString()}return(this.options.isContainer?"folder":"document")+"-details?nodeRef="+k.toString()}})})();