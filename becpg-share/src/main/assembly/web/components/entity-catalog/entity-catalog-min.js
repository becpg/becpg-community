(function(){beCPG.component.EntityCatalog=function(b){beCPG.component.EntityCatalog.superclass.constructor.call(this,"beCPG.component.EntityCatalog",b,["button","container"]);return this};YAHOO.extend(beCPG.component.EntityCatalog,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.EntityCatalog.prototype,{options:{entityNodeRef:"",catalogId:null},onReady:function a(){var b=this;function d(s){if(s.catalogs!==undefined&&s.catalogs!=null&&Object.keys(s.catalogs).length>0){var i=s.catalogs;var m='<div class="entity-catalog">';for(var r in i){var h=i[r].score;var q=i[r].locale;var p=i[r].label;var k=i[r].id;var j=i[r].color;if(b.options.catalogId==null||b.options.catalogId==k){var l=i[r].modifiedDate;var g=null;if(q!==undefined&&q!=null){k=k+"_"+q;g=q.toLowerCase();if(q.indexOf("_")>0){g=q.split("_")[1].toLowerCase()}}m+='<div class="catalog '+(r==0?"first-catalog":"")+'">';m+='<div class="catalog-header set-bordered-panel-heading">';m+='<table><tr><td><span style="background-color: '+j+';" class="catalog-color" ></span><span class="catalog-name">'+b.msg("label.catalog")+" "+p+(g!=null?"<img title="+b.msg("locale.name."+q)+' src="/share/res/components/images/flags/'+g+'.png">':"")+"</span></td>";m+='<td><progress value="'+(h/100)+'">';m+='<div class="progress-bar">';m+='<span style="width: '+h+'%;">'+h+"%</span>";m+="</div>";m+="</progress></td></tr><tr>";if(l!=null){m+='<td><span class="date-info">';m+=b.msg("label.modifiedDate",Alfresco.util.relativeTime(Alfresco.util.fromISO8601(l))+" ("+Alfresco.util.formatDate(l,b.msg("date.format"))+")");m+="</span></td>"}else{m+="<td></td>"}m+='<td><span class="score-info">'+Math.floor(h)+" % "+b.msg("label.completed")+"</span></td>";m+="</tr></table></div>";if(i[r].missingFields!==undefined||i[r].nonUniqueFields!==undefined){m+='<div class="catalog-details">'}if(i[r].missingFields!==undefined){m+="<h3 >"+b.msg("label.missing_properties")+"</h3>";m+='<ul class="catalog-missing-propList">';for(var o in i[r].missingFields){var n=null;if(i[r].missingFields[o].locale!=null){n=i[r].missingFields[o].locale.toLowerCase();if(i[r].missingFields[o].locale.indexOf("_")>0){n=i[r].missingFields[o].locale.split("_")[1].toLowerCase()}}m+='<li class="missing-field" >'+i[r].missingFields[o].displayName+(n!=null?"<img title="+b.msg("locale.name."+i[r].missingFields[o].locale)+' src="/share/res/components/images/flags/'+n+'.png">':"")+"</li>"}m+="</ul>"}if(i[r].nonUniqueFields!==undefined){m+="<h3>"+b.msg("label.non-unique-properties")+"</h3>";m+='<ul class="catalog-missing-propList">';for(var o in i[r].nonUniqueFields){m+='<li class="non-unique-field" >'+i[r].nonUniqueFields[o].displayName+"</li>"}m+="</ul>"}if(i[r].missingFields!==undefined||i[r].nonUniqueFields!==undefined){m+="</div>"}m+="</div>"}}m+="</div>";return m}else{return'<span class="no-missing-prop">'+b.msg("label.no_missing_prop")+"</span>"}}function e(z,s){if(z.catalogs!==undefined&&z.catalogs!=null&&Object.keys(z.catalogs).length>0){var n=z.catalogs;var x=0;for(var F in n){var v=n[F].color;var q=document.createElement("SPAN");q.style.backgroundColor=v;q.className+="catalog-color";q.title=b.msg("label.catalog")+" '"+n[F].label+(n[F].locale!==undefined&&n[F].locale.length==1?"("+n[F].locale+")'":"'");if(n[F].missingFields!==undefined){var y=n[F].id;if(b.options.catalogId==null||b.options.catalogId==y){var w=n[F].locale;if(w!==undefined&&w!=null){y=y+"_"+w}var B=b.id+"_"+y+"_missingPropLabel";if(n[F].missingFields.length>0){var o=YAHOO.util.Dom.get(B);if(o!==undefined&&o!=null){o.parentNode.insertBefore(q.cloneNode(false),o.nextSibling)}}for(var g in n[F].missingFields){var E=new Array();var k=n[F].missingFields[g].id;if(k.indexOf("|")>-1){E=k.split("|")}else{E.push(k)}for(var g in E){var u="";var l=E[g].replace(":","_");var p=YAHOO.util.Dom.get(s+"_assoc_"+l);u=s+"_assoc_"+l+"-cntrl";if(p===undefined||p==null){p=YAHOO.util.Dom.get(s+"_prop_"+l);u=s+"_prop_"+l}if(p!==undefined&&p!=null){if(p.className.indexOf("multi-assoc")!=-1){p=p.parentNode}var A=document.getElementsByTagName("label");for(var r=0;r<A.length;r++){var h=A[r];var D=false;if(h.htmlFor.indexOf(u)!=-1&&h.parentNode.innerHTML.indexOf(q.style.backgroundColor)==-1){if(h.childNodes){for(var m in h.childNodes){var j=h.childNodes[m];if(j.nodeType==Node.ELEMENT_NODE&&j.className.indexOf("locale-icon")!=-1){D=true;break}}}if(D){h.appendChild(q.cloneNode(false))}else{h.innerHTML+=q.outerHTML}}}}else{var C="missing-field_"+n[F]+"_"+n[F].missingFields[g].displayName;var t=YAHOO.util.Dom.get(C);if(t!==undefined&&t!=null){t.outerHTML=""}}}}}}x++}}}YAHOO.util.Dom.get(this.id+"-entity-catalog").innerHTML='<span class="wait">'+Alfresco.util.encodeHTML(this.msg("label.loading"))+"</span>";var f=YAHOO.util.Selector.query("div.formulate");YAHOO.util.Dom.addClass(f,"loading");var c=Alfresco.constants.PROXY_URI+"becpg/entity/catalog/node/"+b.options.entityNodeRef.replace(":/","");if(b.options.catalogId!=null){c+="?catalogId="+b.options.catalogId}Alfresco.util.Ajax.request({url:c,method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(g){if(g.json!=null&&g.json!==undefined){var i=d(g.json),l=YAHOO.util.Dom.get(this.id+"-entity-catalog");l.innerHTML=i;if(g.json.catalogs!=null&&g.json.catalogs!==undefined&&Object.keys(g.json.catalogs).length>0){var h=this.id.replace("wizard-mgr","%%%").replace("_cat","").replace("-mgr","").replace("%%%","wizard-mgr");var k=YAHOO.util.Dom.get(h+"-form");if(k!==undefined&&k!=null){var j=YAHOO.util.Dom.get(h);YAHOO.util.Dom.addClass(j,"inline-block");YAHOO.util.Dom.addClass(l,"inline-block");YAHOO.util.Dom.addClass(l,"catalogs");YAHOO.util.Dom.insertAfter(l,j);YAHOO.util.Dom.removeClass(this.id+"-entity-catalog","hidden")}YAHOO.util.Event.onAvailable(h+"-form",function(){e(g.json,h)},this)}}YAHOO.util.Dom.removeClass(f,"loading")},scope:b},failureCallback:{fn:function(g){if(g.json&&g.json.message){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.formulate.failure"),text:g.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.failure")})}YAHOO.util.Dom.removeClass(f,"loading")},scope:this},execScripts:true})}})})();