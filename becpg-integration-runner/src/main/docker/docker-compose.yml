version: '2'
volumes:
  becpg_data_db:
  solr_data:
  becpg_data:
services:
  becpg:
    image: ${docker.becpg.url}/becpg-${becpg.dockerbuild.name}:${docker.becpg.tag}
    environment:
      CATALINA_OPTS: -Xmx4G -Duser.language=fr -Duser.country=FR -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=0.0.0.0:8888
      JAVA_HOME: /usr/java/dcevm-11.0.1+8
    ports:
      - "8080:8080"
      - "8888:8888"  
    volumes:
      - becpg_data:/usr/local/tomcat/data
      - ../../becpg-core/target/classes:/usr/local/tomcat/hotswap-agent/becpg-core/target/classes
      - ../../becpg-plm/becpg-plm-core/target/classes:/usr/local/tomcat/hotswap-agent/becpg-plm-core/target/classes
      - ../../becpg-project/becpg-project-core/target/classes:/usr/local/tomcat/hotswap-agent/becpg-project-core/target/classes
      - ../../becpg-integration-runner/target/test-classes:/usr/local/tomcat/hotswap-agent/becpg-integration-runner/target/test-classes
  becpg-db:
    image: ${docker.becpg.url}/becpg-db:${docker.becpg.tag}
    environment:
      MYSQL_DATABASE: db
      MYSQL_PASSWORD: becpg
      MYSQL_ROOT_PASSWORD: becpg
      MYSQL_USER: becpg
    volumes:
      - becpg_data_db:/var/lib/mysql
  solr:
      image: ${docker.becpg.url}/becpg-solr:${docker.becpg.tag}
      environment:
      - SOLR_JAVA_MEM=-Xmx2g
      volumes:
      - solr_data:/opt/alfresco-search-services/data
      ports:
          - "8983:8983"  

  becpg-report:
    image:  ${docker.becpg.url}/becpg-report:2.2.5

 
