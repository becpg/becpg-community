(function(){var d=YAHOO.util.Dom,a=YAHOO.util.Selector;beCPG.component.ProjectListToolbar=function b(j){beCPG.component.ProjectListToolbar.superclass.constructor.call(this,"beCPG.component.ProjectListToolbar",j,["button"]);this.services.preferences=new Alfresco.service.Preferences();return this};YAHOO.extend(beCPG.component.ProjectListToolbar,Alfresco.component.Base,{options:{view:"dataTable",siteId:"",filters:[],simpleView:0,prefsId:null},onReady:function h(){if(this.options.view=="dataTable"){this.widgets.simpleDetailed=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.simpleDetailed!==null){this.widgets.simpleDetailed.check(this.options.simpleView?0:1);this.widgets.simpleDetailed.on("checkedButtonChange",this.onSimpleDetailed,this.widgets.simpleDetailed,this)}}this.widgets.showGanttButton=Alfresco.util.createYUIButton(this,"show-gantt-button",this.onGanttButtonClick);this.widgets.showPlanningButton=Alfresco.util.createYUIButton(this,"show-planning-button",this.onPlanningButtonClick);this.widgets.showResourcesButton=Alfresco.util.createYUIButton(this,"show-resources-button",this.onResourcesButtonClick);this.widgets.exportProjectList=Alfresco.util.createYUIButton(this,"export-csv-button",this.onExportProjectList);if(d.get(this.id+"-reporting-menu-button")){this.widgets.reportingMenu=Alfresco.util.createYUIButton(this,"reporting-menu-button",this.onReportingMenuClick,{type:"menu",menu:"reporting-menu",lazyloadmenu:true,disabled:true,zindex:99});this.widgets.reportingMenu.getMenu().subscribe("beforeShow",function(){this.cfg.setProperty("zindex",99)});this.widgets.reportingMenu.set("label",this.msg("button.download-report")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"becpg/report/exportsearch/templates/pjt:project",successCallback:{fn:function(k){var n=this,m=k.json,j=[];if(m!==null){for(var l in m.reportTpls){j.push({text:m.reportTpls[l].name,value:m.reportTpls[l].nodeRef+"#"+m.reportTpls[l].name+"."+m.reportTpls[l].format.toString().toLowerCase()})}if(j.length>0){n.widgets.reportingMenu.getMenu().addItems(j);n.widgets.reportingMenu.getMenu().render(document.body);n.widgets.reportingMenu.set("disabled",false)}}},scope:this},failureMessage:"Could not get project reports '"+Alfresco.constants.PROXY_URI+"becpg/report/exportsearch/templates/pjt:project'."})}if(this.options.view=="gantt"){this.widgets.showGanttButton.set("disabled",true)}else{if(this.options.view=="resources"){this.widgets.showResourcesButton.set("disabled",true)}else{this.widgets.showPlanningButton.set("disabled",true)}}d.removeClass(a.query(".hidden",this.id+"-body",true),"hidden")},onReportingMenuClick:function f(l,k){var n=k[1];if(n){var j=n.value.split("#");var m=Alfresco.constants.PROXY_URI+"becpg/report/exportsearch/"+j[0].replace("://","/")+"/"+encodeURIComponent(j[1]);m+="?term=&query="+encodeURIComponent('{datatype:"pjt:project"}');if(this.options.siteId.length!==0){m+="&site="+this.options.siteId+"&repo=false"}else{m+="&site=&repo=true"}document.location.href=m}},onSimpleDetailed:function c(k,l){var j=(k.newValue.index===0);if(this.options.prefsId){this.services.preferences.set(this.options.prefsId+".simpleView",j)}YAHOO.Bubbling.fire("simpleDetailedChanged",{simpleView:j})},onGanttButtonClick:function i(j,k){document.location.href=Alfresco.util.siteURL("project-list?view=gantt"+window.location.hash)},onResourcesButtonClick:function i(j,k){document.location.href=Alfresco.util.siteURL("project-list?view=resources"+window.location.hash)},onPlanningButtonClick:function e(j,k){document.location.href=Alfresco.util.siteURL("project-list"+window.location.hash)},onExportProjectList:function g(k,l){var j=Alfresco.util.ComponentManager.find({name:"beCPG.module.EntityDataGrid"})[0];Alfresco.util.Ajax.jsonGet({url:j._getColumnUrl("export"),successCallback:{fn:function(q){var t={fields:[],filter:j.currentFilter,page:1,extraParams:j.options.extraParams};t.filter.filterParams=j._createFilterURLParameters(j.currentFilter,j.options.filterParameters);for(var s=0,u=q.json.columns.length;s<u;s++){var p=q.json.columns[s],o=p.name.replace(":","_");if(p.dataType=="nested"&&p.columns){for(var r=0;r<p.columns.length;r++){var n=p.columns[r];o+="|"+n.name.replace(":","_")}}t.fields.push(o)}var m=5000;document.location.href=j._getDataUrl(m)+"&format=xlsx&metadata="+encodeURIComponent(YAHOO.lang.JSON.stringify(t))},scope:this}})}})})();