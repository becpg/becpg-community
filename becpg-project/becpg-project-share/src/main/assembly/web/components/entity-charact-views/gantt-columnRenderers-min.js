(function(){if(beCPG.module.GanttViewRendererHelper){YAHOO.Bubbling.fire("registerGanttRenderer",{typeName:"pjt:taskList",ganttInitialiser:function(b){var a=Alfresco.constants.PROXY_URI+"becpg/project/info"+(this.options.siteId!=null&&this.options.siteId.length>0?"?site="+this.options.siteId:"");Alfresco.util.Ajax.request({url:a,successCallback:{fn:function(c){var j=c.json.legends,f="";for(var e in j){var h={id:j[e].nodeRef,label:j[e].label,color:j[e].color.replace("#","")};this.taskLegends.push(h);f+='<span class="task-legend" style="background-color:#'+h.color+'" ></span><span>'+h.label+"</span>&nbsp;"}Dom.get(this.id+"-legend").innerHTML=f;var k=function d(){var x=this.widgets.dataTable.getRecordSet();if(x.getLength()!=0){g=new JSGantt.GanttChart("g",Dom.get(this.id+"-gantt"),g!=null?g.getFormat():null);g.setDateInputFormat("mediumDate");g.setDateDisplayFormat("mediumDate");g.setCaptionType("Resource");var o=new Date();var y=null;for(var A=0;A<x.getLength();A++){var D=x.getRecord(A);var B=D.getData();var m=B.nodeRef;var t="";var l=0;var C=null;if(B.itemData["prop_bcpg_parentLevel"].value!=null){l=B.itemData["prop_bcpg_parentLevel"].value}else{if(B.itemData.isMultiLevel){l=y}}if(!B.itemData.isMultiLevel){y=m}if(B.itemData["assoc_pjt_subProjectRef"]!=null&&B.itemData["assoc_pjt_subProjectRef"].length>0){C=B.itemData["assoc_pjt_subProjectRef"][0].displayValue}var w=1;if(C!=null&&!B.itemData["open"]){w=0}var s=!B.itemData["prop_pjt_tlIsGroup"].value?0:1;for(var u in B.itemData["assoc_pjt_tlPrevTasks"]){var p=B.itemData["assoc_pjt_tlPrevTasks"][u].value;if(t.length>0){t+=","}t+=p;if(this.cache[p]!=null&&this.cache[p].end!=null&&this.cache[p].end.getTime()>o.getTime()){o=this.cache[p].end}}var q=B.itemData["prop_pjt_tlIsMilestone"].value;var r=B.itemData["prop_pjt_completionPercent"].value;var n=null;if(B.itemData["assoc_pjt_tlResources"].length>0){n="";for(var u in B.itemData["assoc_pjt_tlResources"]){if(B.itemData["assoc_pjt_tlResources"][u].displayValue!=null){n+='<span class="resource-title">'+B.itemData["assoc_pjt_tlResources"][u].displayValue.replace("null","").trim()+"</span>"}}}var v=this.cache[m];if(!v){v=this.extractDates(B,o,true);this.cache[m]=v}g.AddTaskItem(new JSGantt.TaskItem(m,this.getTaskTitle(B,this.options.entityNodeRef),v.start,v.end,this.getTaskColor(B),null,q?1:0,n,r,s,l,w,t,null,B.color,C))}this.refreshView()}else{Alfresco.util.populateHTML([this.id+"-gantt",'<div class="yui-dt-liner">'+this.msg("message.empty")+"</div>"])}};this.extraAfterDataGridUpdate.push(k);this.initTaskHandlers();b.call(this)},scope:this}})}})}})();