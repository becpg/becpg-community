function isNullOrEmpty(a){if(a==null||a==""){return true}else{return false}}function concatName(a,b){if(a!=""&&b!=""){a+=" "}a+=b;return a}function getProp(b,a){if(b!=null&&b!=""&&b.properties[a]!=null){return b.properties[a]}else{return""}}function getMLProp(c,b,a){if(c!=null&&c!=""&&bcpg.getMLProperty(c,b,a)!=null){return bcpg.getMLProperty(c,b,a)}else{return""}}function getMLConstraint(c,b,a){if(c!=null&&c!=""&&bcpg.getMLConstraint(c,b,a)!=null){return bcpg.getMLConstraint(c,b,a)}else{return""}}function getAssoc(c,b,a){if(c!=null&&c!=""&&c.assocs[b]!=null){if(a!=null&&c.assocs[b][0].properties[a]!=null&&c.assocs[b][0].properties[a]!=""){return c.assocs[b][0].properties[a]}return c.assocs[b][0].name}else{return""}}function removeForbiddenChar(a){return a.replace(/[|"<>.*?:+\/]/g,"").replace(/ -/g,"")}function classifyByHierarchy(d,a,b){if(a!=null){var c=actions.create("classify-by-hierarchy");c.parameters["destination-folder"]=a;if(b){c.parameters["prop-hierarchy"]=b}c.execute(d.nodeRef)}}function isInSite(b,a){if(b.qnamePath.indexOf("/app:company_home/st:sites/cm:"+a+"/")!=-1){return true}return false}function isInUserFolder(a){if(a.qnamePath.indexOf("/app:company_home/app:user_homes")!=-1){return true}return false}function isInFolder(d,a){var b=0;var c=d.parent;while(c.isContainer){b++;if(b>10){break}if(c.parent===null){return false}if(c.getNodeRef()==a){return true}c=c.parent}return false}function getDocumentLibraryNodeRef(b){var a=siteService.getSite(b);return a.getContainer("documentLibrary")}function rename(b){var a=getProp(b,"cm:title");if(a!=null&&a!=""){a=removeForbiddenChar(a.trim().toUpperCase());a=concatName(getProp(b,"bcpg:erpCode"),a);if(a!=""&&b.properties["cm:name"]!=a&&b.parent.childByNamePath(a)==null){b.properties["cm:name"]=a;b.save()}}}const SIMULATION_SITE_ID="simulation";const VALID_SITE_ID="valid";const ARCHIVED_SITE_ID="archived";function main(){if(!document.hasAspect("bcpg:entityTplAspect")&&!document.hasAspect("cm:workingcopy")){var a="";if(document.isSubType("bcpg:product")){a=document.properties["bcpg:productState"]}else{if(document.isSubType("bcpg:client")){a=document.properties["bcpg:clientState"]}else{if(document.isSubType("bcpg:supplier")){a=document.properties["bcpg:supplierState"]}}}if(a=="Valid"){if(!isInSite(document,VALID_SITE_ID)){classifyByHierarchy(document,getDocumentLibraryNodeRef(VALID_SITE_ID))}}else{if(a=="Simulation"||a=="ToValidate"){if(isInSite(document,VALID_SITE_ID)||isInSite(document,ARCHIVED_SITE_ID)){bcpg.moveAndRename(document,getDocumentLibraryNodeRef(SIMULATION_SITE_ID))}}else{if(a=="Archived"){if(!isInSite(document,ARCHIVED_SITE_ID)){classifyByHierarchy(document,getDocumentLibraryNodeRef(ARCHIVED_SITE_ID))}}}}}}main();