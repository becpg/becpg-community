define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/EcmWarningBar.html","alfresco/core/Core","dojo/dom-style","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","alfresco/core/CoreXhr","dojo/on"],function(d,j,o,m,b,f,i,a,c,l,h){return d([j,o,b,l],{i18nRequirements:[{i18nFile:"./i18n/EcmWarningBar.properties"}],cssRequirements:[{cssFile:"./css/EcmWarningBar.css"}],templateString:m,changeOrderData:null,constructor:function n(p){a.mixin(this,p);this.alfSubscribe("BECPG_ECM_CREATED_SUCCESS",a.hitch(this,"onEcmCreatedSuccess"))},onEcmCreatedSuccess:function k(p){this.addEcmBarHtml(p)},postCreate:function g(){this.alfPublish("ALF_PREFERENCE_GET",{preference:"fr.becpg.ecm.currentEcmNodeRef",callback:function(r){if(r!=null){var q=Alfresco.constants.PROXY_URI+"becpg/ecm/changeorder/"+r.replace(":/","")+"/infos";this.serviceXhr({url:q,method:"GET",successCallback:function(t,s){if(typeof t=="string"){var t=JSON.parse(this.cleanupJSONResponse(t))}this.addEcmBarHtml(t)},failureCallback:function(t,s){f.set(this.domNode,"display","none")},callbackScope:this})}},callbackScope:this});this.stopRecording.innerHTML=this.message("ecm.warning.bar.stop.recording");var p=this;h(this.stopRecording,"click",function(q){if(p.changeOrderData!=null){p.alfPublish("ALF_PREFERENCE_SET",{preference:"fr.becpg.ecm.currentEcmNodeRef",value:null})}p.changeOrderData=null;f.set(p.domNode,"display","none")})},addEcmBarHtml:function e(p){this.changeOrderData=p;c.create("span",{innerHTML:this.message("ecm.warning.bar.message")},this.messageBox);c.create("a",{href:Alfresco.constants.URL_PAGECONTEXT+"entity-data-lists?list=View-properties&nodeRef="+p.nodeRef,innerHTML:p.name},this.messageBox);f.set(this.domNode,"display","block")}})});