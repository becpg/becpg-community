define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","dojo/sniff","dijit/registry","alfresco/core/CoreXhr","alfresco/core/NotificationUtils","alfresco/dialogs/AlfDialog","alfresco/buttons/AlfButton"],function(i,c,b,n,a,m,e,o,l){return i([c,m,e],{i18nRequirements:[{i18nFile:"./i18n/EcmService.properties"}],constructor:function h(p){b.mixin(this,p);this.alfSubscribe("BECPG_ECM_AUTOMATIC_CHANGE",b.hitch(this,"onEcmAutomaticChange"))},detailsDialog:null,createNewEcm:"BECPG_CREATE_AUTO_ECO",cancelAutoEcmDialog:"BECPG_CANCEL_AUTO_ECO_DIALOG",onEcmAutomaticChange:function j(p){if(this.detailsDialog==null){this.alfSubscribe(this.createNewEcm,b.hitch(this,"onCreateNewEcm"));this.alfSubscribe(this.cancelAutoEcmDialog,b.hitch(this,"onCreateNewEcmCancel"));this.detailsDialog=new o({title:this.message("ecm.auto.dialog.create.title"),widgetsContent:[{name:"alfresco/forms/controls/TextBox",config:{id:this.id+"_ECM_NAME",name:"name",label:this.message("ecm.auto.dialog.field.name.label"),description:this.message("ecm.auto.dialog.field.name.description"),validationConfig:[{validation:"regex",regex:'^[^"*\\><?/:|]+$',errorMessage:this.message("ecm.auto.dialog.validate.name")}]}}],widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("button.create-ecm"),publishTopic:this.createNewEcm,publishPayload:p,disableOnInvalidControls:true}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("button.cancel-create-ecm"),publishTopic:this.cancelAutoEcmDialog,publishPayload:p}}]})}this.detailsDialog.show()},onCreateNewEcm:function k(s){var q=a.byId(this.id+"_ECM_NAME");if(q!=null){var r=q.getValue();if(r!=null&&r.length>0){var p=Alfresco.constants.PROXY_URI+"becpg/ecm/changeorder/create";this.serviceXhr({url:p,data:{name:q.getValue()},method:"POST",successCallback:this.ecmCreatedSuccess,failureCallback:this.ecmCreatedFailure,callbackScope:this})}}},onCreateNewEcmCancel:function f(r){var p=a.byId(this.id+"_ECM_NAME");if(p!=null){var q=p.setValue("")}},ecmCreatedSuccess:function g(q,p){if(typeof q=="string"){var q=JSON.parse(this.cleanupJSONResponse(q))}this.displayMessage(this.message("message.ecm.created.success"));this.alfPublish("BECPG_ECM_CREATED_SUCCESS",q)},ecmCreatedFailure:function d(q,p){if(typeof q=="string"){var q=JSON.parse(this.cleanupJSONResponse(q))}this.displayMessage(this.message("message.ecm.created.failure"));this.alfPublish("BECPG_ECM_CREATED_FAILURE",q)}})});