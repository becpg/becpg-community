(function(){beCPG.component.FormulationView=function(d){beCPG.component.FormulationView.superclass.constructor.call(this,"beCPG.component.FormulationView",d,["button","container"]);var e=1;YAHOO.Bubbling.on("dataGridReady",function(g,f){if(e==3){try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(i){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",i);var h=f[1];if((h!==null)&&(h.entityDataGridModule!==null)){h.entityDataGridModule.onHistoryManagerReady()}}}e++});YAHOO.Bubbling.on("dirtyDataTable",this.formulate,this);return this};YAHOO.extend(beCPG.component.FormulationView,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.FormulationView.prototype,{options:{siteId:"",entityNodeRef:"",list:"",customLists:null,customListName:"",effectiveFilterOn:true},onReady:function b(){var d=this;YAHOO.util.Event.addListener("dynamicCharactList-"+this.id+"-colCheckbox","click",function(f){YAHOO.Bubbling.fire("dynamicCharactList-"+d.id+"refreshDataGrid")});this.widgets.customList=Alfresco.util.createYUIButton(this,"customLists",this.onCustomListChange,{type:"menu",menu:"customLists-menu",lazyloadmenu:false});this.widgets.customList.set("label",this.msg("dashlet.customList."+this.options.customListName+".title")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.widgets.effectivityCkeckbox=new YAHOO.widget.Button({type:"checkbox",title:d.msg("actions.toggle-effectivity"),container:this.id+"-effectivityCheckbox",checked:!this.options.effectiveFilterOn});this.widgets.effectivityCkeckbox.on("checkedChange",function(){var e="fr.becpg.formulation.dashlet.custom";if(d.options.list!=null&&d.options.list.length>0){e+="."+d.options.list}d.options.effectiveFilterOn=!d.options.effectiveFilterOn;d.services.preferences.set(e,{list:d.widgets.customList.value,effectiveFilterOn:d.options.effectiveFilterOn});YAHOO.Bubbling.fire("scopedActiveDataListChanged",{extraDataParams:"&repo=true&effectiveFilterOn="+d.options.effectiveFilterOn,clearCache:true})});this.services.preferences=new Alfresco.service.Preferences()},formulate:function c(){var f=YAHOO.util.Selector.query("div.formulate"),e=this;Dom.addClass(f,"loading");var d=beCPG.util.incLockCount();Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,url:Alfresco.constants.PROXY_URI+"becpg/product/formulate/node/"+this.options.entityNodeRef.replace(":/","")+"?fast=true",successCallback:{fn:function(g){if(beCPG.util.lockCount()==d){YAHOO.Bubbling.fire("refreshDataGrids",{updateOnly:true,callback:function(){Dom.removeClass(f,"loading")}})}},scope:this},failureCallback:{fn:function(g){if(g.json&&g.json.message){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.formulate.failure"),text:g.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.failure")})}Dom.removeClass(f,"loading")},scope:this}})},onCustomListChange:function a(f,d){var i=d[1];if(i){try{this.widgets.customList.set("label",i.cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.widgets.customList.value=i.value;var h="fr.becpg.formulation.dashlet.custom";if(this.options.list!=null&&this.options.list.length>0){h+="."+this.options.list}for(var g in this.options.customLists){var l=this.options.customLists[g];if(this.widgets.customList.value==l.id){YAHOO.Bubbling.fire("customList-"+this.id+"scopedActiveDataListChanged",{dataList:{name:l.id,itemType:l.type},force:true});break}}this.services.preferences.set(h,{list:this.widgets.customList.value,effectiveFilterOn:this.options.effectiveFilterOn})}catch(k){alert(k)}}}})})();