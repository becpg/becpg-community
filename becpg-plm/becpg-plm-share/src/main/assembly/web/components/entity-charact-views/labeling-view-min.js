(function(){beCPG.component.LabelingView=function(c){beCPG.component.LabelingView.superclass.constructor.call(this,"beCPG.component.LabelingView",c,["button","container"]);var e=this;var g=1;YAHOO.Bubbling.on("dataGridReady",function(i,h){if(g==3){try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(k){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",k);var j=h[1];if((j!==null)&&(j.entityDataGridModule!==null)){j.entityDataGridModule.onHistoryManagerReady()}}}g++});YAHOO.Bubbling.on("dirtyDataTable",this.formulate,this);var d=function f(k,j){var h=YAHOO.Bubbling.getOwnerByTagName(j[1].anchor,"span");if(h!==null){if(typeof e[h.className]=="function"){j[1].stop=true;var i=h.id;e[h.className].call(e,i)}}YAHOO.util.Event.preventDefault(j[0]);YAHOO.util.Event.stopPropagation();return true};YAHOO.Bubbling.addDefaultAction("labeling-action",d);return this};YAHOO.extend(beCPG.component.LabelingView,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.LabelingView.prototype,{options:{entityNodeRef:""},formulate:function a(){var e=YAHOO.util.Selector.query("div.formulate"),d=this;Dom.addClass(e,"loading");var c=beCPG.util.incLockCount();Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/product/formulate/node/"+this.options.entityNodeRef.replace(":/","")+"?fast=true",responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(f){if(beCPG.util.lockCount()==c){YAHOO.Bubbling.fire("refreshDataGrids",{updateOnly:true,callback:function(){Dom.removeClass(e,"loading")}})}},scope:this},failureCallback:{fn:function(f){if(f.json&&f.json.message){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.formulate.failure"),text:f.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.failure")})}Dom.removeClass(e,"loading")},scope:this}})},onShowTranslation:function b(c){var d=c.split("#")[1],e=c.split("#")[2],f=c.split("#")[3];new Alfresco.module.SimpleDialog(d+"-multilingualForm").setOptions({templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/multilingual-form/multilingual-form?nodeRef="+d+"&field="+e+(f=="true"?"&readonly=true":"&textarea=true&htmlEditor=true"),actionUrl:Alfresco.constants.PROXY_URI+"becpg/form/multilingual/field/"+e+"?nodeRef="+d,validateOnSubmit:false,destroyOnHide:true,width:"33em",onSuccess:{fn:function(){YAHOO.Bubbling.fire("scopedActiveDataListChanged")},obj:null,scope:this}}).show()},onCopyToClipboard:function(f){var d=f.split("#")[2]+f.split("#")[0];var g=document.getElementById(d);if(document.selection){var e=document.querySelector("#"+d);e.select();document.execCommand("copy")}else{if(window.getSelection){var e=document.querySelector("#"+d);e.select();var c=document.execCommand("copy")}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.copy-to-clipboard.success")});YAHOO.Bubbling.fire("scopedActiveDataListChanged")},copyToIllManualValue:function(c){var d=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.copy-to-illManualValue.confirm.title"),text:this.msg("message.copy-to-illManualValue.confirm.body"),buttons:[{text:this.msg("button.ok"),handler:function(){this.destroy();var e=c.split("#")[1];Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"becpg/form/multilingual/field/bcpg_illValue?nodeRef="+e+"&copy=true&destField=bcpg_illManualValue",requestContentType:"text/plain",successCallback:{fn:function(f){YAHOO.Bubbling.fire("scopedActiveDataListChanged");Alfresco.util.PopupManager.displayMessage({text:d.msg("message.copy-to-illManualValue.success")})},scope:d},failureCallback:{fn:function(){Alfresco.util.PopupManager.displayMessage({text:d.msg("message.copy-to-illManualValue.failure")})},scope:d}})}},{text:this.msg("button.cancel"),handler:function(){this.destroy()},isDefault:true}]})}})})();