(function(){var a=Alfresco.util.isValueSet;YAHOO.Bubbling.fire("registerAction",{actionName:"onActionMergeEntity",fn:function e(m){var k=m.displayName,l=new Alfresco.util.NodeRef(m.nodeRef),j=m.version;if(!this.newEntityVersion){this.newEntityVersion=Alfresco.module.getNewEntityVersionInstance()}this.newEntityVersion.show({filename:k,nodeRef:l,version:j,merge:true,onNewEntityVersionComplete:{fn:function n(o){this.recordData.jsNode.setNodeRef(o.successful[0].nodeRef);window.location.href=this.getActionUrls(this.recordData).documentDetailsUrl.replace("document-details?","entity-data-lists?list=View-properties&")},scope:this}})}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionBranchEntity",fn:function g(m){var l=new Alfresco.util.NodeRef(m.nodeRef),n=a(m.location.site)?m.location.site.name:null,j=m.displayName;var k=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.branch-entity.inprogress",j),displayTime:0});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"becpg/entity/simulation/create?entityNodeRef="+l,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(o){if(o.json){window.location.href=beCPG.util.entityURL(n,o.json.persistedObject,m.node.type)}},scope:this},failureCallback:{fn:function(o){k.destroy();if(o.json&&o.json.message){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.branch-entity.failure"),text:o.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.branch-entity.failure")})}},scope:this}})}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionEntityTplSynchronizeEntities",fn:function i(j){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.synchronize-entities.please-wait-mail"),displayTime:5});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/entity/entityTpl/"+j.nodeRef.replace(":/","")+"/synchronizeEntities"})}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionEntityTplFormulateEntities",fn:function d(j){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate-entities.please-wait-mail"),displayTime:5});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/entity/entityTpl/"+j.nodeRef.replace(":/","")+"/formulateEntities"})}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionCompareEntity",fn:function b(k){var j=Alfresco.constants.PROXY_URI+"becpg/entity/compare/"+k.nodeRef.replace(":/","")+"/";this.modules.entityCompare=new Alfresco.module.SimpleDialog(this.id+"-entityCompare").setOptions({width:"33em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/entity-compare/entity-compare?entityNodeRef="+k.nodeRef,actionUrl:j,validateOnSubmit:false,firstFocus:this.id+"-entityCompare-entities-field",doBeforeFormSubmit:{fn:function(m){this.modules.entityCompare.form.setAJAXSubmit(false);this.modules.entityCompare.hide();var l=YAHOO.util.Dom.get(this.id+"-entityCompare-reportTemplate");var n=l.options[l.selectedIndex].getAttribute("fileName");window.location.href=j+n+"?entities="+YAHOO.util.Dom.get(this.id+"-entityCompare-entities-added").value+"&tplNodeRef="+l.value},scope:this}});this.modules.entityCompare.show()}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionSendToSupplier",fn:function c(o){var m=new Alfresco.util.NodeRef(o.nodeRef),p=a(o.location.site)?o.location.site.name:null,k=o.displayName;var n=Alfresco.constants.PROXY_URI+"becpg/supplier/send-to-supplier?entityNodeRef="+o.nodeRef;this.modules.sendToSupplier=new Alfresco.module.SimpleDialog(this.id+"-sendToSupplier").setOptions({width:"33em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/supplier/send-to-supplier",actionUrl:n,validateOnSubmit:false,destroyOnHide:true,firstFocus:this.id+"-sendToSupplier-projectTpl-field",doBeforeFormSubmit:{fn:function j(r){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.send-to-supplier.inprogress"),displayTime:0})},scope:this},onSuccess:{fn:function l(r){if(r.json){this.modules.sendToSupplier.hide();window.location.href=beCPG.util.entityURL(p,r.json.persistedObject,o.node.type)}},scope:this},onFailure:{fn:function q(r){this.modules.sendToSupplier.hide();if(r.json&&r.json.message){Alfresco.util.PopupManager.displayMessage({text:r.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.failure")})}},scope:this}});this.modules.sendToSupplier.show()}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionCreateSupplier",fn:function h(o){var l=new Alfresco.util.NodeRef(o.nodeRef);var p="supplier-account",j="",m=0;var k='<div class="hd">'+this.msg("header."+p+".dialog")+"</div>";k+='<div class="bd">';k+='<form  class="form-container">';k+='<div class="form-fields bulk-edit">';k+='   <div class="set">';k+='        <div class="form-field">';k+='			<div  id="'+this.id+'-columns-list" />';j+='<li style="margin: 10px 0;"><input id="propEmail" type="email" required name="propEmail" placeholder="supplier@becpg.fr"/></li>';k+="<span>"+this.msg("label.supplier-account.title")+'</span><br/><br/><ul style="width:'+((m+1)*20)+'em;">'+j+"</ul>";k+="          </div>";k+='<div style="display: inline-block;"> <input id="propNotify"  type="checkbox" name="propNotify" /> <label for="propNotify" style="display: inline-block"> '+this.msg("label.notify-supplier")+"</label></div>";k+="       </div>";k+="    </div>";k+='<div id="'+this.id+"-"+p+'-ft" class="bdft">';k+="</div>";k+="</form></div>";var q=document.createElement("div");q.innerHTML=k;this.widgets.columnsListPanel=Alfresco.util.createYUIPanel(q,{draggable:true,width:"33em"});var n=Dom.get(this.id+"-"+p+"-ft");n.innerHTML='<input id="'+this.id+'-bulk-edit-ok" type="submit" value="'+this.msg("button.ok")+'" />';this.widgets.columnsListPanel.show();this.widgets.okBkButton=Alfresco.util.createYUIButton(this,"bulk-edit-ok",function(){var u=this;var w=Dom.get(this.id+"-columns-list").parentNode;var s=Selector.query('input[type="checkbox"]',w);var t=s[0].checked;var v=Dom.get("propEmail").value;var r=/\S+@\S+\.\S+/;if(r.test(v)){u.widgets.columnsListPanel.hide();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"becpg/supplier/create-supplier?emailAddress="+v+"&notifySupplier="+t+"&nodeRef="+l,successCallback:{fn:function(x){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.createSupplier.success",x.json.login)});location.reload()},scope:this},failureCallback:{fn:function(y){var x=y.json.message;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.createSupplier.failure",x.match(/supplier.*$/)[0]),displayTime:5})},scope:this}})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.email.notValide")})}})}});YAHOO.Bubbling.fire("registerAction",{actionName:"onActionStartProcess",fn:function f(p){var l=new Alfresco.util.NodeRef(p.nodeRef),q=a(p.location.site)?p.location.site.name:null,j=p.displayName;var m=Alfresco.constants.PROXY_URI+"becpg/workflow/start-process?nodeRef="+p.nodeRef;this.modules.startProcess=new Alfresco.module.SimpleDialog(this.id+"-onActionStartProcess").setOptions({width:"33em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/workflow/start-process?nodeRef="+p.nodeRef,actionUrl:m,validateOnSubmit:false,destroyOnHide:true,firstFocus:this.id+"-processScript",doBeforeFormSubmit:{fn:function o(r){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.start-process.inprogress")})},scope:this},onSuccess:{fn:function k(r){if(r.json){window.location.href=beCPG.util.entityURL(q,r.json.persistedObject,p.node.type)}},scope:this},onFailure:{fn:function n(r){if(r.json&&r.json.message){Alfresco.util.PopupManager.displayMessage({text:r.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.start-proces.failure")})}},scope:this}});this.modules.startProcess.show()}})})();