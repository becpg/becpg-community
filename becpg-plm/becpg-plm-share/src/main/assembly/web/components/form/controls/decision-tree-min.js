(function(){var c=YAHOO.util.Dom,b=YAHOO.Bubbling;beCPG.component.DecisionTree=function(d,e){beCPG.component.DecisionTree.superclass.constructor.call(this,"beCPG.component.DecisionTree",d,["button","container"]);b.on("afterFormRuntimeInit",this.onAfterFormRuntimeInit,this);b.on("refreshDecisionTree",this.refreshDecisionTree,this);this.fieldId=e;return this};YAHOO.extend(beCPG.component.DecisionTree,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.DecisionTree.prototype,{formRuntime:null,options:{disabled:false,prefix:"",data:[],currentValue:[]},onReady:function a(){var n=Alfresco.util.generateDomId(null,"question"),m=Alfresco.util.generateDomId(null,"list"),x=Alfresco.util.generateDomId(null,"comment");var v="";for(var u=0;u<this.options.data.length;u++){var l=this.options.data[u],d=false,o=false,e=null;if(l.choices){v+='<fieldset  id="'+this.id+"-question_"+l.id+'" class="hidden">';v+='<legend title="'+this.msg("form.control.decision-tree."+this.options.prefix+"."+l.id+".description")+'">'+l.id.toUpperCase()+" - "+(l.label?l.label:this.msg("form.control.decision-tree."+this.options.prefix+"."+l.id+".label"))+"</legend>";for(var s=0;s<l.choices.length;s++){var k=l.choices[s];if(k.list!=null){var p=this.getCurrentListOptions(l.id,k.id);v+="<p>";var B=k.id=="-"?"form.control.decision-tree.empty":"form.control.decision-tree."+this.options.prefix+"."+l.id+"."+k.id;v+='<label for="'+this.id+"-choice_"+l.id+"_"+k.id+'">'+(k.label?k.label:this.msg(B))+"</label>";v+="<select "+(k.multiple?'multiple="true"':"")+" "+(this.options.disabled?"disabled":"")+' tabindex="0" id="'+this.id+"-select_"+l.id+"_"+k.id+'" class="'+m+'" name="--group_'+this.id+l.id+'"  >';for(var h=0;h<k.list.length;h++){var q=false;if(k.multiple){var f=p.split(",");for(var y=0;y<f.length;y++){if(f[y]==k.list[h]){q=true;break}}}else{q=p==k.list[h]}v+="<option "+(q?"selected":"")+">"+k.list[h]+"</option>"}v+="</select>";v+="</p>";YAHOO.util.Event.addListener(this.id+"-select_"+l.id+"_"+k.id,"change",function(){A.toogleVisible()})}else{var g=this.getCurrentValueChecked(l.id,k.id);v+="<p>";v+="<input "+(this.options.disabled?"disabled":"")+' tabindex="0" id="'+this.id+"-choice_"+l.id+"_"+k.id+'" class="'+n+'" name="--group_'+this.id+l.id+'" type="radio"  '+(g?'checked="checked"':"")+" />";var B=k.id=="-"?"form.control.decision-tree.empty":"form.control.decision-tree."+this.options.prefix+"."+l.id+"."+k.id;v+='<label for="'+this.id+"-choice_"+l.id+"_"+k.id+'">'+(k.label?k.label:this.msg(B))+"</label>";v+="</p>";if(k.comment){d=true;e=k.commentLabel;if(k.textarea){o=k.textarea}}}}if(d){v+='<div id="'+this.id+"-comment_"+l.id+'" class="decision-tree-comments hidden" >';v+='<label for="'+this.id+"-comment_"+l.id+'-input">'+(e?e:this.msg("form.control.decision-tree."+this.options.prefix+"."+l.id+".comment"))+":</label>";if(this.options.disabled){v+='<span id="'+this.id+"-comment_"+l.id+'-input" >'+this.getCurrentValueComment(l.id)+"</span>"}else{if(o){v+="<textarea "+(this.options.disabled?"disabled":"")+' tabindex="0" id="'+this.id+"-comment_"+l.id+'-input" class="'+x+'"  name="--comment_'+this.id+l.id+'" >'+this.getCurrentValueComment(l.id)+"</textarea>"}else{v+="<input "+(this.options.disabled?"disabled":"")+' tabindex="0" id="'+this.id+"-comment_"+l.id+'-input" class="'+x+'"  type="text"  value="'+this.getCurrentValueComment(l.id)+'" name="--comment_'+this.id+l.id+'" />'}}v+="</div>"}v+="</fieldset>"}else{v+='<div id="'+this.id+"-question_"+l.id+'" class="hidden decision-tree-message">';v+="<span>"+(l.label?l.label:this.msg("form.control.decision-tree."+this.options.prefix+"."+l.id+".label"))+"</span>";v+="</div>"}}var w=c.get(this.id+"-body");w.innerHTML=v;var A=this;A.toogleVisible();var r=function t(z,j){var i=b.getOwnerByTagName(j[1].input,"input");if(i!==null){i.checked=true;A.toogleVisible();return false}};b.addDefaultAction(n,r)},refreshDecisionTree:function(){this.toogleVisible()},getCurrentValueChecked:function(g,h){for(var f=0;f<this.options.currentValue.length;f++){var d=this.options.currentValue[f].qid;var e=this.options.currentValue[f].cid;if(g==d&&h==e){return true}}return false},getCurrentListOptions:function(g,h){for(var f=0;f<this.options.currentValue.length;f++){var d=this.options.currentValue[f].qid;var e=this.options.currentValue[f].cid;if(g==d&&h==e){return this.options.currentValue[f].listOptions}}return""},getCurrentValueComment:function(f){for(var e=0;e<this.options.currentValue.length;e++){var d=this.options.currentValue[e].qid;if(f==d&&this.options.currentValue[e].comment){return this.options.currentValue[e].comment}}return""},onAfterFormRuntimeInit:function(e,d){if(!this.options.disable&&this.formRuntime==null&&this.id.indexOf(d[1].runtime.formId.replace("-form",""))>-1){this.formRuntime=d[1].runtime;this.formRuntime.removeValidation=function(f){var h=-1;for(var g=0;g<this.validations.length;g++){if(this.validations[g].fieldId==f){h=g;break}}if(h>0){this.validations.splice(h,1)}}}},toogleVisible:function(){var o=[],q=this;var d=[];for(var m=0;m<this.options.data.length;m++){var g=this.options.data[m];if(m==0&&(!this.options.disabled||this.options.currentValue.length>0)){d.push(g.id)}if(beCPG.util.contains(d,g.id)&&g.choices){var k=false;for(var h=0;h<g.choices.length;h++){var l=g.choices[h];if(this.formRuntime!=null&&g.mandatory){if(l.list!=null){this.formRuntime.addValidation(this.id+"-select_"+g.id+"_"+l.id,Alfresco.forms.validation.mandatory,null,"keyup")}else{this.formRuntime.addValidation(this.id+"-choice_"+g.id+"_"+l.id,Alfresco.forms.validation.mandatory,null,"keyup");if(l.comment){if(c.get(this.id+"-choice_"+g.id+"_"+l.id).checked){this.formRuntime.addValidation(this.id+"-comment_"+g.id+"-input",Alfresco.forms.validation.mandatory,null,"keyup")}else{this.formRuntime.removeValidation(this.id+"-comment_"+g.id+"-input")}}}}if((l.list!=null&&c.get(this.id+"-select_"+g.id+"_"+l.id).value!=null)||c.get(this.id+"-choice_"+g.id+"_"+l.id).checked){if(l.list!=null){var r="",f=c.get(this.id+"-select_"+g.id+"_"+l.id);if(l.multiple){for(var h=0,n=f.options.length;h<n;h++){if(f.options[h].selected){if(r.length>0){r+=","}r+=f.options[h].value}}}else{r=f.value}o.push({qid:g.id,cid:l.id,listOptions:r})}else{o.push({qid:g.id,cid:l.id})}if(l.cid){if(l.cid instanceof Array){for(var p=0;p<l.cid.length;p++){d.push(l.cid[p])}}else{d.push(l.cid)}}if(l.comment){k=true}}}if(k){c.removeClass(this.id+"-comment_"+g.id,"hidden");o[o.length-1].comment=c.get(this.id+"-comment_"+g.id+"-input").value;YAHOO.util.Event.addListener(this.id+"-comment_"+g.id+"-input","blur",function(i){q.toogleVisible()})}else{if(c.get(this.id+"-comment_"+g.id)){YAHOO.util.Event.purgeElement(this.id+"-comment_"+g.id+"-input");c.addClass(this.id+"-comment_"+g.id,"hidden")}}}else{if(g.choices&&this.formRuntime!=null&&g.mandatory){for(var h=0;h<g.choices.length;h++){var l=g.choices[h];if(this.formRuntime!=null&&g.mandatory){if(l.list!=null){this.formRuntime.removeValidation(this.id+"-select_"+g.id+"_"+l.id)}else{this.formRuntime.removeValidation(this.id+"-choice_"+g.id+"_"+l.id);if(l.comment){this.formRuntime.removeValidation(this.id+"-comment_"+g.id+"-input")}}}}}}if(beCPG.util.contains(d,g.id)){c.removeClass(this.id+"-question_"+g.id,"hidden")}else{c.addClass(this.id+"-question_"+g.id,"hidden")}}if(!this.options.disabled){var e=c.get(this.fieldId);e.value=JSON.stringify(o);YAHOO.Bubbling.fire("mandatoryControlValueUpdated")}}},true)})();