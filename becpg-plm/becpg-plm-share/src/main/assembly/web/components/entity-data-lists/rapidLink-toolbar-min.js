(function(){beCPG.component.RapidLinkToolbar=function(e){beCPG.component.RapidLinkToolbar.superclass.constructor.call(this,"beCPG.component.RapidLinkToolbar",e,["button","container"]);this.name="beCPG.component.EntityDataListToolbar";return this};YAHOO.extend(beCPG.component.RapidLinkToolbar,Alfresco.component.Base);YAHOO.lang.augmentObject(beCPG.component.RapidLinkToolbar.prototype,{options:{entity:null,dataListNodeRef:null,containerDiv:null,siteId:null,list:null,formWidth:"34em"},currentVariantNodeRef:null,onReady:function b(){var f=[],e=this,h=null;if("packagingList"==this.options.list){h=["packagingMaterial","packagingKit"]}else{if("processList"==this.options.list){h=["resourceProduct"]}else{h=["finishedProduct","rawMaterial","semiFinishedProduct"]}}for(key in h){var g=h[key];f.push({text:'<span class="'+g+'" title="'+e.msg("action.rapid-link.create."+g+".description")+'" >'+e.msg("action.rapid-link.create."+g)+"</span>",onclick:{fn:e.onMenuCreateTypeClick(g),scope:e}})}if("compoList"==this.options.list){f.push({text:'<span class="import" title="'+this.msg("action.rapid-link.import.description")+'" >'+this.msg("action.rapid-link.import")+"</span>",onclick:{fn:this.onClickImport,scope:this}})}this.widgets.rapidLinkToolbar=new YAHOO.widget.Button({type:"split",label:"&nbsp;",title:this.msg("button.rapid-link"),name:"mymenubutton",menu:f,container:this.options.containerDiv,lazyloadmenu:false})},onMenuCreateTypeClick:function d(f){var e=this;return function(i,h,g){var l=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?formId=formulation&itemKind=type&itemId={itemId}&destination={destination}&mode=create&submitType=json&showCancelButton=true&popup=true",{itemId:"bcpg:"+f,destination:e.options.entity.parentNodeRef});var k=new Alfresco.module.SimpleDialog(e.id+"-createType");k.setOptions({width:e.options.formWidth,templateUrl:l,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:function(m,n){Alfresco.util.populateHTML([n.id+"-dialogTitle",e.msg("action.rapid-link.create."+f)])},scope:this},doBeforeFormSubmit:{fn:function(m){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.create.please-wait")})},scope:this},onSuccess:{fn:function(m){if(m.json){e.addToDataList(m.json.persistedObject,"message.rapid-link.create.success")}},scope:this},onFailure:{fn:function j(m){Alfresco.util.PopupManager.displayMessage({text:e.msg("message.rapid-link.create.failure")})},scope:this}}).show()}},onClickImport:function c(h,g,f){this.modules.entityImporter=new Alfresco.module.SimpleDialog(this.id+"-entityImporter").setOptions({width:this.options.formWidth,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/nut-database/nut-importer",actionUrl:Alfresco.constants.PROXY_URI+"becpg/product/nutdatabaseimport?dest="+this.options.entity.parentNodeRef,validateOnSubmit:false,firstFocus:this.id+"-entityImporter-supplier-field",doBeforeFormSubmit:{fn:function j(k){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.import.please-wait")})},scope:this},onSuccess:{fn:function e(k){if(k.json){for(var l in k.json){this.addToDataList(k.json[l],"message.rapid-link.import.success")}}},scope:this},onFailure:{fn:function i(k){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.failure")})},scope:this}});this.modules.entityImporter.show()},addToDataList:function a(h,k){var e=this,f=null,g="bcpg:"+this.options.list;if("packagingList"==this.options.list){var i="P";if(typeof(Storage)!=="undefined"&&localStorage&&localStorage.getItem("prop_bcpg_packagingListUnit")!=null){i=localStorage.getItem("prop_bcpg_packagingListUnit")}f={alf_destination:e.options.dataListNodeRef,assoc_bcpg_packagingListProduct_added:h,prop_bcpg_packagingListUnit:i,prop_bcpg_packagingListQty:"0"}}else{if("processList"==this.options.list){f={alf_destination:e.options.dataListNodeRef,assoc_mpm_plResource_added:h};g="mpm:processList"}else{var i="kg";var j="Declare";if(typeof(Storage)!=="undefined"&&localStorage&&localStorage.getItem("prop_bcpg_compoListUnit")!=null){i=localStorage.getItem("prop_bcpg_compoListUnit")}if(typeof(Storage)!=="undefined"&&localStorage&&localStorage.getItem("prop_bcpg_compoListDeclType")!=null){j=localStorage.getItem("prop_bcpg_compoListDeclType")}f={alf_destination:e.options.dataListNodeRef,assoc_bcpg_compoListProduct_added:h,prop_bcpg_compoListUnit:i,prop_bcpg_compoListQtySubFormula:"0",prop_bcpg_compoListDeclType:j}}}Alfresco.util.Ajax.jsonRequest({method:Alfresco.util.Ajax.POST,url:Alfresco.constants.PROXY_URI+"api/type/"+g+"/formprocessor",dataObj:f,successCallback:{fn:function(l){if(l.json){YAHOO.Bubbling.fire("dataItemCreated",{nodeRef:l.json.persistedObject,callback:function(m){Alfresco.util.PopupManager.displayMessage({text:e.msg(k)})}})}},scope:this}})},destroy:function(){this.widgets.rapidLinkToolbar.destroy()}},true)})();