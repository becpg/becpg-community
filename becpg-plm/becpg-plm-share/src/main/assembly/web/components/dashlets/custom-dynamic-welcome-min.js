(function(){var b=YAHOO.util.Event;beCPG.custom.DynamicWelcome=function g(h,i,l,j,k,m){beCPG.custom.DynamicWelcome.superclass.constructor.call(this,h,i,l,j,k,m);return this};YAHOO.extend(beCPG.custom.DynamicWelcome,Alfresco.dashlet.DynamicWelcome,{importEntity:null,createProduct:null,createProject:null,userHomeNodeRef:null,options:{userHomeNodeRef:null,siteId:null},onReady:function e(){this.widgets.hideButton=Alfresco.util.createYUIButton(this,"hide-button",this.onHideButtonClick);b.addListener(this.id+"-createSite-button","click",this.onCreateSiteLinkClick,this,true);b.addListener(this.id+"-requestJoin-button","click",this.onRequestJoinLinkClick,this,true);if(this.options.siteId!=null){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/containers/"+this.options.siteId,method:"GET",successCallback:{fn:function(h){if(h.json){for(var j in h.json.containers){if(h.json.containers[j].name==="documentLibrary"){this.options.userHomeNodeRef=h.json.containers[j].nodeRef;break}}b.addListener(this.id+"-createProduct-button","click",this.onCreateProductLinkClick,this,true);b.addListener(this.id+"-createProject-button","click",this.onCreateProjectLinkClick,this,true);b.addListener(this.id+"-importMP-button","click",this.onImportMPLinkClick,this,true)}},scope:this},failureCallback:{fn:function(h){Alfresco.logger.error("Error retrieving documentLibrary: ",h)},scope:this}})}else{b.addListener(this.id+"-createProduct-button","click",this.onCreateProductLinkClick,this,true);b.addListener(this.id+"-createProject-button","click",this.onCreateProjectLinkClick,this,true);b.addListener(this.id+"-importMP-button","click",this.onImportMPLinkClick,this,true)}},onCreateProductLinkClick:function d(i){var h=this.createTypePopup("bcpg:finishedProduct");h.show();b.stopEvent(i)},onCreateProjectLinkClick:function c(h){var i=this.createTypePopup("pjt:project");i.show();b.stopEvent(h)},createTypePopup:function f(k){var h=this;var l=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?formId=formulation&itemKind=type&itemId={itemId}&destination={destination}&mode=create&submitType=json&showCancelButton=true&popup=true",{itemId:k,destination:h.options.userHomeNodeRef});var j=new Alfresco.module.SimpleDialog(h.id+"-createType");j.setOptions({width:"33em",templateUrl:l,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:function(m,n){Alfresco.util.populateHTML([n.id+"-dialogTitle",h.msg("action.create."+k.replace(":","_"))])},scope:this},doBeforeFormSubmit:{fn:function(m){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.create.please-wait")})},scope:this},onSuccess:{fn:function(m){if(m.json){var n="mine";if(h.options.siteId!==null){n=null}window.location=beCPG.util.entityURL(h.options.siteId,m.json.persistedObject,k,n)}},scope:this},onFailure:{fn:function i(m){Alfresco.util.PopupManager.displayMessage({text:h.msg("message.create.failure")})},scope:this}});return j},onImportMPLinkClick:function a(l){var i=this;if(this.importEntity===null){this.importEntity=new Alfresco.module.SimpleDialog(this.id+"-entityImporter").setOptions({width:this.options.formWidth,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"/modules/nut-database/nut-importer",actionUrl:Alfresco.constants.PROXY_URI+"becpg/product/nutdatabaseimport?dest="+this.options.userHomeNodeRef,validateOnSubmit:false,firstFocus:this.id+"-entityImporter-supplier-field",doBeforeFormSubmit:{fn:function k(m){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.please-wait")})},scope:this},onSuccess:{fn:function h(m){if(m.json){var n="mine";if(i.options.siteId!==null){n=null}window.location=beCPG.util.entityURL(i.options.siteId,m.json[0],null,n)}},scope:this},onFailure:{fn:function j(m){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.failure")})},scope:this}})}this.importEntity.show();b.stopEvent(l)}})})();