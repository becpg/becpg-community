(function(){if(beCPG.component.EntityDataListToolbar){YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"eco-calculate-wused",evaluate:function(b,a){return b.name!=null&&(b.name==="replacementList"||b.name==="wUsedList")&&a!=null&&a.userAccess.edit},fn:function(a){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-calculate-wused.please-wait")});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/ecm/changeorder/"+this.options.entityNodeRef.replace(":/","")+"/calculatewused",successCallback:{fn:function b(d){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-calculate-wused.success")});YAHOO.Bubbling.fire("refreshDataGrids")},scope:this},failureCallback:{fn:function c(d){if(d.message!=null){Alfresco.util.PopupManager.displayPrompt({text:d.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-calculate-wused.failure")})}},scope:this}})}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"eco-do-simulation",evaluate:function(b,a){return b.name!=null&&(b.name==="replacementList"||b.name==="changeUnitList"||b.name==="calculatedCharactList")&&a!=null&&a.userAccess.edit},fn:function(a){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-do-simulation.please-wait")});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/ecm/changeorder/"+this.options.entityNodeRef.replace(":/","")+"/dosimulation",successCallback:{fn:function c(d){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-do-simulation.success"),displayTime:5});YAHOO.Bubbling.fire("refreshDataGrids")},scope:this},failureCallback:{fn:function b(d){if(d.message!=null){Alfresco.util.PopupManager.displayPrompt({text:d.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.eco-do-simulation.failure")})}},scope:this}})}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"eco-apply",evaluate:function(b,a){return b.name!=null&&(b.name==="replacementList"||b.name==="changeUnitList")&&a!=null&&a.userAccess.edit&&beCPG.util.contains(a.userSecurityRoles,"ApplyChangeOrder")},fn:function(a){var b=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.eco-apply.title"),text:this.msg("message.confirm.eco-apply.description"),buttons:[{text:this.msg("button.eco-apply"),handler:function(){this.destroy();Alfresco.util.PopupManager.displayMessage({text:b.msg("message.eco-apply.please-wait")});Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"becpg/ecm/changeorder/"+b.options.entityNodeRef.replace(":/","")+"/apply",successCallback:{fn:function d(f){Alfresco.util.PopupManager.displayMessage({text:b.msg("message.eco-apply.success"),displayTime:5});YAHOO.Bubbling.fire("refreshDataGrids")},scope:b},failureCallback:{fn:function e(f){if(f.message!=null){Alfresco.util.PopupManager.displayPrompt({text:f.message})}else{Alfresco.util.PopupManager.displayMessage({text:b.msg("message.eco-apply.failure")})}},scope:b}})}},{text:this.msg("button.cancel"),handler:function c(){this.destroy()},isDefault:true}]})}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"full-screen",evaluate:function(b,a){return b.name!=null&&(b.name==="compoList"||b.name==="packagingList"||b.name==="processList")&&a!=null&&a.userAccess.edit},fn:function(c){var e=this;var b=function(h,g){var i=g[1].component,j=g[1].runtime;j.setAsReusable(true);i.buttons.submit.set("label",this.msg("button.add"));Dom.removeClass("full-screen-form","hidden");j.setAJAXSubmit(true,{successCallback:{fn:function(l){var q=e.options.itemType!=null?e.options.itemType:e.datalistMeta.itemType;var k=Dom.get(e.id+"_prop_bcpg_parentLevel-added");if(k!=null&&k.value!=null&&k.value.length>0){e.parentInputNodeRef=k.value;Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"becpg/entity/datalists/openclose?nodeRef="+e.parentInputNodeRef+"&expand=true&entityNodeRef="+e.options.entityNodeRef+"&listType="+q,successCallback:{fn:function p(r){YAHOO.Bubbling.fire("refreshDataGrids");YAHOO.Bubbling.fire("dirtyDataTable")},scope:this}})}else{e.parentInputNodeRef=null;YAHOO.Bubbling.fire("dataItemCreated",{nodeRef:l.json.persistedObject})}j.reset();if(e.parentInputNodeRef!=null){Dom.get(e.id+"_prop_bcpg_parentLevel-added").value=e.parentInputNodeRef;YAHOO.Bubbling.fire(e.id+"_prop_bcpg_parentLevelrefreshContent",e.parentInputNodeRef,this)}var n=Dom.get(j.formId);for(var m=0;m<n.elements.length;m++){if(Alfresco.util.isVisible(n.elements[m])){try{n.elements[m].focus();break}catch(o){}}}},scope:this}});YAHOO.Bubbling.unsubscribe("beforeFormRuntimeInit",b,e)};if(Dom.hasClass("share-header","hidden")){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}Dom.removeClass("share-header","hidden");Dom.removeClass("alf-hd","hidden");Dom.removeClass("alf-filters","hidden");Dom.removeClass("alf-ft","hidden");Dom.removeClass("Share","full-screen");Dom.addClass("alf-content","yui-b");if(this.fullScreen){Dom.setStyle("alf-content","margin-left",this.fullScreen.marginLeft);this.fullScreen=null}Dom.addClass("full-screen-form","hidden");YAHOO.Bubbling.fire("refreshFloatingHeader")}else{var d=document.documentElement;if(d.requestFullscreen){d.requestFullscreen()}else{if(d.mozRequestFullScreen){d.mozRequestFullScreen()}else{if(d.webkitRequestFullScreen){d.webkitRequestFullScreen()}}}Dom.addClass("share-header","hidden");Dom.addClass("alf-hd","hidden");Dom.addClass("alf-ft","hidden");Dom.addClass("Share","full-screen");Dom.addClass("alf-ft","hidden");Dom.addClass("alf-filters","hidden");Dom.removeClass("alf-content","yui-b");if(!this.fullScreen){var a=this.datalistMeta.nodeRef!=null?this.datalistMeta.nodeRef:this.options.parentNodeRef;var f=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?formId=full-screen&showCaption=false&entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&showCancelButton=true&dataListsName={dataListsName}",{itemKind:"type",itemId:this.datalistMeta.itemType,destination:a,mode:"create",submitType:"json",entityNodeRef:this.options.entityNodeRef,dataListsName:encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)});YAHOO.Bubbling.on("beforeFormRuntimeInit",b,this);Alfresco.util.Ajax.request({url:f,dataObj:{htmlid:this.id},successCallback:{fn:function(g){var h=Dom.get("full-screen-form");if(h.hasChildNodes()){while(h.childNodes.length>=1){h.removeChild(h.firstChild)}}h.innerHTML=g.serverResponse.responseText;YAHOO.Bubbling.fire("refreshFloatingHeader")},scope:this},failureMessage:"Could not load dialog template from '"+this.options.templateUrl+"'.",scope:this,execScripts:true})}else{Dom.removeClass("full-screen-form","hidden");YAHOO.Bubbling.fire("refreshFloatingHeader")}e.fullScreen={marginLeft:Dom.getStyle("alf-content","margin-left"),lock:false};Dom.setStyle("alf-content","margin-left",null)}}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"product-notifications",right:true,evaluate:function(b,a){return b.name!=null&&(b.name==="compoList"||b.name==="processList"||b.name==="packagingList"||b.name==="ingLabelingList"||b.name==="nutList"||b.name==="labelClaimList"||b.name==="costList"||b.name==="physicoChemList"||b.name==="ingList"||b.name==="allergenList")},createWidget:function(d,a){var c=document.createElement("div");Dom.setAttribute(c,"id",a.id+"-productNotifications");Dom.addClass(c,"product-notifications");d.appendChild(c);var b=new beCPG.component.ProductNotifications(a.id+"-productNotifications").setOptions({entityNodeRef:a.options.entityNodeRef,list:a.options.list,containerDiv:c});return b}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"formulate",hideLabel:true,evaluate:function(b,a){return b.name!=null&&(b.name==="View-properties"||b.name==="compoList"||b.name==="packMaterialList"||b.name==="processList"||b.name==="packagingList"||b.name==="ingLabelingList"||b.name==="nutList"||b.name==="labelClaimList"||b.name==="costList"||b.name==="physicoChemList"||b.name==="ingList"||b.name==="allergenList")&&a!=null&&beCPG.util.contains(a.aspects,"bcpg:productAspect")&&a.userAccess.edit},fn:function(a){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.please-wait")});var b=YAHOO.util.Selector.query("div.formulate");Dom.addClass(b,"loading");Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,responseContentType:Alfresco.util.Ajax.JSON,url:Alfresco.constants.PROXY_URI+"becpg/product/formulate/node/"+this.options.entityNodeRef.replace(":/",""),successCallback:{fn:function(c){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.success")});YAHOO.Bubbling.fire("refreshDataGrids");Dom.removeClass(b,"loading")},scope:this},failureCallback:{fn:function(c){if(c.json&&c.json.message){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.formulate.failure"),text:c.json.message})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.formulate.failure")})}Dom.removeClass(b,"loading")},scope:this}})}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"product-metadata",hideLabel:true,evaluate:function(b,a){return b.name!=null&&(b.name==="compoList"||b.name==="processList"||b.name==="packagingList")&&a!=null&&a.userAccess.edit},fn:function(a){var b=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?popup=true&formId=formulation&itemKind=node&itemId={itemId}&mode=edit&submitType=json&showCancelButton=true",{itemId:this.options.entityNodeRef});var c=new Alfresco.module.SimpleDialog(this.id+"-editProductMetadata");c.setOptions({width:"33em",onSuccess:{fn:function(){YAHOO.Bubbling.fire("metadataRefresh");YAHOO.Bubbling.fire("dirtyDataTable");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")})},scope:this},failureMessage:this.msg("message.details.failure"),templateUrl:b,destroyOnHide:true,doBeforeDialogShow:{fn:function(d,e){Alfresco.util.populateHTML([e.id+"-dialogTitle",this.msg("label.product-metadata.title")])},scope:this}}).show()}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"rapid-link",right:false,evaluate:function(b,a){return b.name!=null&&(b.name==="compoList"||b.name==="processList"||b.name==="packagingList")&&a!=null&&a.userAccess.edit},createWidget:function(e,a){var d=document.createElement("div");e.appendChild(d);Dom.setAttribute(d,"id",a.id+"-rapidLink");Dom.addClass(d,"rapidLink");var c=a.datalistMeta.nodeRef!=null?a.datalistMeta.nodeRef:a.options.parentNodeRef;var b=new beCPG.component.RapidLinkToolbar(a.id+"-rapidLink").setOptions({dataListNodeRef:c,entity:a.entity,containerDiv:d,list:encodeURIComponent(a.datalistMeta.name!=null?a.datalistMeta.name:a.options.list),siteId:a.options.siteId});return b}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"variant-picker",right:true,evaluate:function(b,a){return a!=null&&a.userAccess.edit&&(beCPG.util.contains(a.aspects,"bcpg:entityVariantAspect")&&(b.name!=null&&(b.name==="compoList"||b.name==="processList"||b.name==="packagingList")))},createWidget:function(d,a){var c=document.createElement("div");d.appendChild(c);Dom.setAttribute(c,"id",a.id+"-variantPicker");Dom.addClass(c,"variantPicker");var b=new beCPG.component.VariantPicker(a.id+"-variantPicker").setOptions({entityNodeRef:a.options.entityNodeRef,entity:a.entity,containerDiv:c,toolBarInstance:a});return b}});YAHOO.Bubbling.fire("registerToolbarButtonAction",{actionName:"import-nuts",right:false,evaluate:function(b,a){return(a!=null&&a.userAccess.edit&&b.name!=null&&b.name==="nutList")},fn:function(b){var c=new Alfresco.module.SimpleDialog(this.id+"-nutImporter");c.setOptions({width:this.options.formWidth,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/nut-database/nut-importer?entityNodeRef="+this.options.entityNodeRef+"&nutsCompare=true",actionUrl:Alfresco.constants.PROXY_URI+"becpg/product/nutdatabaseimport?dest="+this.options.entityNodeRef+"&onlyNuts=true",validateOnSubmit:false,firstFocus:this.id+"-nutImporter-supplier-field",doBeforeFormSubmit:{fn:function e(f){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.import.please-wait")})},scope:this},onSuccess:{fn:function a(f){if(f.json){YAHOO.Bubbling.fire("refreshDataGrids");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.rapid-link.nutrient-import.success")})}},scope:this},onFailure:{fn:function d(f){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.import.failure")})},scope:this}});c.show()}})}})();