<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN 2.0//EN' 'http://www.springframework.org/dtd/spring-beans-2.0.dtd'>

<beans>

	<!-- beCPG configuration files -->
	<bean name="beCPGPlaceholderConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="ignoreUnresolvablePlaceholders" value="true" />
		<property name="ignoreResourceNotFound" value="true"></property>
		<property name="locations">
			<list>
				<value>classpath:alfresco/module/${pom.artifactId}/beCPG.properties</value>
			</list>
		</property>
	</bean>
	
	<bean id="becpgBootstrapMessages" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">      
      <property name="resourceBundles">
         <list>
         	 <value>alfresco/module/${pom.artifactId}/model/becpgModel</value>
             <value>alfresco/module/${pom.artifactId}/messages/paths</value>
             <value>alfresco/module/${pom.artifactId}/messages/states</value>
             <value>alfresco/module/${pom.artifactId}/messages/becpg-messages</value>
             <value>alfresco/module/${pom.artifactId}/messages/groups</value>
             <value>alfresco/module/${pom.artifactId}/messages/demo</value>
             <value>alfresco/module/${pom.artifactId}/messages/import-service</value>             
         </list>
      </property>      
   </bean>
	
	
	<!-- Admin -->
	<bean id="initRepoVisitor" class="fr.becpg.repo.admin.InitRepoVisitorImpl">
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="nodeService" ref="nodeService" />
		<property name="repoService" ref="repoService" />
		<property name="ruleService" ref="ruleService" />
		<property name="actionService" ref="actionService" />
		<property name="productDictionaryService" ref="productDictionaryService" />
		<property name="authorityService" ref="authorityService" />
		<property name="permissionService" ref="permissionService"/>			
		<property name="reportTplService" ref="reportTplService"/>		
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
		<property name="entityTplService" ref="entityTplService"/>
		<property name="beCPGMailService" ref="becpgMailService"/>		
		<property name="designerInitService" ref="designerInitService"/>
	</bean>
	<bean id="initSiteVisitor" class="fr.becpg.repo.admin.InitSiteVisitorImpl">
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="nodeService" ref="nodeService" />
		<property name="repoService" ref="repoService" />
		<property name="ruleService" ref="ruleService" />
		<property name="actionService" ref="actionService" />		
	</bean>
	<bean id="initDemoVisitor" class="fr.becpg.repo.admin.InitDemoVisitorImpl">
		<property name="personService" ref="personService" />
		<property name="authorityService" ref="authorityService" />
		<property name="siteService" ref="siteService" />			
	</bean>	

	<!-- dynListConstraint -->
	<bean id="dynListConstraint" class="fr.becpg.repo.dictionary.constraint.DynListConstraint">
		<property name="serviceRegistry" ref="ServiceRegistry" />
	</bean>

	<!-- Helper -->
	<bean id="repoService" class="fr.becpg.repo.helper.impl.RepoServiceImpl">		
		<property name="nodeService" ref="nodeService" />
		<property name="searchService" ref="searchService" />
		<property name="namespaceService" ref="namespaceService"/>
	</bean>
	<bean id="attributeExtractorService" class="fr.becpg.repo.helper.impl.AttributeExtractorServiceImpl">		
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService"/>
		<property name="beCPGCacheService" ref="beCPGCacheService"/>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="permissionService" ref="permissionService"/>
		<property name="personService" ref="personService"/>
		<property name="taggingService" ref="taggingService"/>
		<property name="securityService" ref="securityService"/>
	</bean>
	<bean id="associationService" class="fr.becpg.repo.helper.impl.AssociationServiceImpl">		
		<property name="nodeService" ref="nodeService" />
	</bean>	
	
	<!-- List Values -->
	
	<bean id="entityListValuePlugin" parent="baseListValuePlugin"  init-method="init"
			 class="fr.becpg.repo.listvalue.EntityListValuePlugin">
		<property name="autoNumService" ref="autoNumService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="dictionaryDAO" ref="dictionaryDAO" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="nodeService" ref="nodeService" />
		<property name="reportTplService" ref="reportTplService" />
	</bean>

	<!-- Importer -->
	<bean id="importService" class="fr.becpg.repo.importer.impl.ImportServiceImpl">
		<property name="searchService" ref="searchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="contentService" ref="contentService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="repoService" ref="repoService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="importNodeVisitor" ref="importNodeVisitor" />
		<property name="importProductVisitor" ref="importProductVisitor" />
		<property name="importEntityListAspectVisitor" ref="importEntityListAspectVisitor" />
		<property name="importEntityListItemVisitor" ref="importEntityListItemVisitor" />				
		<property name="dictionaryService" ref="dictionaryService" />
	</bean>
	<bean id="importNodeVisitor" class="fr.becpg.repo.importer.impl.ImportNodeVisitor">		
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="nodeService" ref="nodeService" />
		<property name="entityListValuePlugin" ref="entityListValuePlugin" />
		<property name="searchService" ref="searchService" />
		<property name="repoService" ref="repoService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService"/>
		<property name="namespaceService" ref="namespaceService"/>
	</bean>	
	<bean id="importProductVisitor" class="fr.becpg.repo.importer.impl.ImportProductVisitor">
		<property name="nodeService" ref="nodeService" />		
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="entityListValuePlugin" ref="entityListValuePlugin" />
		<property name="searchService" ref="searchService" />
		<property name="repoService" ref="repoService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService"/>		
		<property name="namespaceService" ref="namespaceService"/>
		<property name="productService" ref="productService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
	</bean>
	<bean id="importEntityListAspectVisitor" class="fr.becpg.repo.importer.impl.ImportEntityListAspectVisitor">
		<property name="nodeService" ref="nodeService" />		
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="entityListValuePlugin" ref="entityListValuePlugin" />
		<property name="searchService" ref="searchService" />
		<property name="repoService" ref="repoService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService"/>		
		<property name="namespaceService" ref="namespaceService"/>
	</bean>
	<bean id="importEntityListItemVisitor" class="fr.becpg.repo.importer.impl.ImportEntityListItemVisitor">
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="nodeService" ref="nodeService" />
		<property name="entityListValuePlugin" ref="entityListValuePlugin" />
		<property name="searchService" ref="searchService" />
		<property name="repoService" ref="repoService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService"/>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="fileFolderService" ref="fileFolderService" />
	</bean>
	<bean id="userImporterService" class="fr.becpg.repo.importer.user.impl.UserImporterServiceImpl">
		<property name="authenticationService" ref="authenticationService"/>
		<property name="contentService" ref="contentService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="personService" ref="personService"/>
		<property name="siteService" ref="siteService"/>
		<property name="authorityService" ref="authorityService"/>
	    <property name="beCPGMailService" ref="becpgMailService"/>
	    <property name="namespacePrefixResolver" ref="namespaceService" />
	</bean>
	
	<!-- Mail service -->
	
	<bean id="becpgMailService" class="fr.becpg.repo.mail.impl.BeCPGMailServiceImpl">
		<property name="nodeService" ref="nodeService"/>
    	<property name="mailService" ref="mailService"/>   
    	<property name="templateService" ref="templateService"/>
    	<property name="serviceRegistry" ref="ServiceRegistry"/>
    	<property name="mailFrom" value="${mail.from.default}" />
    	<property name="searchService" ref="searchService"/>
	</bean>
	
	<!-- EntityVersion -->
	<bean id="entityVersionService" class="fr.becpg.repo.entity.version.EntityVersionServiceImpl">
		<property name="nodeService" ref="nodeService" />		
		<property name="copyService" ref="copyService" />	
	   	<property name="searchService" ref="searchService" />
	   	<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	</bean>
	
	<!-- Migrator -->
	<bean id="beCPGVersionMigrator" class="fr.becpg.repo.entity.version.BeCPGVersionMigrator">
		<property name="entityVersionService" ref="entityVersionService" />		
		<property name="nodeService" ref="nodeService" />	
	   <property name="versionService" ref="versionService" />
	   <property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	   <property name="dbNodeService">
      	<ref bean="mtAwareNodeService" />
      </property>
	</bean>
	
	<!-- CompareEntityService -->
	<bean id="compareEntityService" class="fr.becpg.repo.entity.comparison.CompareEntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="namespaceService" ref="namespaceService"/>
		<property name="attributeExtractorService" ref="attributeExtractorService"/>
		<property name="entityListDAO" ref="entityListDAO"/>
	</bean>
	
	<!-- Entity -->
	<bean id="entityListDAO" class="fr.becpg.repo.entity.impl.EntityListDAOImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />		
		<property name="fileFolderService" ref="fileFolderService"/>	
		<property name="namespaceService" ref="namespaceService"/>
		<property name="copyService" ref="copyService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
	</bean>
	<bean id="entityTplService" class="fr.becpg.repo.entity.impl.EntityTplServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="searchService" ref="searchService" />
		<property name="dictionaryService" ref="dictionaryService" />		
	</bean>
	<bean id="entityService" class="fr.becpg.repo.entity.impl.EntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="permissionService" ref="permissionService" />
		<property name="entityTplService" ref="entityTplService"/>
		<property name="entityVersionService" ref="entityVersionService"/>
		<property name="copyService" ref="copyService"/>
		<property name="contentService" ref="contentService"/>
		<property name="mimetypeService" ref="mimetypeService"/>
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	</bean>
	<bean id="remoteEntityService" class="fr.becpg.repo.entity.remote.impl.RemoteEntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityService" ref="entityService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="namespaceService" ref="namespaceService"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>	
	
	<!-- DataLists -->
	
	<bean id="multiLevelDataListService" class="fr.becpg.repo.entity.datalist.impl.MultiLevelDataListServiceImpl">
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="nodeService" ref="nodeService"/>
		 <property name="advSearchService" ref="advSearchService"/>
	</bean>
	
	<bean id="multiLevelExtractor" class="fr.becpg.repo.entity.datalist.impl.MultiLevelExtractor" >
		 <property name="attributeExtractorService" ref="attributeExtractorService"/>
		<property name="nodeService" ref="nodeService"/>
	   <property name="services" ref="ServiceRegistry"/>
	   <property name="permissionService" ref="permissionService"/>
	   <property name="advSearchService" ref="advSearchService"/>
	   <property name="multiLevelDataListService" ref="multiLevelDataListService"/>
	</bean>
	
	
	<bean id="simpleExtractor" class="fr.becpg.repo.entity.datalist.impl.SimpleExtractor" >
	   <property name="attributeExtractorService" ref="attributeExtractorService"/>
		<property name="nodeService" ref="nodeService"/>
	   <property name="services" ref="ServiceRegistry"/>
	   <property name="permissionService" ref="permissionService"/>
	   <property name="advSearchService" ref="advSearchService"/>
	</bean>
	
	<bean id="wUsedExtractor" class="fr.becpg.repo.entity.datalist.impl.WUsedExtractor" >
	   <property name="attributeExtractorService" ref="attributeExtractorService"/>
		<property name="nodeService" ref="nodeService"/>
	   <property name="services" ref="ServiceRegistry"/>
	   <property name="permissionService" ref="permissionService"/>
	   <property name="advSearchService" ref="advSearchService"/>
	   <property name="wUsedListService" ref="wUsedListService"/>
	   <property name="namespaceService" ref="namespaceService"/>
	</bean>
	
	<bean id="dataListExtractorFactory"  class="fr.becpg.repo.entity.datalist.impl.DataListExtractorFactoryImpl">
		<property name="simpleExtractor" ref="simpleExtractor"/>
		<property name="wUsedExtractor" ref="wUsedExtractor"/>
		<property name="multiLevelExtractor" ref="multiLevelExtractor"/>
	</bean>
	
	
	<bean id="entityDictionaryService" class="fr.becpg.repo.entity.impl.EntityDictionaryServiceImpl">
	</bean>
	<!-- Entity Policies-->
	<bean id="autoNumService" class="fr.becpg.repo.entity.impl.AutoNumServiceImpl">
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="repoService" ref="repoService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>
	<bean id="codePolicy" class="fr.becpg.repo.entity.policy.CodePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="autoNumService" ref="autoNumService" />
		<property name="searchService" ref="searchService" />
	</bean>
	<bean id="entityPolicy" class="fr.becpg.repo.entity.policy.EntityPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="entityService" ref="entityService" />		
	</bean>
	<bean id="initEntityListPolicy" class="fr.becpg.repo.entity.policy.InitEntityListPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="namespaceService" ref="namespaceService"/>
		<property name="dictionaryService" ref="dictionaryService" />
	</bean>
	<bean id="auditEntityListItemPolicies" class="fr.becpg.repo.entity.policy.AuditEntityListItemPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />		
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="authenticationService" ref="authenticationService" />
	</bean>	
	<bean id="sortableListPolicy" class="fr.becpg.repo.entity.policy.SortableListPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
	</bean>
	<bean id="entityCheckOutCheckInServicePolicy" class="fr.becpg.repo.entity.policy.EntityCheckOutCheckInServicePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />			
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="nodeService" ref="nodeService" />
		<property name="authenticationService" ref="authenticationService" />		
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="permissionService" ref="permissionService" />		
	</bean>
	<bean id="entityVersionServicePolicy" class="fr.becpg.repo.entity.policy.EntityVersionServicePolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />			
		<property name="entityVersionService" ref="entityVersionService" />			
	</bean>
	
	<!-- WUsedList -->
	<bean id="wUsedListService" class="fr.becpg.repo.entity.datalist.impl.WUsedListServiceImpl">
		<property name="nodeService" ref="nodeService" />
	</bean>

	<!-- Product dictionary -->
	<bean id="productDictionaryService" class="fr.becpg.repo.product.ProductDictionaryServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="fileFolderService" ref="fileFolderService" />		
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="repoService" ref="repoService"/>
	</bean>

	<!-- Product DAO -->
	<bean id="productDAO" class="fr.becpg.repo.product.ProductDAOImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="mlNodeService" ref="mlAwareNodeService" />
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="associationService" ref="associationService" />
	</bean>

	<!-- Product -->
	<bean id="productService" class="fr.becpg.repo.product.ProductServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="productDAO" ref="productDAO" />		
		<property name="productDictionaryService" ref="productDictionaryService" />		
		<property name="compositionCalculatingVisitor" ref="compositionCalculatingVisitor" />
		<property name="processCalculatingVisitor" ref="processCalculatingVisitor" />
		<property name="allergensCalculatingVisitor" ref="allergensCalculatingVisitor" />
		<property name="nutsCalculatingVisitor" ref="nutsCalculatingVisitor" />
		<property name="costsCalculatingVisitor" ref="costsCalculatingVisitor" />
		<property name="ingsCalculatingVisitor" ref="ingsCalculatingVisitor" />		
		<property name="repoService" ref="repoService" />
		<property name="ownableService" ref="ownableService"/>
	</bean>
	
	<!-- Formulation visitors -->
	<bean id="compositionCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.CompositionCalculatingVisitor">
		<property name="nodeService" ref="nodeService" />
	</bean>
	<bean id="processCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.ProcessCalculatingVisitor">
	</bean>
	<bean id="allergensCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.AllergensCalculatingVisitor">
		<property name="productDAO" ref="productDAO" />
		<property name="entityListDAO" ref="entityListDAO" />
	</bean>
	<bean id="ingsCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.IngsCalculatingVisitor">
		<property name="nodeService" ref="nodeService" />
		<property name="productDAO" ref="productDAO" />
		<property name="mlNodeService" ref="mlAwareNodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
	</bean>
	<bean id="nutsCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.NutsCalculatingVisitor">
		<property name="nodeService" ref="nodeService" />
		<property name="productDAO" ref="productDAO" />
		<property name="entityListDAO" ref="entityListDAO" />
	</bean>
	<bean id="costsCalculatingVisitor"
		class="fr.becpg.repo.product.formulation.CostsCalculatingVisitor">
		<property name="nodeService" ref="nodeService" />
		<property name="productDAO" ref="productDAO" />
		<property name="entityListDAO" ref="entityListDAO" />
	</bean>
	
	<!-- Product Policies -->	
	<bean id="productListUnits.ProductPolicy" class="fr.becpg.repo.product.policy.productListUnits.ProductPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="fileFolderService" ref="fileFolderService" />
	</bean>
	<bean id="productListUnits.ProductListPolicy" class="fr.becpg.repo.product.policy.productListUnits.ProductListPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
	</bean>
	<bean id="productListUnits.PriceListPolicy" class="fr.becpg.repo.product.policy.productListUnits.PriceListPolicy" init-method="init">
		<property name="policyComponent" ref="policyComponent" />
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="productDAO" ref="productDAO" />
	</bean>
	<!-- Product Listeners -->	
	<bean id="productCheckInListener" class="fr.becpg.repo.product.listener.ProductCheckInListener">
		<property name="productService" ref="productService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="nodeService" ref="nodeService" />
		<property name="namespaceService" ref="namespaceService" />
	</bean>
	
	<!-- Search -->
	<bean id="advSearchService" class="fr.becpg.repo.search.AdvSearchServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="namespaceService" ref="namespaceService" />	
		<property name="beCPGSearchService" ref="beCPGSearchService"/>
		<property name="permissionService" ref="permissionService"/>
	</bean>		
	<bean id="beCPGSearchService" class="fr.becpg.repo.search.BeCPGSearchServiceImpl">
		<property name="searchService" ref="SearchService" />
		<property name="unProtSearchService" ref="searchService" />	
	</bean>
	
		   	
  <!-- Override Thumbnail service implementation bean -->
    <bean id="thumbnailService" class="fr.becpg.repo.thumbnail.impl.BeCPGThumbnailServiceImpl" init-method="init">
    	<property name="entityService" ref="entityService"/>
    	<property name="dictionaryService" ref="dictionaryService"/>
    	<property name="searchService" ref="searchService"/>
    	
    	<property name="nodeService" ref="nodeService"/>
        <property name="renditionService" ref="renditionService" />
        <property name="thumbnailRegistry" ref="thumbnailRegistry" />
        <property name="policyComponent" ref="policyComponent" />
    </bean>
    
    <!-- Cache -->
    
    
    <bean id="beCPGCacheService" class="fr.becpg.repo.cache.impl.BeCPGCacheServiceImpl">
	     <property name="configLocation">
	    	<value>classpath:alfresco/module/${pom.artifactId}/becpg-ehcache.xml</value>
	  	</property>
    </bean>
    
    
</beans>
