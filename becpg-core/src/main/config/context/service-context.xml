<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN 2.0//EN' 'http://www.springframework.org/dtd/spring-beans-2.0.dtd'>

<beans>

	<!-- beCPG configuration files -->
	<bean name="beCPGPlaceholderConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="ignoreUnresolvablePlaceholders" value="true" />
		<property name="ignoreResourceNotFound" value="true"></property>
		<property name="locations">
			<list>
				<value>classpath:alfresco/module/${pom.artifactId}/beCPG.properties</value>
				<value>classpath*:beCPG.properties</value>
			</list>
		</property>
	</bean>

	<bean id="becpgBootstrapMessages" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
		<property name="resourceBundles">
			<list>
				<value>alfresco/module/${pom.artifactId}/model/becpgModel</value>
				<value>alfresco/module/${pom.artifactId}/messages/paths</value>
				<value>alfresco/module/${pom.artifactId}/messages/becpg-messages</value>
				<value>alfresco/module/${pom.artifactId}/messages/groups</value>
				<value>alfresco/module/${pom.artifactId}/messages/demo</value>
				<value>alfresco/module/${pom.artifactId}/messages/import-service</value>
				<value>alfresco/module/${pom.artifactId}/messages/patch</value>
			</list>
		</property>
	</bean>

	<!-- Admin -->
	<bean id="initRepoVisitor" class="fr.becpg.repo.admin.InitRepoVisitorImpl">
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="nodeService" ref="nodeService" />
		<property name="repoService" ref="repoService" />
		<property name="ruleService" ref="ruleService" />
		<property name="actionService" ref="actionService" />
		<property name="authorityService" ref="authorityService" />
		<property name="permissionService" ref="permissionService" />
		<property name="reportTplService" ref="reportTplService" />
		<property name="contentHelper" ref="contentHelper" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="entityTplService" ref="entityTplService" />
		<property name="beCPGMailService" ref="beCPGMailService" />
		<property name="designerInitService" ref="designerInitService" />
		<property name="entitySystemService" ref="entitySystemService" />
	</bean>


	<!-- Helper -->
	<bean id="contentHelper" class="fr.becpg.repo.helper.ContentHelper">
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService" />
		<property name="nodeService" ref="nodeService" />
	</bean>
	
	<bean id="repoService" class="fr.becpg.repo.helper.impl.RepoServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="repository" ref="repositoryHelper"/>
	</bean>
	<bean id="attributeExtractorService" class="fr.becpg.repo.helper.impl.AttributeExtractorServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityDictionaryService" ref="entityDictionaryService" />
		<property name="beCPGCacheService" ref="beCPGCacheService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="permissionService" ref="permissionService" />
		<property name="personService" ref="personService" />
		<property name="taggingService" ref="taggingService" />
		<property name="securityService" ref="securityService" />
		<property name="associationService" ref="associationService"/>
	</bean>
	

	<bean id="associationService"  parent="abstractBeCPGPolicy" class="fr.becpg.repo.helper.impl.AssociationServiceImpl">
		<property name="beCPGCacheService" ref="beCPGCacheService"/>
	</bean>

	<bean id="commentsService" class="fr.becpg.repo.helper.CommentsService">
		<property name="contentService" ref="contentService"/>
		<property name="nodeService" ref="nodeService"/>
	</bean>

	<!-- List values plugins -->


	<bean id="entityListValuePlugin" parent="baseListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.EntityListValuePlugin">
		<property name="autoNumService" ref="autoNumService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<!-- Todo better handle custom perm filter with BecpgPermFilter than maj here -->
		<property name="beCPGSearchService" ref="BeCPGSearchService" />
		<property name="dictionaryDAO" ref="dictionaryDAO" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="nodeService" ref="nodeService" />
		<property name="reportTplService" ref="reportTplService" />
		<property name="hierarchyService" ref="hierarchyService" />
	</bean>
	<bean id="spelEditorListValuePlugin" parent="entityListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.SpelEditorListValuePlugin">
	</bean>
	
	<bean id="compoListValuePlugin" parent="entityListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.CompoListValuePlugin">
		<property name="multiLevelDataListService" ref="multiLevelDataListService" />
	</bean>
	
	<bean id="nutListValuePlugin" parent="entityListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.NutListValuePlugin">
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="associationService" ref="associationService"/>
	</bean>
	
	<bean id="ingListValuePlugin" parent="entityListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.IngListValuePlugin">
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="associationService" ref="associationService"/>
	</bean>
	
	<bean id="variantListValuePlugin" parent="entityListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.VariantListValuePlugin">
	</bean>
	

	<!-- Importer -->
	<bean id="importService" class="fr.becpg.repo.importer.impl.ImportServiceImpl">
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="contentService" ref="contentService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="repoService" ref="repoService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="importNodeVisitor" ref="importNodeVisitor" />
		<property name="importProductVisitor" ref="importProductVisitor" />
		<property name="importCommentsVisitor" ref="importCommentsVisitor"/>
		<property name="importEntityListAspectVisitor" ref="importEntityListAspectVisitor" />
		<property name="importEntityListItemVisitor" ref="importEntityListItemVisitor" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	</bean>

	<!-- Abstract bean -->
	<bean id="parentImportVisitor" abstract="true"
		class="fr.becpg.repo.importer.impl.AbstractImportVisitor">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="repoService" ref="repoService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="autoNumService" ref="autoNumService" />
		<property name="hierarchyService" ref="hierarchyService" />
	</bean>

	<bean id="importNodeVisitor" class="fr.becpg.repo.importer.impl.ImportNodeVisitor"
		parent="parentImportVisitor" />

	<bean id="importProductVisitor" class="fr.becpg.repo.importer.impl.ImportProductVisitor"
		parent="parentImportVisitor">
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="hierarchyService" ref="hierarchyService" />
	</bean>
	
	<bean id="importCommentsVisitor" class="fr.becpg.repo.importer.impl.ImportCommentsVisitor"
		parent="parentImportVisitor">
		<property name="commentsService" ref="commentsService" />
	</bean>

	<bean id="importEntityListAspectVisitor"
		class="fr.becpg.repo.importer.impl.ImportEntityListAspectVisitor"
		parent="parentImportVisitor" >
	</bean>	

	<bean id="importEntityListItemVisitor" class="fr.becpg.repo.importer.impl.ImportEntityListItemVisitor"
		parent="parentImportVisitor">
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="associationService" ref="associationService"/>
	</bean>


	<bean id="userImporterService"
		class="fr.becpg.repo.importer.user.impl.UserImporterServiceImpl">
		<property name="authenticationService" ref="authenticationService" />
		<property name="contentService" ref="contentService" />
		<property name="nodeService" ref="nodeService" />
		<property name="personService" ref="personService" />
		<property name="siteService" ref="siteService" />
		<property name="authorityService" ref="authorityService" />
		<property name="beCPGMailService" ref="beCPGMailService" />
		<property name="namespacePrefixResolver" ref="namespaceService" />
	</bean>

	<!-- Mail service -->

	<bean id="beCPGMailService" class="fr.becpg.repo.mail.impl.BeCPGMailServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="mailService" ref="mailService" />
		<property name="templateService" ref="templateService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="mailFrom" value="${mail.from.default}" />
		<property name="repository" ref="repositoryHelper" />
		<property name="searchService" ref="searchService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="namespaceService" ref="namespaceService" />
	</bean>

	<!-- EntityVersion -->
	<bean id="entityVersionService" class="fr.becpg.repo.entity.version.EntityVersionServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="copyService" ref="copyService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="beCPGCacheService" ref="beCPGCacheService" />
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="entityService" ref="entityService" />
		<property name="versionService" ref="versionService" />
		<property name="authenticationService" ref="authenticationService"/>
		<property name="permissionService" ref="permissionService"/>
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter"/>
	</bean>

	<!-- Migrator -->
	<bean id="beCPGVersionMigrator" class="fr.becpg.repo.entity.version.BeCPGVersionMigrator">
		<property name="entityVersionService" ref="entityVersionService" />
		<property name="nodeService" ref="nodeService" />
		<property name="versionService" ref="versionService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="dbNodeService">
			<ref bean="mtAwareNodeService" />
		</property>
	</bean>

	<bean id="beCPGSystemFolderMigrator" class="fr.becpg.repo.migration.impl.BeCPGSystemFolderMigrator">
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="entitySystemService" ref="entitySystemService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="initRepoVisitor" ref="initRepoVisitor" />
		<property name="repoService" ref="repoService" />
		<property name="repository" ref="repositoryHelper" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="versionService" ref="versionService" />
		<property name="dbNodeService">
			<ref bean="mtAwareNodeService" />
		</property>
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="hierarchyService" ref="hierarchyService" />		
	</bean>
	
	<bean id="entityFolderMigrator" class="fr.becpg.repo.migration.impl.EntityFolderMigrator">
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="nodeService" ref="nodeService" />		
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="transactionService" ref="transactionService" />
		<property name="entityTplService" ref="entityTplService" />
		<property name="entityService" ref="entityService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="versionService" ref="versionService" />		
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
		<property name="entityVersionService" ref="entityVersionService" />
		<property name="taggingService" ref="taggingService" />
	</bean>
	
	<bean id="migrationService" class="fr.becpg.repo.migration.impl.MigrationServiceImpl">
		<property name="nodeService" ref="nodeService" />		
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="tenantAdminService" ref="tenantAdminService"/>
		<property name="transactionService" ref="transactionService" />
		<property name="dictionaryService" ref="dictionaryService" />		
	</bean>

	<!-- CompareEntityService -->
	<bean id="compareEntityService"
		class="fr.becpg.repo.entity.comparison.CompareEntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="attributeExtractorService" ref="attributeExtractorService" />
		<property name="entityListDAO" ref="entityListDAO" />
	</bean>

	<!-- Entity -->
	<bean id="entityListDAO" class="fr.becpg.repo.entity.impl.EntityListDAOImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="copyService" ref="copyService" />
		<property name="associationService" ref="associationService" />
	</bean>
	<bean id="entityTplService" class="fr.becpg.repo.entity.impl.EntityTplServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />		
		<property name="formulationService" ref="formulationService" />
		<property name="alfrescoRepository" ref="alfrescoRepository" />
		<property name="repositoryEntityDefReader" ref="repositoryEntityDefReader" />
		<property name="transactionService" ref="transactionService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter"/>
	</bean>
	<bean id="entityService" class="fr.becpg.repo.entity.impl.EntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="fileFolderService" ref="fileFolderService" />		
		<property name="copyService" ref="copyService" />
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="repoService" ref="repoService" />
	</bean>
	<bean id="entitySystemService" class="fr.becpg.repo.entity.impl.EntitySystemServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	</bean>

	<bean id="remoteEntityService"
		class="fr.becpg.repo.entity.remote.impl.RemoteEntityServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="entityService" ref="entityService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="dictionaryService" ref="dictionaryService" />
	</bean>
	
	<!-- Public API -->

	<alias name="remoteEntityService" alias="RemoteEntityService"/>

	<!-- DataLists -->
	
	
	<bean id="dataListExtractorFactory"
		class="fr.becpg.repo.entity.datalist.impl.DataListExtractorFactoryImpl"/>
	
	<bean id="multiLevelDataListService"
		class="fr.becpg.repo.entity.datalist.impl.MultiLevelDataListServiceImpl">
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="nodeService" ref="nodeService" />
		<property name="advSearchService" ref="advSearchService" />
		<property name="permissionService" ref="permissionService"/>
	</bean>
	
	<bean id="abstractDataListExtractor" abstract="true" init-method="init" class="fr.becpg.repo.entity.datalist.impl.AbstractDataListExtractor">
		<property name="advSearchService" ref="AdvSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="services" ref="ServiceRegistry" />
		<property name="attributeExtractorService" ref="attributeExtractorService" />
		<property name="dataListExtractorFactory" ref="dataListExtractorFactory"/>
		<property name="permissionService" ref="permissionService" />
	</bean>


   <bean id="simpleExtractor" class="fr.becpg.repo.entity.datalist.impl.SimpleExtractor" parent="abstractDataListExtractor">
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="namespaceService" ref="namespaceService"/>
		<property name="dataListSortRegistry" ref="dataListSortRegistry"/>		
		<property name="fileFolderService" ref="FileFolderService"/>
		<property name="associationService" ref="associationService"/>
		<property name="entityDictionaryService" ref="entityDictionaryService"/>
		<property name="defaultExtractor" value="true"/>
	</bean>

	<bean id="multiLevelExtractor" class="fr.becpg.repo.entity.datalist.impl.MultiLevelExtractor" parent="simpleExtractor">
		<property name="multiLevelDataListService" ref="multiLevelDataListService" />
		<property name="defaultExtractor" value="false"/>
	</bean>

	
	<bean id="wUsedExtractor" class="fr.becpg.repo.entity.datalist.impl.WUsedExtractor" parent="multiLevelExtractor">
		<property name="wUsedListService" ref="wUsedListService" />
		<property name="namespaceService" ref="namespaceService" />
	</bean>


	<!-- datalist sort -->
	<bean id="dataListSortService"
		class="fr.becpg.repo.entity.datalist.impl.DataListSortServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="policyBehaviourFilter" ref="policyBehaviourFilter" />
	</bean>	
	
	<bean id="dataListSortRegistry" class="fr.becpg.repo.entity.datalist.impl.DataListSortRegistryImpl"/>	
	<bean id="baseDataListSortPlugin" abstract="true"  class="fr.becpg.repo.entity.datalist.AbstractDataListSortPlugin" init-method="init">
		<property name="dataListSortRegistry" ref="dataListSortRegistry"/>
	</bean>

	<bean id="entityDictionaryService" class="fr.becpg.repo.entity.impl.EntityDictionaryServiceImpl">
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="beCPGCacheService" ref="beCPGCacheService"/>
	</bean>
	
  <bean id="autoNumService" class="fr.becpg.repo.entity.impl.AutoNumServiceImpl">
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="repoService" ref="repoService" />
		<property name="repositoryHelper" ref="repositoryHelper" />
		<property name="dictionaryService" ref="dictionaryService" />
	</bean>
	
	
	<!-- WUsedList -->
	<bean id="wUsedListService" class="fr.becpg.repo.entity.datalist.impl.WUsedListServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="permissionService" ref="permissionService"/>
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="dictionaryService" ref="dictionaryService"/>
	</bean>



	<!-- Search -->
	<bean id="advSearchService" class="fr.becpg.repo.search.AdvSearchServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="permissionService" ref="permissionService" />
		<property name="entityListDAO" ref="entityListDAO"/>
	</bean>
	
	<bean id="beCPGSearchService" class="fr.becpg.repo.search.BeCPGSearchServiceImpl">
		<property name="searchService" ref="searchService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="defaultSearchTemplate" value="${beCPG.defaultSearchTemplate}"/>
	</bean>
	
	<!-- Public API -->
	
	<alias name="advSearchService" alias="AdvSearchService"/>
	
	<bean id="BeCPGSearchService" class="fr.becpg.repo.search.BeCPGSearchServiceImpl">
		<property name="searchService" ref="SearchService" />
		<property name="namespaceService" ref="NamespaceService" />
		<property name="defaultSearchTemplate" value="${beCPG.defaultSearchTemplate}"/>
	</bean>
	
	<!-- Cache -->

	<bean id="beCPGCacheService" class="fr.becpg.repo.cache.impl.BeCPGCacheServiceImpl">
		<property name="tenantAdminService" ref="tenantAdminService"/>
		<property name="disableAllCache" value="false"/>
		<!-- If cache size is not define -->
		<property name="maxCacheItems" value="1500"/>
		<property name="cacheSizes">
		   <!-- Cache size is by tenant -->
			<map>
			  <entry key="fr.becpg.repo.security.SecurityService" value="10" />
			  <entry key="fr.becpg.repo.entity.version.EntityVersionService" value="10" />
			  <entry key="fr.becpg.repo.helper.AttributeExtractorService" value="500" />
			  <entry key="fr.becpg.repo.helper.AssociationService.childs" value="2000" />
			  <entry key="fr.becpg.repo.helper.AssociationService.assocs" value="20000" />
			  <entry key="fr.becpg.repo.jscript.Thumbnail" value="10" />
			</map>
		</property>
	</bean>
	
	<!-- Repository -->
	
	<bean id="repositoryEntityDefReader" class="fr.becpg.repo.repository.impl.RepositoryEntityDefReaderImpl">
		<property name="namespaceService" ref="namespaceService" />
	</bean>
	
	<bean id="alfrescoRepository" class="fr.becpg.repo.repository.impl.AlfrescoRepositoryImpl" init-method="init">
		<property name="nodeService" ref="nodeService" />
		<property name="entityListDAO" ref="entityListDAO" />
		<property name="associationService" ref="associationService" />
		<property name="repositoryEntityDefReader" ref="repositoryEntityDefReader"/>
		<property name="mlNodeService" ref="mlAwareNodeService"/>
	</bean>
	
	<bean id="applicationContextHelper" class="fr.becpg.util.ApplicationContextHelper"/>

	<bean id="hierarchyService"
		class="fr.becpg.repo.hierarchy.impl.HierarchyServiceImpl">
		<property name="namespaceService" ref="namespaceService" />
		<property name="beCPGSearchService" ref="beCPGSearchService" />
		<property name="nodeService" ref="nodeService" />
	</bean>
</beans>
