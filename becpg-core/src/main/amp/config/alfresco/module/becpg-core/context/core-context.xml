<?xml version='1.0' encoding='UTF-8'?>
<!--
  Copyright (C) 2010-2014 beCPG. 
   
  This file is part of beCPG 
   
  beCPG is free software: you can redistribute it and/or modify 
  it under the terms of the GNU Lesser General Public License as published by 
  the Free Software Foundation, either version 3 of the License, or 
  (at your option) any later version. 
   
  beCPG is distributed in the hope that it will be useful, 
  but WITHOUT ANY WARRANTY; without even the implied warranty of 
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
  GNU Lesser General Public License for more details. 
   
  You should have received a copy of the GNU Lesser General Public License along with beCPG. If not, see <http://www.gnu.org/licenses/>.
-->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <context:component-scan base-package="fr.becpg" />

	<!-- beCPG configuration files -->
	<bean name="beCPGPlaceholderConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="ignoreUnresolvablePlaceholders" value="true" />
		<property name="ignoreResourceNotFound" value="true"></property>
		<property name="locations">
			<list>
				<value>classpath:alfresco/module/${pom.artifactId}/becpg-config-core.properties</value>
				<value>classpath*:beCPG.properties</value>	
			</list>
		</property>
	</bean>

	<bean id="becpgCoreBootstrapMessages" class="org.alfresco.i18n.ResourceBundleBootstrapComponent">
		<property name="resourceBundles">
			<list>
				<value>alfresco/module/${pom.artifactId}/model/becpgModel</value>
				<value>alfresco/module/${pom.artifactId}/messages/paths</value>
				<value>alfresco/module/${pom.artifactId}/messages/becpg-messages</value>
				<value>alfresco/module/${pom.artifactId}/messages/groups</value>
				<value>alfresco/module/${pom.artifactId}/messages/demo</value>
				<value>alfresco/module/${pom.artifactId}/messages/patch</value>
			</list>
		</property>
	</bean>

	<!-- Helper -->
	<bean id="contentHelper" class="fr.becpg.repo.helper.ContentHelper">
		<property name="contentService" ref="contentService" />
		<property name="mimetypeService" ref="mimetypeService" />
		<property name="nodeService" ref="nodeService" />
	</bean>
	

	<bean id="associationService"  parent="abstractBeCPGPolicy" class="fr.becpg.repo.helper.impl.AssociationServiceImpl">
		<property name="beCPGCacheService" ref="beCPGCacheService"/>
	</bean>

	<!-- ListValue -->

	<!-- Plugin registry -->
	<bean id="listValuePluginRegistry" class="fr.becpg.repo.listvalue.impl.ListValuePluginRegistryImpl" />

	<bean id="baseListValuePlugin" abstract="true" class="fr.becpg.repo.listvalue.impl.AbstractBaseListValuePlugin" init-method="init">
		<property name="listValuePluginRegistry" ref="listValuePluginRegistry" />
	</bean>


	<bean id="listValueService" class="fr.becpg.repo.listvalue.impl.ListValueServiceImpl">
		<property name="listValuePluginRegistry" ref="listValuePluginRegistry" />
	</bean>



	<!-- List values plugins -->


	<bean id="entityListValuePlugin" parent="baseListValuePlugin"
		init-method="init" class="fr.becpg.repo.listvalue.impl.EntityListValuePlugin">
		<property name="autoNumService" ref="autoNumService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="targetAssocValueExtractor" ref="targetAssocValueExtractor"/>
		<property name="dictionaryDAO" ref="dictionaryDAO" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="nodeService" ref="nodeService" />
		<property name="hierarchyService" ref="hierarchyService" />
	</bean>

	

	<!-- Mail service -->

	<bean id="beCPGMailService" class="fr.becpg.repo.mail.impl.BeCPGMailServiceImpl">
		<property name="nodeService" ref="nodeService" />
		<property name="mailService" ref="mailService" />
		<property name="templateService" ref="templateService" />
		<property name="serviceRegistry" ref="ServiceRegistry" />
		<property name="mailFrom" value="${mail.from.default}" />
		<property name="repository" ref="repositoryHelper" />
		<property name="searchService" ref="searchService" />
		<property name="fileFolderService" ref="fileFolderService" />
		<property name="namespaceService" ref="namespaceService" />
	</bean>


	
	<!-- Public API -->

	<alias name="remoteEntityService" alias="RemoteEntityService"/>

	<!-- DataLists -->
	
	
	<bean id="dataListExtractorFactory"
		class="fr.becpg.repo.entity.datalist.impl.DataListExtractorFactoryImpl"/>
	

	
	<bean id="abstractDataListExtractor" abstract="true" init-method="init" class="fr.becpg.repo.entity.datalist.impl.AbstractDataListExtractor">
		<property name="advSearchService" ref="AdvSearchService" />
		<property name="nodeService" ref="nodeService" />
		<property name="services" ref="ServiceRegistry" />
		<property name="attributeExtractorService" ref="attributeExtractorService" />
		<property name="dataListExtractorFactory" ref="dataListExtractorFactory"/>
		<property name="permissionService" ref="permissionService" />
	</bean>


   <bean id="simpleExtractor" class="fr.becpg.repo.entity.datalist.impl.SimpleExtractor" parent="abstractDataListExtractor">
		<property name="entityListDAO" ref="entityListDAO"/>
		<property name="dataListSortRegistry" ref="dataListSortRegistry"/>		
		<property name="associationService" ref="associationService"/>
		<property name="entityDictionaryService" ref="entityDictionaryService"/>
		<property name="defaultExtractor" value="true"/>
	</bean>

	<bean id="multiLevelExtractor" class="fr.becpg.repo.entity.datalist.impl.MultiLevelExtractor" parent="simpleExtractor">
		<property name="multiLevelDataListService" ref="multiLevelDataListService" />
		<property name="defaultExtractor" value="false"/>
	</bean>

	
	<bean id="wUsedExtractor" class="fr.becpg.repo.entity.datalist.impl.WUsedExtractor" parent="multiLevelExtractor">
		<property name="wUsedListService" ref="wUsedListService" />
		<property name="namespaceService" ref="namespaceService" />
		<property name="nestedAdvSearchPlugin" ref="nestedAdvSearchPlugin"/>
	</bean>



	<bean id="bulkEditExtractor" class="fr.becpg.repo.entity.datalist.impl.BulkEditExtractor" parent="simpleExtractor">
		<property name="defaultExtractor" value="false"/>
		<property name="namespaceService" ref="namespaceService" />
	</bean>
	
	<bean id="dataListSortRegistry" class="fr.becpg.repo.entity.datalist.impl.DataListSortRegistryImpl"/>	
	<bean id="baseDataListSortPlugin" abstract="true"  class="fr.becpg.repo.entity.datalist.AbstractDataListSortPlugin" init-method="init">
		<property name="dataListSortRegistry" ref="dataListSortRegistry"/>
	</bean>

	
	
	<!-- Public API -->
	
	<alias name="advSearchService" alias="AdvSearchService"/>
	
	
	<!-- Cache -->

	<bean id="beCPGCacheService" class="fr.becpg.repo.cache.impl.BeCPGCacheServiceImpl">
		<property name="tenantAdminService" ref="tenantAdminService"/>
		<property name="disableAllCache" value="false"/>
		<!-- If cache size is not define -->
		<property name="maxCacheItems" value="1500"/>
		<property name="cacheSizes">
		   <!-- Cache size is by tenant -->
			<map>
			  <entry key="fr.becpg.repo.security.SecurityService" value="10" />
			  <entry key="fr.becpg.repo.entity.version.EntityVersionService" value="10" />
			  <entry key="fr.becpg.repo.helper.AttributeExtractorService" value="500" />
			  <entry key="fr.becpg.repo.helper.AssociationService.childs" value="2000" />
			  <entry key="fr.becpg.repo.helper.AssociationService.assocs" value="20000" />
			  <entry key="fr.becpg.repo.jscript.Thumbnail" value="10" />
			</map>
		</property>
	</bean>
	
	
	<bean id="applicationContextHelper" class="fr.becpg.util.ApplicationContextHelper"/>

</beans>
