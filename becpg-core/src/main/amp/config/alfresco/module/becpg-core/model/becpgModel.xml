<?xml version="1.0" encoding="UTF-8"?>
<!-- Definition of new Model -->
<model name="bcpg:bcpgmodel" xmlns="http://www.alfresco.org/model/dictionary/1.0">
	<!-- Optional meta-data about the model -->
	<description>beCPG Model</description>
	<author>QUERE</author>
	<version>1.0</version>
	<!-- Imports are required to allow references to definitions in other models -->
	<imports>
		<!-- Import Alfresco Dictionary Definitions -->
		<import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d" />
		<!-- Import Alfresco Content Domain Model Definitions -->
		<import uri="http://www.alfresco.org/model/content/1.0" prefix="cm" />
		<import uri="http://www.bcpg.fr/model/report/1.0" prefix="rep" />
	</imports>
	<!-- Introduction of new namespaces defined by this model -->
	<namespaces>
		<namespace uri="http://www.bcpg.fr/model/becpg/1.0" prefix="bcpg" />
	</namespaces>

	<constraints>
		<constraint name="bcpg:autoNumPrefix" type="REGEX">
			<parameter name="expression">
				<value>[A-Z]*</value>
			</parameter>
			<parameter name="requiresMatch">
				<value>true</value>
			</parameter>
		</constraint>
		<constraint name="bcpg:systemState" type="LIST">
			<parameter name="allowedValues">
				<list>
					<value>Simulation</value>
					<value>ToValidate</value>
					<value>Valid</value>
					<value>Refused</value>
					<value>Archived</value>
				</list>
			</parameter>
		</constraint>
		<constraint name="bcpg:entityDataListStates" type="LIST">
			<parameter name="allowedValues">
				<list>
					<value>ToValidate</value>
					<value>Valid</value>
				</list>
			</parameter>
		</constraint>
	</constraints>
	<types>
		<type name="bcpg:listValue">
			<parent>bcpg:entityListItem</parent>
			<properties>
				<property name="bcpg:lvValue">
					<type>d:mltext</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</type>

		<type name="bcpg:linkedValue">
			<parent>bcpg:entityListItem</parent>
			<properties>
				<property name="bcpg:lkvValue">
					<type>d:text</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
			<mandatory-aspects>
				<aspect>bcpg:depthLevelAspect</aspect>
				<aspect>bcpg:isDeletedAspect</aspect>
				<aspect>bcpg:codeAspect</aspect>
				<aspect>bcpg:erpCodeAspect</aspect>
			</mandatory-aspects>
		</type>

		<type name="bcpg:entityV2">
			<parent>cm:folder</parent>
			<mandatory-aspects>
				<aspect>bcpg:effectivityAspect</aspect>
			</mandatory-aspects>
		</type>

		<type name="bcpg:systemEntity">
			<parent>bcpg:entityV2</parent>
		</type>

		<type name="bcpg:autoNum">
			<parent>cm:content</parent>
			<properties>
				<property name="bcpg:autoNumClassName">
					<type>d:qname</type>
				</property>
				<property name="bcpg:autoNumPropertyName">
					<type>d:qname</type>
				</property>
				<property name="bcpg:autoNumValue">
					<type>d:long</type>
				</property>
				<property name="bcpg:autoNumPrefix">
					<type>d:text</type>
					<index enabled="true">
						<atomic>false</atomic>
						<stored>false</stored>
						<tokenised>false</tokenised>
					</index>
					<constraints>
						<constraint ref="bcpg:autoNumPrefix" />
					</constraints>
				</property>
			</properties>
		</type>

		<type name="bcpg:entityListItem">
			<parent>cm:content</parent>
			<mandatory-aspects>
				<aspect>bcpg:sortableListAspect</aspect>
			</mandatory-aspects>
		</type>		
		
		<type name="bcpg:charact">
			<parent>bcpg:entityListItem</parent>
			<mandatory-aspects>
				<aspect>bcpg:legalNameAspect</aspect>
				<aspect>bcpg:isDeletedAspect</aspect>
			</mandatory-aspects>
		</type>
		
	</types>
	
	<aspects>

		<aspect name="bcpg:compareWithAspect">
			<associations>
				<association name="bcpg:compareWithEntities">
					<title>Compare with entities</title>
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>bcpg:entityV2</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
			</associations>
		</aspect>
		
		<aspect name="bcpg:entityBranchAspect">
		 <properties>
				<property name="bcpg:branchFromVersionLabel">
					<title>Branch from version label</title>
               <type>d:text</type>
               <protected>true</protected>
               <mandatory>true</mandatory>
				</property>
			</properties>
			<associations>
				<association name="bcpg:branchFromEntity">
					<title>Branch from entity</title>
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>bcpg:entityV2</class>
						<mandatory>false</mandatory>
						<many>false</many>
					</target>
				</association>
			</associations>
		</aspect>
	

		<aspect name="bcpg:formulatedEntityAspect">
			<properties>
				<property name="bcpg:formulatedDate">
					<type>d:datetime</type>
				</property>
			</properties>
		</aspect>
		
		
		<aspect name="bcpg:docLinkedEntitiesAspect">
			<associations>
				<association name="bcpg:docLinkedEntities">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>bcpg:entityV2</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>
			</associations>
		</aspect>
		
		<aspect name="bcpg:legalNameAspect">
			<properties>
				<property name="bcpg:legalName">
					<type>d:mltext</type>
				</property>
			</properties>
		</aspect>
	
		<aspect name="bcpg:systemFolderAspect">
		</aspect>
		
		<aspect name="bcpg:depthLevelAspect">
			<properties>
				<property name="bcpg:depthLevel">
					<type>d:int</type>
					<mandatory>true</mandatory>
				</property>
				<!-- used to store the direct parentLevel node (multi-leve recipe)l -->
				<property name="bcpg:parentLevel">
					<type>d:noderef</type>
				</property>
			</properties>
			<mandatory-aspects>
				<aspect>bcpg:sortableListAspect</aspect>
			</mandatory-aspects>
		</aspect>

		<aspect name="bcpg:sortableListAspect">
			<properties>
				<property name="bcpg:sort">
					<type>d:int</type>
					<mandatory>true</mandatory>
				</property>
			</properties>
		</aspect>

		<aspect name="bcpg:detaillableListItemAspect">
		</aspect>

		<aspect name="bcpg:isManualListItemAspect">
			<properties>
				<property name="bcpg:isManualListItem">
					<type>d:boolean</type>
					<mandatory enforced="true">true</mandatory>
					<default>false</default>
				</property>
			</properties>
		</aspect>
		
		<aspect name="bcpg:codeAspect">
			<properties>
				<property name="bcpg:code">
					<type>d:text</type>
					<mandatory>false</mandatory>
				</property>
			</properties>
		</aspect>

		<aspect name="bcpg:entityDataListStateAspect">
			<properties>
				<property name="bcpg:entityDataListState">
					<type>d:text</type>
					<mandatory>false</mandatory>
					<index enabled="true">
						<atomic>false</atomic>
						<stored>false</stored>
						<tokenised>false</tokenised>
					</index>
					<constraints>
						<constraint ref="bcpg:entityDataListStates"></constraint>
					</constraints>
				</property>
			</properties>
		</aspect>

		<aspect name="bcpg:hiddenFolder">
		</aspect>
		
		<!-- version with datalists -->
		<aspect name="bcpg:compositeVersion">
			<title>Versionable with datalists</title>
			<properties>
				<property name="bcpg:versionDescription">
					<title>Version Label</title>
					<type>d:text</type>
					<protected>true</protected>
				</property>
				<property name="bcpg:versionLabel">
					<title>Version Label</title>
					<type>d:text</type>
					<protected>true</protected>
				</property>
				<property name="bcpg:frozenCreated">
					<title>Created</title>
					<type>d:datetime</type>
					<protected>true</protected>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>both</tokenised>
					</index>
				</property>
				<property name="bcpg:frozenCreator">
					<title>Creator</title>
					<type>d:text</type>
					<protected>true</protected>
				</property>
				<property name="bcpg:frozenModified">
					<title>Modified</title>
					<type>d:datetime</type>
					<protected>true</protected>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>both</tokenised>
					</index>
				</property>
				<property name="bcpg:frozenModifier">
					<title>Modifier</title>
					<type>d:text</type>
					<protected>true</protected>
				</property>
				<property name="bcpg:frozenAccessed">
					<title>Accessed</title>
					<type>d:datetime</type>
					<protected>true</protected>
					<index enabled="true">
						<atomic>true</atomic>
						<stored>false</stored>
						<tokenised>both</tokenised>
					</index>
				</property>
				<property name="bcpg:frozenNodeRef">
					<type>d:text</type>
					<mandatory enforced="true">false</mandatory>
				</property>
				<property name="bcpg:frozenNodeDbId">
					<type>d:long</type>
					<mandatory enforced="true">false</mandatory>
				</property>
			</properties>
		</aspect>

		<!-- Aspect for folder templates used to store permission groups -->
		<aspect name="bcpg:permissionsTpl">
			<associations>

				<association name="bcpg:consumerGroups">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>cm:authorityContainer</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>

				<association name="bcpg:editorGroups">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>cm:authorityContainer</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>

				<association name="bcpg:contributorGroups">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>cm:authorityContainer</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>

				<association name="bcpg:collaboratorGroups">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>cm:authorityContainer</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
				</association>

			</associations>
		</aspect>

		<aspect name="bcpg:effectivityAspect">
			<properties>
				<property name="bcpg:startEffectivity">
					<type>d:datetime</type>
				</property>
				<property name="bcpg:endEffectivity">
					<type>d:datetime</type>
				</property>
			</properties>
		</aspect>
		
		<aspect name="bcpg:isDeletedAspect">
			<properties>
				<property name="bcpg:isDeleted">
					<type>d:boolean</type>
					<mandatory enforced="true">true</mandatory>
					<default>false</default>
				</property>
			</properties>
		</aspect>

		<aspect name="bcpg:colorAspect">
			<properties>
				<property name="bcpg:color">
					<type>d:text</type>
					<default>000000</default>
				</property>
			</properties>
		</aspect>		
		
		<!-- Aspect used to store the entity type of the template (entityFolderTpl, entityTpl, etc...) -->
		<aspect name="bcpg:entityTplAspect">
			<properties>
				<property name="bcpg:entityTplClassName">
					<type>d:qname</type>
				</property>
				<property name="bcpg:entityTplEnabled">
					<type>d:boolean</type>
					<mandatory enforced="true">true</mandatory>
					<default>true</default>
				</property>
				<property name="bcpg:entityTplIsDefault">
					<type>d:boolean</type>
					<default>false</default>
				</property>
			</properties>
		</aspect>

		<aspect name="bcpg:entityTplRefAspect">
			<associations>
				<association name="bcpg:entityTplRef">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>bcpg:entityV2</class>
						<mandatory>false</mandatory>
						<many>false</many>
					</target>
				</association>
			</associations>
		</aspect>

		<aspect name="bcpg:entityListsAspect">
			<associations>
				<child-association name="bcpg:entityLists">
					<source>
						<mandatory>false</mandatory>
						<many>true</many>
					</source>
					<target>
						<class>cm:folder</class>
						<mandatory>false</mandatory>
						<many>true</many>
					</target>
					<duplicate>false</duplicate>
					<propagateTimestamps>true</propagateTimestamps>
				</child-association>
			</associations>
		</aspect>
		
	

	</aspects>
</model>
